<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-training-modules/module-3">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-rh="true">Deploying a job in AWS Glue | Hackney Data Platform Playbook</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-3"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploying a job in AWS Glue | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="Training module: Deploying a job in AWS Glue"><meta data-rh="true" property="og:description" content="Training module: Deploying a job in AWS Glue"><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-3"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-3" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-3" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://4a83a5c4eb60fa0e4dae66ff84553e02-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.4438b1b5.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.8bd3a463.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.5e1ecb54.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/playbook/getting-set-up">Playbook</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Data-Platform-Playbook/training-modules/module-0">Training Modules</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-0">Main Modules</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-0">Getting started with training</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-1">Ingesting data from Google Sheets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-2">Transforming data to refined zone using Sagemaker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-3">Deploying a job in AWS Glue</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/training-modules/Qlik/qlik-module-1">Qlik Modules</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/docs/CI-CD-process">Technical Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/architecture-decisions">Architecture Decision</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/spikes/amundsen-deployment">Spikes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Data-Platform-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Training Modules</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Main Modules</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deploying a job in AWS Glue</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Deploying a job in Glue</h1><p>In this module, you will move the data transformation script you created Sagemaker (from <a href="/Data-Platform-Playbook/training-modules/module-2">Transforming data to refined zone using Sagemaker</a>) into a Glue job and then ‘productionise’ it. </p><h2 class="anchor anchorWithStickyNavbar_mojV" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>First you will test the script within the Glue console like you did in the training module <strong>Ingesting data from Google Sheets</strong>. </p><p>Once this job runs successfully, you will then set up the job formally by writing a Terraform module. </p><p>This will replicate a common task within the Data Platform, where data from the raw zone is transformed and written into the refined zone, usually on a schedule. We use Terraform to productionise jobs for a number of reasons:</p><p>When deployed, Terraform will generate all the necessary infrastructure in the AWS environment (job, crawler, scheduler)</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-terraform-infrastructure-as-code">Using Terraform (Infrastructure as Code)<a class="hash-link" href="#using-terraform-infrastructure-as-code" title="Direct link to heading">​</a></h3><p>This will replace the elements you’ve created manually in the AWS console in the second part of Module 2. This is called ‘Infrastructure as Code’ (IaC) and brings a lot of advantages to the Data Platform: </p><ul><li><strong>Quality assurance:</strong> we use Terraform templates so all elements of infrastructure follow the same standards</li><li><strong>Repeatability:</strong> your job can be recreated by a simple redeployment if anything goes wrong. It can also be replicated to another environment, for instance from Staging to Production. Be aware that any changes made to your Glue job directly within the Glue console will be overwritten when the Terraform next deploys. </li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-github">Using GitHub<a class="hash-link" href="#using-github" title="Direct link to heading">​</a></h3><p>Both the PySpark script and the job details in Terraform will become part of the Data Platform code base and saved in GitHub. This also brings advantages:</p><ul><li><p><strong>Safety:</strong> Your code cannot be accidentally lost and is each version of your code is &#x27;saved&#x27;, also known as version-control. This means that code can be rolled back if necessary.</p></li><li><p><strong>Quality assurance:</strong> Your code will be reviewed by at least two Data Platform developers. GitHub will also perform automated checks which verify certain criteria , and therefore must pass before being allowed to merge into the repository</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="pre-requisites">Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">​</a></h2><p>Please ensure that the modules <a href="/Data-Platform-Playbook/training-modules/module-0">Getting started</a>, <a href="/Data-Platform-Playbook/training-modules/module-1">Ingesting data from Google Sheets</a> and <a href="/Data-Platform-Playbook/training-modules/module-2">Transforming data to refined zone using Amazon Sagemaker</a> are completed before proceeding.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="part-1-prototyping-the-job-in-the-aws-glue-console">Part 1. Prototyping the job in the AWS Glue console<a class="hash-link" href="#part-1-prototyping-the-job-in-the-aws-glue-console" title="Direct link to heading">​</a></h2><p>You’ll take the following steps before productionising the script you wrote in the  <strong>Transforming data to refined zone using Amazon Sagemaker</strong> module, to check it runs smoothly as a job in the AWS Glue environment; we expect it will as the notebook environment within SageMaker also runs within the same Glue environment).
It will be an opportunity for you to try logging.
As we’re just testing, we won’t write any Terraform (we&#x27;ll do this in the second half of this module) and we won’t schedule the job.
We’ll also delete our job at the end.
If you need more detailed instructions at any point checkout <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio">the guide to set up an ETL job</a>.</p><ol><li>Login to AWS pre-production account via the <a href="https://hackney.awsapps.com/start#/" target="_blank" rel="noopener noreferrer">Hackney SSO</a>.</li></ol><ol start="2"><li>Set up a new job in Glue Studio.<ul><li>Go to <a href="https://eu-west-2.console.aws.amazon.com/gluestudio/home?region=eu-west-2#/jobs" target="_blank" rel="noopener noreferrer">AWS Glue Studio</a> and open the <strong>template job</strong>, called &quot;stg job_template&quot; (To make it easier to get started, this template has some of the script layout formatted, and job parameters specified already).</li><li>Clone the job (from Actions) and rename it with your name and remove &quot;stg&quot; from the prefix, for example &quot;joe bloggs template&quot;.</li><li>Open the job and familiarise yourself with the steps (reading, transforming and writing data) and note the differences compared to the Notebook template.</li></ul></li></ol><p><img loading="lazy" alt="Cloning a glue job" src="/Data-Platform-Playbook/assets/images/cloning_jobs-c2503e064e6e9ecf46dbfa06882c3695.png" width="512" height="223" class="img_E7b_"></p><ol start="3"><li><p>Write your Glue job.</p><ul><li><p>In a different tab, open Sagemaker and navigate to the notebook you created in Module 2.</p></li><li><p>Paste your code from the notebook into the template, ignoring the first cell (Cells can be merged in Jupyter by holding <code>Shift</code> and selecting the cells, then pressing <code>Shift+M</code> on your keyboard).</p></li><li><p>For the variables defined in the first cell of your notebook, you will use the <code>Job details</code> tab instead of writing them in the script.
You should define them in the <strong>Job parameters</strong> panel which can be found under <code>Advanced properties</code>.
You should also update the S3 path in the <strong>Script path</strong> field to <code>s3://dataplatform-stg-glue-scripts/custom/</code>. </p></li></ul></li></ol><p><img loading="lazy" alt="job parameters" src="/Data-Platform-Playbook/assets/images/job_parameters-a3dbe41df15b36bdcb26ce05edb564cc.png" width="512" height="342" class="img_E7b_"></p><ol start="4"><li>Run your job.</li><li>Review the run result logs.
See the <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio#monitoring-a-glue-job-run">monitoring section</a> of the using Glue Studio guide for an explanation on how to do this.</li><li>Once your job status has changed from <code>Running</code> to <code>Succeeded</code> you should check the data wrote correctly into <a href="https://s3.console.aws.amazon.com/s3/home?region=eu-west-2" target="_blank" rel="noopener noreferrer">S3</a>.
To do this, follow the same steps in the <a href="/Data-Platform-Playbook/training-modules/module-1#6-crawling-the-ingested-data-to-make-it-available-in-the-glue-catalogue">last section of Module 1</a>.</li><li><a href="https://eu-west-2.console.aws.amazon.com/glue/home?region=eu-west-2#catalog:tab=crawlers" target="_blank" rel="noopener noreferrer">Crawl</a> the results. (Using the crawler named “sandbox-refined-zone”).</li><li>Check the data in <a href="https://eu-west-2.console.aws.amazon.com/athena/home?region=eu-west-2#/query-editor/" target="_blank" rel="noopener noreferrer">Athena</a> - (<a href="/Data-Platform-Playbook/playbook/querying-and-analysing-data/querying-data-using-sql">playbook</a>).</li></ol><p>Congratulations, you&#x27;ve tested that your transformation is working in Glue. You can move to the next part of Module 3.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-part-2-deploying-your-job-via-terraform">2. Part 2: Deploying your job via Terraform<a class="hash-link" href="#2-part-2-deploying-your-job-via-terraform" title="Direct link to heading">​</a></h2><p>In this second part of Module 3, you will ‘productionize’ the job you’ve tested in the previous part. To do this, you will write a Terraform module in the Data Platform GitHub repository, and then deploy it. The entirety of this module will be carried out in the GitHub User Interface (GUI), but you could also work in your local development environment such as PyCharm or VSCode if you prefer. </p><h3 class="anchor anchorWithStickyNavbar_mojV" id="overview-of-the-steps-for-part-2">Overview of the steps for part 2:<a class="hash-link" href="#overview-of-the-steps-for-part-2" title="Direct link to heading">​</a></h3><ul><li>First, you’ll delete the data you have just created in part 1 as the Terraform you are about to write will replicate the process, but in an automated way. </li><li>Then, you will save your PySpark script in the relevant location of the Data Platform GitHub repository. The code will be the same as what you have used within the script part of the Glue job creation.</li><li>Next, you will write a Module in Terraform that encapsulates all the resources your Glue job requires.</li><li>You will then create a Pull Request and merge your code with the pre-production Data Platform repository</li><li>At this point, GitHub will attempt to deploy your code, and your job will get created in AWS. </li><li>You will be able to retrieve your Glue job in the AWS console, to run it, and check the results in Athena. </li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="detailed-steps-for-part-2">Detailed steps for part 2:<a class="hash-link" href="#detailed-steps-for-part-2" title="Direct link to heading">​</a></h3><ol start="9"><li>Delete the data generated in Part 1 of this module.</li></ol><p>This is so that we can check that the job deployed through the Terraform that you are about to write, actually works. To delete your data, navigate to it in S3 (Refined zone bucket, Sandbox department) and permanently delete the two full folders with your name (there should be one folder for Locations and one for Vaccinations). <em>Do NOT</em> delete your data from the Raw zone, otherwise you would have to ingest it again by running the ingestion job created in <em>Ingesting data from Google Sheets!</em></p><ol start="10"><li>Create and add your PySpark script to the GitHub repository.</li></ol><p>This step can be done via GitHub website, or in your local IDE (in the latter case make sure you have pulled the latest version of the Data Platform repository from the <em>main</em> branch).</p><ul><li>Navigate to the <strong>Jobs</strong> directory in the Data Platform Project and open your department folder.</li><li>Click <em>Add file</em> and then <em>Create new file</em>.</li><li>Name your file. This should be the same name you gave your job in Glue Studio. Ensure the file name only contains lowercase letters, that words are separated by underscores, and that the file has the extension <em>.py</em> at the end. Add your name at the end of the file name. An example is <em>covid_vaccinations_joe_bloggs.py</em>. Remember the name you have given your script as you will need it for the following section.</li><li>If your Glue job was created using Glue Studio, open your Glue job and copy the Python script by navigating to the <em>Script</em> tab.</li><li>Navigate back to the new script file you created in the GitHub interface (or existing script file, if you are updating your script), and paste in your script.</li><li>When you validate your new file in GitHub, do not create a Pull Request straight away as we also need to write the Terraform module. Look at the name of the new branch you are creating. You&#x27;ll use the same branch in the next step and raise one single PR at the end</li></ul><p>More information about using GitHub is in the <a href="https://lbhackney-it.github.io/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/deploy-glue-jobs/#1-add-your-script-to-the-data-platform-project-using-the-github-ui" target="_blank" rel="noopener noreferrer">Using GitHub Playbook article</a>.</p><ol start="11"><li>Define your job in a Terraform module.</li></ol><p>A module is a block of Terraform code that creates a set of related resources in our Amazon Web Services account. The Data Platform team has created a module template for Glue jobs. An <a href="https://lbhackney-it.github.io/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/deploy-glue-jobs/#example-module-block" target="_blank" rel="noopener noreferrer">example from the Playbook</a> is reproduced below. As you can see, it includes:</p><ul><li>The job name and department</li><li>The location of the PySpark script</li><li>The schedule of the job</li><li>The job parameters (this is the same as what you defined manually in <em>Job details</em> in the Glue console)</li><li>A crawler to crawl the results of your job so that data is available to view in a tabular format in the Glue data catalogue (rather than as a set of parquet files in S3)</li></ul><p>You’ll create your module in the existing file: <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/terraform/25-aws-glue-job-sandbox.tf" target="_blank" rel="noopener noreferrer">terraform/25-aws-glue-job-sandbox.tf</a>. This link takes you to the <code>main</code> branch of the repository, but you should make sure you switch to the branch you were using to develop the Pythin script in the previous step. </p><p>To create your module, follow the steps from the <!-- -->[Playbook, Part 2][job module in playbook]<!-- -->. </p><blockquote><p>⚠️ Please ensure that you <strong>add your name</strong> at the end of the module name and the job name so that it can be distinguished from other modules and jobs that other users have created as part of this training.</p></blockquote><blockquote><p>⚠️ Please <strong>do not</strong> add a schedule to your module, you’ll just run it manually later.</p></blockquote><blockquote><p>⚠️ The example above does not contain all the mandatory fields… make sure you read the Playbook guidance above carefully so that you don’t forget any! If you do, GitHub won&#x27;t let you commit your work.</p></blockquote><ol start="12"><li>Raise a Pull Request so that your code can be reviewed.</li></ol><p>Commit your code to your current working branch and then open a Pull Request. This Pull Request will contain your new Python script and your new Terraform module.</p><ol start="13"><li>Deploy to the Data Platform.</li></ol><p>When you have received <strong>two approvals</strong> from reviewers, go back to GitHub. You will now be able to merge your branch (the merge button is green). </p><p>The automated deployment will now start and make take up to an hour to complete.
To check how it is going, you can navigate to the <a href="https://github.com/LBHackney-IT/Data-Platform/actions" target="_blank" rel="noopener noreferrer">Actions tab</a> and monitor the progress of your code deployment. </p><p>A common reason for a deployment failure is when a resource declared in Terraform (for instance a pySpark script file) is missing from the AWS environment. If this is happening, make sure all the necessary resources have been deployed before re-trying to deploy yours.</p><ol start="14"><li>Check your new resources in the AWS console.</li></ol><p>In the <a href="https://eu-west-2.console.aws.amazon.com/gluestudio/home?region=eu-west-2#/jobs" target="_blank" rel="noopener noreferrer">Glue Studio page</a>, you should find your Glue job with the prefix “stg-” included. In the <a href="https://eu-west-2.console.aws.amazon.com/glue/home?region=eu-west-2#catalog:tab=crawlers" target="_blank" rel="noopener noreferrer">Glue Crawlers</a> page, you should find the associated crawler. You can easily link the details of these new resources to the statements you wrote in the Terraform module.</p><ol start="15"><li>Run the deployed job.</li></ol><p>You can now run your job manually from Glue Studio. After it has completed, the job will trigger the crawler so you don’t need to run it yourself. If you navigate to the Crawler page, you should see your crawler in the ‘running’ state.</p><ol start="16"><li>Check the resulting data in Athena - the interface to view and query data from the Glue Catalogue.</li></ol><ul><li>Open the <a href="https://eu-west-2.console.aws.amazon.com/athena/home?region=eu-west-2#/query-editor" target="_blank" rel="noopener noreferrer">Query editor</a></li><li>Make sure workgroup is “sandbox” and you’re using the “sandbox-raw-zone” database</li><li>Run a simple query in Athena against your tables (created/ updated) by the Crawlers. A simple way to do this is to select the 3 vertical dots by the table name and select “Preview Table” to see the top 10 lines. (The dialect of SQL used in Athena is <a href="https://prestodb.io/" target="_blank" rel="noopener noreferrer">Presto SQL</a>)</li></ul><ol start="17"><li>Delete the job prototype you&#x27;ve created manually in the Glue console in the Part 1 of this training module.</li></ol><p>If the deployed job has worked successfully, you can safely delete the one you created manually earlier as you won&#x27;t need to reload the data again - your code is now in the Data Platform codebase!  </p><blockquote><p>🎉 Congratulations, you&#x27;ve completed this module and deployed a job in the Data Platform! </p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/Data-Platform-Playbook/tags/training">training</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/training-modules/module-3.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Data-Platform-Playbook/training-modules/module-2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Transforming data to refined zone using Sagemaker</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Data-Platform-Playbook/training-modules/Qlik/qlik-module-1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Module 1 - Introduction to Qlik</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#using-terraform-infrastructure-as-code" class="table-of-contents__link toc-highlight">Using Terraform (Infrastructure as Code)</a></li><li><a href="#using-github" class="table-of-contents__link toc-highlight">Using GitHub</a></li></ul></li><li><a href="#pre-requisites" class="table-of-contents__link toc-highlight">Pre-requisites</a></li><li><a href="#part-1-prototyping-the-job-in-the-aws-glue-console" class="table-of-contents__link toc-highlight">Part 1. Prototyping the job in the AWS Glue console</a></li><li><a href="#2-part-2-deploying-your-job-via-terraform" class="table-of-contents__link toc-highlight">2. Part 2: Deploying your job via Terraform</a><ul><li><a href="#overview-of-the-steps-for-part-2" class="table-of-contents__link toc-highlight">Overview of the steps for part 2:</a></li><li><a href="#detailed-steps-for-part-2" class="table-of-contents__link toc-highlight">Detailed steps for part 2:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.8bd3a463.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.5e1ecb54.js"></script>
</body>
</html>