<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-react-helmet="true">Module 2 - Transforming data to refined zone | Hackney Data Platform Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-2"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Module 2 - Transforming data to refined zone | Hackney Data Platform Playbook"><meta data-react-helmet="true" name="description" content="Training Module 2"><meta data-react-helmet="true" property="og:description" content="Training Module 2"><link data-react-helmet="true" rel="shortcut icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-2"><link data-react-helmet="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-2" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/training-modules/module-2" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.4a006c0c.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.3009c254.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.8d4858f5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Playbook</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Training Modules</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-0">Module 0 - Getting started with Training</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-1">Module 1 - Ingesting data from Google Sheets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/training-modules/module-2">Module 2 - Transforming data to refined zone</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Technical Documentation</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture Decision</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Spikes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Module 2 - Transforming data &amp; writing to the refined zone</h1></header><p>In this module you will manipulate the data that you loaded into the Data Platform raw zone in <a href="/Data-Platform-Playbook/training-modules/module-1">module 1</a>.
You will save the result of your work into the <a href="/Data-Platform-Playbook/glossary#refined-zone">refined zone</a> of the data platform.
The refined zone is for data that has been enhanced or enriched and is ‚Äòready‚Äô for analysis.
You will be using <a href="https://spark.apache.org/docs/latest/api/python/" target="_blank" rel="noopener noreferrer">PySpark</a> to code your job, and <a href="https://aws.amazon.com/glue/?whats-new-cards.sort-by=item.additionalFields.postDateTime&amp;whats-new-cards.sort-order=desc" target="_blank" rel="noopener noreferrer">AWS Glue</a> to run it. You will create your code in a Jupyter Notebook environment running in AWS Sagemaker before copying it to the AWS console.
Jupyter notebooks are a convenient way to test code locally as Glue Studio is not so straightforward for code development (despite what the name implies!). You can read more about Jupyter notebooks <a href="https://jupyter.org/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>This module is all about prototyping within a sandbox environment and therefore we won‚Äôt be pushing any code to the Data Platform GitHub repository.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>You‚Äôll write a few lines of code in PySpark which will include reading data from S3, joining the two Covid datasets together and then writing the newly created dataset back to S3 in the refined zone. Then, you will be working in the console, running your job and checking your data like in Module 1. </p><p>PySpark is an interface that uses the Python programming language to access the Apache Spark cluster-computing framework; therefore the syntax will seem a bit different if you have used Python packages such as Pandas or NumPy before.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>Please ensure that both <a href="/Data-Platform-Playbook/training-modules/module-0">module 0</a> and <a href="/Data-Platform-Playbook/training-modules/module-1">module 1</a> is completed before proceeding.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="step-by-step-instructions"></a>Step-by-step instructions<a class="hash-link" href="#step-by-step-instructions" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-developing-the-job-script-in-a-jupyter-notebook"></a>1. Developing the job script in a Jupyter notebook<a class="hash-link" href="#1-developing-the-job-script-in-a-jupyter-notebook" title="Direct link to heading">#</a></h3><ol><li>Launch the sandbox notebook following <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-sagemaker">this guide</a>.</li><li>Open the notebook template called &quot;using-pyspark.ipynb&quot;.<ul><li>Familiarise yourself with the steps (variables, reading, transforming and writing data).</li><li>Duplicate the template, saving it in the sandbox folder, and rename it.</li></ul></li><li>Prototype your own ETL job to transform the data in PySpark. The <a href="https://sparkbyexamples.com/pyspark-tutorial/" target="_blank" rel="noopener noreferrer">PySpark By Examples website</a> is a handy resource to write your code. Please try the following things on your data: <ul><li>Load the Covid Locations dataset into the notebook.</li><li>Print out the schema and the first few rows of data to check it has imported correctly.</li><li>Change a column name: rename <code>location</code> to <code>country</code>.</li><li>Load the Covid Vaccinations dataset into the notebook.</li><li>Cast a column to a different type e.g. a string date to date type.</li><li>Join the two tables to a single output using the <code>country</code> column.</li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-testing-the-finished-job-in-aws-glue"></a>2. Testing the finished job in AWS glue<a class="hash-link" href="#2-testing-the-finished-job-in-aws-glue" title="Direct link to heading">#</a></h3><p>You‚Äôll take the following steps before productionising your job, to check it runs smoothly in the AWS glue environment (it should, because the notebook runs against glue).
It will be an opportunity for you to try logging.
As we‚Äôre just testing, we won‚Äôt write any Terraform and we won‚Äôt schedule the job.
We‚Äôll also delete our job at the end.
If you need more detailed instructions at any point checkout <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio">the guide to set up an ETL job</a>.</p><ol><li><p>Login to AWS pre-production acccount via the <a href="https://hackney.awsapps.com/start#/" target="_blank" rel="noopener noreferrer">Hackney SSO</a>.</p></li><li><p>Set up your new job in Glue Studio.</p><ul><li>Go to <a href="https://eu-west-2.console.aws.amazon.com/gluestudio/home?region=eu-west-2#/jobs" target="_blank" rel="noopener noreferrer">AWS Glue Studio</a> and open the Template job, called &quot;stg job_template&quot;.</li><li>Familiarise yourself with the steps (reading, transforming and writing data) and note the differences compared to the Notebook template.</li><li>Clone the job (from Actions) and rename it with your name and remove stg from the prefix, for example &quot;jane doe template&quot;.</li></ul><p><img alt="Cloning a glue job" src="/Data-Platform-Playbook/assets/images/cloning_jobs-c2503e064e6e9ecf46dbfa06882c3695.png"></p></li><li><p>Write your job.</p><p>Paste your code from the notebook into the template. (Cells can be merged in Jupyter by holding shift and selecting the cells, then hitting shift+M).</p><p>For the variables defined at the top of the notebook, you will use the ‚ÄòJob details‚Äô tab instead of writing them in the script.
The Job parameters panel can be found under Advanced properties.</p><p><img alt="job parameters" src="/Data-Platform-Playbook/assets/images/job_parameters-a3dbe41df15b36bdcb26ce05edb564cc.png"></p></li><li><p>Run your job.</p></li><li><p>Review the run result logs.
See the <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio#monitoring-a-glue-job-run">monitoring section</a> of the using glue studio guide for an explanation on how to do this.</p></li><li><p>Check the data wrote correctly into <a href="https://s3.console.aws.amazon.com/s3/home?region=eu-west-2" target="_blank" rel="noopener noreferrer">S3</a>.
To do this, follow the same steps in the <a href="/Data-Platform-Playbook/training-modules/module-1#6-crawling-the-ingested-data-to-make-it-available-in-the-glue-catalogue">last section of module 1</a>.</p></li><li><p><a href="https://eu-west-2.console.aws.amazon.com/glue/home?region=eu-west-2#catalog:tab=crawlers" target="_blank" rel="noopener noreferrer">Crawl</a> the results. (Using the crawler named ‚Äúsandbox-refined-zone‚Äù).</p></li><li><p>Check the data in <a href="https://eu-west-2.console.aws.amazon.com/athena/home?region=eu-west-2#/query-editor/" target="_blank" rel="noopener noreferrer">Athena</a> - (<a href="/Data-Platform-Playbook/playbook/querying-and-analysing-data/querying-data-using-sql">playbook</a>).</p></li><li><p>Remove the temporary resources that you created (glue job and S3 files) from the console.</p></li></ol><blockquote><p>üéâ Congratulations! You have completed Module 2!</p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/Data-Platform-Playbook/tags/training">training</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/training-modules/module-2.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Data-Platform-Playbook/training-modules/module-1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Module 1 - Ingesting data from Google Sheets</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Data-Platform-Playbook/docs/academy-ingestion"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ingesting Academy data onto the Data Platform ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#step-by-step-instructions" class="table-of-contents__link">Step-by-step instructions</a><ul><li><a href="#1-developing-the-job-script-in-a-jupyter-notebook" class="table-of-contents__link">1. Developing the job script in a Jupyter notebook</a></li><li><a href="#2-testing-the-finished-job-in-aws-glue" class="table-of-contents__link">2. Testing the finished job in AWS glue</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.3009c254.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.8d4858f5.js"></script>
</body>
</html>