<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-dap-airflow/onboarding/prototype-simple-transforms">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Prototype simple transforms | Hackney Data Platform Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook/dap-airflow/onboarding/prototype-simple-transforms"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Prototype simple transforms | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="Onboarding data analysts and engineers to DAP⇨flow, the Data Analytics Platform Airflow integration."><meta data-rh="true" property="og:description" content="Onboarding data analysts and engineers to DAP⇨flow, the Data Analytics Platform Airflow integration."><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/dap-airflow/onboarding/prototype-simple-transforms"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/dap-airflow/onboarding/prototype-simple-transforms" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/dap-airflow/onboarding/prototype-simple-transforms" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KNMFHOJ4X2-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.e0b8b3cc.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.efd05c05.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.aed49b4a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/playbook/getting-set-up">Playbook</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/training-modules/module-0">Training Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/docs/CD-process">Technical Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Data-Platform-Playbook/dap-airflow/introduction">DAP⇨flow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/introduction">📚Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/begin">📚Onboarding</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/begin">Begin here</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/welcome">Welcome!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/access-the-AWS-Management-Console">AWS Console access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/access-the-AWS-region">AWS region</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/access-my-Amazon-Athena-database">Amazon Athena</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/access-my-current-service-data">My current service data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/access-my-service-data-history">My service data history</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/query-my-service-data">Query my service data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/prototype-simple-transforms">Prototype simple transforms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/prototype-legacy-transforms">Prototype legacy transforms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/github-access">GitHub access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/github-branch">GitHub branching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/github-commit-transform">Committing transforms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/onboarding/github-pull-request">GitHub pull requests</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/dap-airflow/ux">📚UX</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/architecture-decisions">Architecture Decision</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/spikes/amundsen-deployment">Spikes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Data-Platform-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">DAP⇨flow</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">📚Onboarding</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Prototype simple transforms</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>How can I use <strong><em>Amazon Athena</em></strong> to prototype a simple table-join data transformation?</h1><p><img loading="lazy" alt="DAP⇨flow" src="/Data-Platform-Playbook/assets/images/DAPairflowFLOWleft-e023069f4c3409ab8db1b918e04abb3b.png" width="750" height="100" class="img_ev3q">  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-access-amazon-athena">1. Access <strong><em>Amazon Athena</em></strong><a href="#1-access-amazon-athena" class="hash-link" aria-label="Direct link to 1-access-amazon-athena" title="Direct link to 1-access-amazon-athena">​</a></h2><p><strong><code>🖱</code></strong> In your web browser, log in to your AWS account, navigate to the <strong><em>AWS Management Console</em></strong>, and open <strong><em>Amazon Athena</em></strong>. </p><p>👉 First time <strong><em>Amazon Athena</em></strong> users should <strong>start here ►</strong> <strong><a href="/Data-Platform-Playbook/dap-airflow/onboarding/access-my-Amazon-Athena-database">DAP⇨flow📚Amazon Athena</a></strong> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-select-your-service-workgroup">2. Select your <code>[service workgroup]</code><a href="#2-select-your-service-workgroup" class="hash-link" aria-label="Direct link to 2-select-your-service-workgroup" title="Direct link to 2-select-your-service-workgroup">​</a></h2><p><strong><code>🖱</code></strong> Ensure you have selected your <code>[service workgroup]</code> from the list box next to “<strong>Workgroup</strong>”.  </p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>REMINDER</div><div class="admonitionContent_S0QG"><p>👉  Your <strong>Service Terms<code>[]</code></strong> are defined in the <strong><em>welcome</em></strong> document stored in your <a href="https://drive.google.com/drive/folders/1k30M7Hh8WLttL5T5JVGbnKvSLNX7lVSg?usp=drive_link" target="_blank" rel="noopener noreferrer"><strong><code>[service access group]</code></strong> <strong><em>Google Drive subfolder</em></strong></a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-exploring-your-service-raw-zone-database">3. Exploring your <code>[service raw zone]</code> database<a href="#3-exploring-your-service-raw-zone-database" class="hash-link" aria-label="Direct link to 3-exploring-your-service-raw-zone-database" title="Direct link to 3-exploring-your-service-raw-zone-database">​</a></h2><p><strong><code>🖱</code></strong> Ensure you have selected your <code>[service raw zone]</code> from the list box under &quot;<strong>Database</strong>&quot; on the left side of the Athena interface.  </p><p><strong><code>🖱</code></strong> You can then expand the lists under &quot;<strong><code>►</code> Tables</strong>&quot; or &quot;<strong><code>►</code> Views</strong>&quot;, then expand each name further to reveal column names and data types, as follows:</p><ul><li><p>&quot;<strong><code>▼</code> Tables</strong>&quot;<br>
<!-- -->👉 Documented here ► <strong><a href="/Data-Platform-Playbook/dap-airflow/onboarding/access-my-service-data-history">📚My service data history</a></strong> </p></li><li><p>&quot;<strong><code>▼</code> Views</strong>&quot;<br>
<!-- -->👉 Documented here ► <strong><a href="/Data-Platform-Playbook/dap-airflow/onboarding/access-my-current-service-data">📚My current service data</a></strong> </p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-understanding-the-data-model">4. Understanding the data model<a href="#4-understanding-the-data-model" class="hash-link" aria-label="Direct link to 4. Understanding the data model" title="Direct link to 4. Understanding the data model">​</a></h2><p><strong><code>👁</code></strong> Identify which tables and columns you need to use for your data transformation:  </p><ul><li><p>Wherever you want a <code>&lt;table&gt;</code> originally from your <code>[service database]</code> you should be able to find it&#x27;s name listed under &quot;<strong><code>▼</code> Views</strong>&quot; below your <code>[service raw zone]</code> database. </p></li><li><p>For a simple simple table-join data transformation you will need:</p><ul><li><p>The <strong><code>&lt;parent table&gt;</code></strong> with a unique <code>&lt;parent key&gt;</code>.</p></li><li><p>The <strong><code>&lt;child table&gt;</code></strong> with a unique <code>&lt;child key&gt;</code> and a foreign key pointing to the <code>&lt;parent key&gt;</code> of the <code>&lt;parent table&gt;</code>.</p></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-prepare-your-transform-sql-query">5. Prepare your <code>[transform SQL]</code> query<a href="#5-prepare-your-transform-sql-query" class="hash-link" aria-label="Direct link to 5-prepare-your-transform-sql-query" title="Direct link to 5-prepare-your-transform-sql-query">​</a></h2><p><strong><code>🖱</code></strong> You can either:</p><ul><li><p>Start completely from scratch and building up your query in the editor as you go along;  </p></li><li><p>Or, begin with a SQL template design, eg. <strong><code>Fig. 5</code></strong> <code>[SQL template]</code>, by <em>copy-and-pasting</em> it into the query editor. </p></li></ul><p><strong><code>Fig. 5</code></strong> <code>[SQL template]</code></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Query will use table names from my [service database]...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">import_date </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> original_import_date</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- added to my query</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">parent </span><span class="token keyword" style="font-style:italic">key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">col1</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">col2</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">etc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">child </span><span class="token keyword" style="font-style:italic">key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">col1</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">col2</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">etc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">parent </span><span class="token keyword" style="font-style:italic">table</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> p</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">child </span><span class="token keyword" style="font-style:italic">table</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">parent </span><span class="token keyword" style="font-style:italic">key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">parent </span><span class="token keyword" style="font-style:italic">key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">parent </span><span class="token keyword" style="font-style:italic">key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">child </span><span class="token keyword" style="font-style:italic">key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">limit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>👉 You&#x27;ll find considerations for SQL development discussed <strong>here ► <a href="#considerations-when-adopting-amazon-athena-for-your-future-sql-development">📚Appendix</a></strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-customizing-a-template-query">6. Customizing a template query<a href="#6-customizing-a-template-query" class="hash-link" aria-label="Direct link to 6. Customizing a template query" title="Direct link to 6. Customizing a template query">​</a></h2><p>When, for example, using the <strong><code>Fig. 5</code></strong> <code>[SQL template]</code>:  </p><p><strong><code>🖱</code></strong> You will need to replace the <code>&lt;parent table&gt;</code> and  <code>&lt;child table&gt;</code> template placeholders with actual names listed under “<strong><code>▼</code> Views</strong>” over from the left-hand side of the interface. The Athena editor allows you to insert names directly into the code by simply clicking on the three dots <strong><code>⋮</code></strong> right of the name, then selecting “<strong><em>insert into editor</em></strong>”.</p><p><strong><code>Fig. 6a</code></strong> <img loading="lazy" alt="Fig. 6a" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-six-a-bd703f3e265771fc5d3c2dfa9f730036.png" width="512" height="408" class="img_ev3q"></p><p><strong><code>🖱</code></strong> You will need to replace the  <code>&lt;parent key&gt;</code> and  <code>&lt;child key&gt;</code> template placeholders with corresponding key column names.</p><p><strong><code>Fig. 6b</code></strong> <img loading="lazy" alt="Fig. 6b" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-six-b-e6bb109e4e35b0563efe670d0e38eae4.png" width="922" height="936" class="img_ev3q"></p><p><strong><code>🖱</code></strong> Include all the columns you need. So replace the , placeholders <code>&lt;col1&gt;</code>, <code>&lt;col2&gt;</code>, etc., with actual column names. And so on.</p><p>👉 If your column expressions require functions, you can check the <strong><em>Amazon Athena</em> documentation ►<a href="https://docs.aws.amazon.com/athena/latest/ug/functions.html" target="_blank" rel="noopener noreferrer">here</a></strong>.</p><p><strong><code>🖱</code></strong> Edit your table names to ensure they are fully qualified, as follows: </p><ul><li><p>Table names should be prefixed by their correct database names, eg. <code>[service raw zone].&lt;table name&gt;</code>.  </p></li><li><p><strong><em>Amazon Athena</em></strong>, by default, renders editor-inserted names encapsulated in <code>&quot;</code> double-quotes, eg. <code>“[service raw zone]”.“&lt;table name&gt;”</code>.  You don&#x27;t need to do this! But FYI, the quotes are a safeguard in case of column names containing spaces, even though we never allow that.</p></li><li><p>Your original <code>[service database]</code> database name will not be used by <strong>DAP⇨flow</strong>, so you will need to swap it out with your <code>[service raw zone]</code>.
</p></li><li><p>Use of fully-qualified table names means you can use tables from databases elsewhere in the Data Platform. For example, you might want to join your table from your <code>[service raw zone]</code> database with a table or view from your <code>[service refined zone]</code>.   </p></li><li><p>You must avoid using the following column names in your transform query output because they are reserved by the <strong>DAP⇨flow</strong> implementation for writing your transform output to the S3 data lake partition folders:   </p><ul><li><p><code>import_date</code>  </p></li><li><p><code>import_year</code>  </p></li><li><p><code>import_month</code>  </p></li><li><p><code>import_day</code>  </p><p>The <strong><code>Fig. 5</code></strong> template example shows the column <code>import_date</code> renamed as <code>original_import_date</code> which avoids that ever being a problem.  </p><p>It isn&#x27;t necessary to output a <code>original_import_date</code> column in your query but it is good practice to  inform users of your transform products about which generation the data came from.  </p><p>Because <strong>DAP⇨flow</strong>&#x27;s Airflow ingestion can trigger transforms immediately afterward, it naturally follows that, the transform output dates will be the same as the original import dates. For that reason, you might not want to use <code>original_import_date</code> in your transform in production. But if the pipeline trigger logic might cause those dates to diverge in some future use case, then you should consider leaving it in.  </p><p><strong><code>Fig. 6c</code></strong> <img loading="lazy" alt="Fig. 6c" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-six-c-c62008b24978ec73bb1d4848bd95a232.png" width="437" height="287" class="img_ev3q"></p></li></ul></li></ul><ul><li><p>Here, it is recommended to order the output by <code>&lt;parent key&gt;</code> then <code>&lt;child key&gt;</code>.  </p><p>  💡 Transformed data is written back to S3 in blocks of records organized into separate files collated into folders representing the the S3 partition scheme. Having records written out in a coherent order makes for more efficient scanning or crawling later on.  </p><p>  <strong><code>Fig. 6d</code></strong> <img loading="lazy" alt="Fig. 6d" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-six-d-402e19e895f839b409a4994e70235628.png" width="324" height="244" class="img_ev3q"></p></li><li><p>Adding a <code>limit</code> clause at the end of your query when testing SQL queries in the Athena console normally prevents long-running queries when testing. You will routinely remove the <code>limit</code> clause later when your transform goes into production.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-run-your-transform-sql-query">7. Run your <code>[transform SQL]</code> query<a href="#7-run-your-transform-sql-query" class="hash-link" aria-label="Direct link to 7-run-your-transform-sql-query" title="Direct link to 7-run-your-transform-sql-query">​</a></h2><p><strong><code>🖱</code></strong> After customizing the SQL code, click “<strong>Run</strong>” or “<strong>Run again</strong>” located underneath the code window on the left side in the Athena interface.  </p><p><strong><code>Fig. 7</code></strong> <img loading="lazy" alt="Fig. 7" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-seven-452d96d1af74ab3e3ef29ea974736f86.png" width="388" height="145" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-review-the-results">8. Review the results<a href="#8-review-the-results" class="hash-link" aria-label="Direct link to 8. Review the results" title="Direct link to 8. Review the results">​</a></h2><p><strong><code>👁</code></strong> <strong><em>Amazon Athena</em></strong> should fetch a number of rows based on your set <code>limit</code> (eg. <code>limit 100;</code> as in the <strong><code>Fig. 5</code></strong> <code>[SQL template]</code>).  </p><ul><li><p>If you included it, the first column <code>original_import_data</code> will inform us when the underlying data was ingested from your <code>[service database]</code>. If you do not see today’s date then you’ll immediately know that the data ingestion had failed sometime after the date shown, and you should contact the DAP Team to find out what the problem is. But so long as you have data of any given generation you can still test your transform query.  </p></li><li><p>The data should be sorted, eg.,  in the  <code>&lt;parent key&gt;</code> + <code>&lt;child key&gt;</code> order if that is what your <code>order by</code> clause says.  </p></li><li><p>If your query is based on a <code>&lt;parent table&gt;</code> left-joined to the <code>&lt;child table&gt;</code> it is possible for the <code>&lt;child key&gt;</code> and its associated child columns to output NULLs in the place of values, alongside the <code>&lt;parent key&gt;</code> and parent column values. It is worth paying attention to ensure such behavior is the same way as when querying your <code>[service database]</code> previously.  </p></li></ul><p><strong><code>Fig. 8</code></strong> <img loading="lazy" alt="Fig. 8" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-eight-e37cc674e7c6b5f18cabee43543c75db.png" width="512" height="169" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="9-save-your-query-as-transform-sql">9. Save your query as <code>[transform SQL]</code><a href="#9-save-your-query-as-transform-sql" class="hash-link" aria-label="Direct link to 9-save-your-query-as-transform-sql" title="Direct link to 9-save-your-query-as-transform-sql">​</a></h2><p><strong><code>🖱</code></strong> Check you are in your correct <code>[service workgroup]</code> before clicking on the three dots <strong>⋮</strong> to the right of your Query tab, and clicking “<strong>Save as</strong>”.  </p><p><strong><code>🖮</code></strong> When the dialogue pops up, enter a name for your <code>[transform SQL]</code> eg. <code>[transform].sql</code> and write a description before clicking the “<strong>Save query</strong>” button.</p><p><strong><code>Fig. 9a</code></strong> <img loading="lazy" alt="Fig. 9a" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-nine-a-89447a3cea022b7a9619256b08a0fd9c.png" width="507" height="374" class="img_ev3q">  </p><p><strong><code>Fig. 9b</code></strong> <img loading="lazy" alt="Fig. 9b" src="/Data-Platform-Playbook/assets/images/prototype-simple-transforms-nine-b-5246cc47b13f5f74ec7019d556d640ff.png" width="904" height="625" class="img_ev3q"></p><br><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="we--your-feedback"><strong><em>&quot;We</em> ♡ <em>your feedback!&quot;</em></strong><a href="#we--your-feedback" class="hash-link" aria-label="Direct link to we--your-feedback" title="Direct link to we--your-feedback">​</a></h2><p><img loading="lazy" alt="DAP⇨flow" src="/Data-Platform-Playbook/assets/images/DAPairflowFLOWleft-e023069f4c3409ab8db1b918e04abb3b.png" width="750" height="100" class="img_ev3q">  </p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>UX  </div><div class="admonitionContent_S0QG"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-please-use-this-link--dapflow-ux-feedback--prototype-simple-transforms">👉 Please use <strong>this link ►</strong> <a href="https://docs.google.com/forms/d/e/1FAIpQLSdqeNyWIPMNBHEr-YSyxnXQ4ggTwJPkffMYgFaJ4hGEhIL6LA/viewform?usp=pp_url&amp;entry.339550210=prototype-simple-transforms" target="_blank" rel="noopener noreferrer"><strong>DAP⇨flow</strong> <code>UX</code> <strong>Feedback / prototype-simple-transforms</strong></a><a href="#-please-use-this-link--dapflow-ux-feedback--prototype-simple-transforms" class="hash-link" aria-label="Direct link to -please-use-this-link--dapflow-ux-feedback--prototype-simple-transforms" title="Direct link to -please-use-this-link--dapflow-ux-feedback--prototype-simple-transforms">​</a></h3><ul><li><p>Your feedback enables us to improve <strong>DAP⇨flow</strong> and our Data Analytics Platform service.  </p></li><li><p>We encourage all our users to be generous with their time, in giving us their recollections and honest opinions about our service.  </p></li><li><p>We especially encourage our new users to give feedback at the end of every <strong>📚Onboarding</strong> task because the quality of the onboarding experience really matters.  </p><p>  ☝ <strong>Please use this link to help us understand your user experience!</strong></p></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ux-criteria">📚<code>UX</code> Criteria<a href="#ux-criteria" class="hash-link" aria-label="Direct link to ux-criteria" title="Direct link to ux-criteria">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>ABILITY  </div><div class="admonitionContent_S0QG"><ul><li><strong>AWS Management Console</strong> user  </li><li><strong><em>Amazon Athena</em></strong> beginner  </li><li>Hackney <code>[service]</code> Data Analyst</li><li>Hackney <code>[service database]</code> user</li></ul></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>BEHAVIOR  </div><div class="admonitionContent_S0QG"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-i-use-amazon-athena-to-prototype-a-simple-table-join-data-transformation-1">How can I use <strong><em>Amazon Athena</em></strong> to prototype a simple table-join data transformation?<a href="#how-can-i-use-amazon-athena-to-prototype-a-simple-table-join-data-transformation-1" class="hash-link" aria-label="Direct link to how-can-i-use-amazon-athena-to-prototype-a-simple-table-join-data-transformation-1" title="Direct link to how-can-i-use-amazon-athena-to-prototype-a-simple-table-join-data-transformation-1">​</a></h3><p><strong>Measures</strong> the behavior of <strong><em>Amazon Athena</em></strong> while users prototype simple transforms:</p><p><strong>Given</strong> in my web browser, I have accessed <strong><em>Amazon Athena</em></strong><br>
<strong>~and</strong> I have selected my <code>[service workgroup]</code><br>
<strong>~and</strong> I have my <code>[example data transformation]</code> I want to implement using my <code>[SQL template]</code> involving two related tables ingested from my<code>[service database]</code> that I want joined to produce a combined output<br>
<strong>~and</strong> my <code>[example data transformation]</code> has a <code>&lt;parent table&gt;</code> containing a unique <code>&lt;parent key&gt;</code> which is a foreign key in a <code>&lt;child table&gt;</code> which also with its own unique <code>&lt;child key&gt;</code><br>
<strong>~and</strong> <strong><em>Amazon Athena</em></strong> shows my <code>[service raw zone]</code> with my <code>[service database]</code> equivalent tables and columns which includes the <code>&lt;parent table&gt;</code> and <code>&lt;child table&gt;</code><br>
<strong>~and</strong> the <em>optional</em> first column output from my <code>[SQL template]</code> named <code>original_import_date</code> is based on the <code>import_date</code> of the <code>&lt;parent table&gt;</code><br>
<strong>~and</strong> my <code>[SQL template]</code> was designed to fetch the first <code>&lt;limit&gt;</code> rows of data in the order <code>&lt;parent key&gt;</code>+<code>&lt;child key&gt;</code><br>
<strong>~and</strong> I am familiar with the concepts and basic requirements of writing an <strong><em>Amazon Athena</em></strong> SQL query  </p><p><strong>When</strong> I copy-and-paste my <code>[SQL template]</code> into the query editor<br>
<strong>~and</strong> I replace the  <code>&lt;parent table&gt;</code> and  <code>&lt;child table&gt;</code> placeholders with corresponding table names from my <code>[example data transformation]</code><br>
<strong>~and</strong> replace the  <code>&lt;parent key&gt;</code> and  <code>&lt;child key&gt;</code> placeholders with corresponding key column names from my <code>[example data transformation]</code><br>
<strong>~and</strong> include <code>&lt;col1&gt;, &lt;col2&gt;,..&lt;etc.&gt;</code> using column names from my <code>[example data transformation]</code> together with <em>optional</em> <code>[SQL template]</code> columns that I want fetched<br>
<strong>~and</strong> I click “<strong>Run</strong>” underneath the code window on the left-hand side</p><p><strong>Then</strong> <strong><em>Amazon Athena</em></strong> should fetch the first <code>&lt;limit&gt;</code> rows of data sorted in <code>&lt;parent key&gt;</code>+<code>&lt;child key&gt;</code> order<br>
<strong>~and</strong> the output should comprise the columns I selected<br>
<strong>~and</strong> an <em>optional</em> column <code>original_import_date</code> would show when the data was ingested from my <code>[service database]</code><br>
<strong>~and</strong> I can save my SQL as a working and fully functional transform query with my name <code>[transform].sql</code> and description in my <code>[service workgroup]</code>.</p><p><strong>Scale</strong> of 7 to 14 <strong>~and</strong> flow features.  </p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix">📚Appendix<a href="#appendix" class="hash-link" aria-label="Direct link to 📚Appendix" title="Direct link to 📚Appendix">​</a></h2><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Considerations</div><div class="admonitionContent_S0QG"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="considerations-when-adopting-amazon-athena-for-your-future-sql-development">Considerations when adopting <strong><em>Amazon Athena</em></strong> for your future SQL development<a href="#considerations-when-adopting-amazon-athena-for-your-future-sql-development" class="hash-link" aria-label="Direct link to considerations-when-adopting-amazon-athena-for-your-future-sql-development" title="Direct link to considerations-when-adopting-amazon-athena-for-your-future-sql-development">​</a></h3><p>💡Migrating to a new technology or platform offers an ideal opportunity to raise coding standards and shed common old habits of the past.</p><ul><li><p>You have complete freedom over the SQL code formatting however we recommend always putting each element, table or column, on its own line. This helps debugging and readability. You should endeavour to be consistent in your style and agree a particular style among your service colleagues. In our examples, we will use 4-space tabulation and use &quot;hard left&quot; nesting, which you are welcome to adopt. </p></li><li><p>Nesting has no syntactic significance to SQL interpreters so its only impact is aesthetic alone. JOIN-clauses join everything previously to the table following, and not just the previous table, so nesting them does change order of execution. Execution order can only be affected by the use of bracketed sub-queries. The hard-left nesting style, on the other hand, is designed to help the reader be conscious of the execution order above all else.</p></li><li><p>Avoid using lazy cartesian table products without JOIN-clauses in between the tables (or subqueries or CTEs). Likewise avoid using WHERE-clauses to perform cartesian filters and use JOIN-clauses instead. Conversely, Athena does not mind non-cartesian filters within JOIN-clauses and is even recommended where partition-columns are involved because it reduces the quantity of data scanned before any subsequent joins are executed.</p></li><li><p>Always consider using CTEs in place of subqueries to help debugging and readability. <strong><em>Amazon Athena</em></strong> permits VALUES table constructors in CTEs allowing replacement of very lengthy WHERE-CASE filters with the more efficient JOIN-CTE filters.</p></li></ul></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/Data-Platform-Playbook/tags/onboarding">onboarding</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/dap-airflow/onboarding/prototype-simple-transforms.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Data-Platform-Playbook/dap-airflow/onboarding/query-my-service-data"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Query my service data</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Data-Platform-Playbook/dap-airflow/onboarding/prototype-legacy-transforms"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Prototype legacy transforms</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-access-amazon-athena" class="table-of-contents__link toc-highlight">1. Access <strong><em>Amazon Athena</em></strong></a></li><li><a href="#2-select-your-service-workgroup" class="table-of-contents__link toc-highlight">2. Select your <code>[service workgroup]</code></a></li><li><a href="#3-exploring-your-service-raw-zone-database" class="table-of-contents__link toc-highlight">3. Exploring your <code>[service raw zone]</code> database</a></li><li><a href="#4-understanding-the-data-model" class="table-of-contents__link toc-highlight">4. Understanding the data model</a></li><li><a href="#5-prepare-your-transform-sql-query" class="table-of-contents__link toc-highlight">5. Prepare your <code>[transform SQL]</code> query</a></li><li><a href="#6-customizing-a-template-query" class="table-of-contents__link toc-highlight">6. Customizing a template query</a></li><li><a href="#7-run-your-transform-sql-query" class="table-of-contents__link toc-highlight">7. Run your <code>[transform SQL]</code> query</a></li><li><a href="#8-review-the-results" class="table-of-contents__link toc-highlight">8. Review the results</a></li><li><a href="#9-save-your-query-as-transform-sql" class="table-of-contents__link toc-highlight">9. Save your query as <code>[transform SQL]</code></a></li><li><a href="#we--your-feedback" class="table-of-contents__link toc-highlight"><strong><em>&quot;We</em> ♡ <em>your feedback!&quot;</em></strong></a></li><li><a href="#ux-criteria" class="table-of-contents__link toc-highlight">📚<code>UX</code> Criteria</a></li><li><a href="#appendix" class="table-of-contents__link toc-highlight">📚Appendix</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.efd05c05.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.aed49b4a.js"></script>
</body>
</html>