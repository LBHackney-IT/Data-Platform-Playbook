"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[3843],{3905:(t,e,o)=>{o.d(e,{Zo:()=>d,kt:()=>f});var r=o(7294);function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function a(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function i(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?a(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function p(t,e){if(null==t)return{};var o,r,n=function(t,e){if(null==t)return{};var o,r,n={},a=Object.keys(t);for(r=0;r<a.length;r++)o=a[r],e.indexOf(o)>=0||(n[o]=t[o]);return n}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)o=a[r],e.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(t,o)&&(n[o]=t[o])}return n}var c=r.createContext({}),l=function(t){var e=r.useContext(c),o=e;return t&&(o="function"==typeof t?t(e):i(i({},e),t)),o},d=function(t){var e=l(t.components);return r.createElement(c.Provider,{value:e},t.children)},s="mdxType",u={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},y=r.forwardRef((function(t,e){var o=t.components,n=t.mdxType,a=t.originalType,c=t.parentName,d=p(t,["components","mdxType","originalType","parentName"]),s=l(o),y=n,f=s["".concat(c,".").concat(y)]||s[y]||u[y]||a;return o?r.createElement(f,i(i({ref:e},d),{},{components:o})):r.createElement(f,i({ref:e},d))}));function f(t,e){var o=arguments,n=e&&e.mdxType;if("string"==typeof t||n){var a=o.length,i=new Array(a);i[0]=y;var p={};for(var c in e)hasOwnProperty.call(e,c)&&(p[c]=e[c]);p.originalType=t,p[s]="string"==typeof t?t:n,i[1]=p;for(var l=2;l<a;l++)i[l]=o[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,o)}y.displayName="MDXCreateElement"},6566:(t,e,o)=>{o.r(e),o.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>p,toc:()=>l});var r=o(7462),n=(o(7294),o(3905));const a={title:"Production to pre-production data sync",description:"Overview of how data is copied from production to pre-production",tags:["playbook"],layout:"layout"},i=void 0,p={unversionedId:"playbook/ingesting-data/production-to-pre-production-sync",id:"playbook/ingesting-data/production-to-pre-production-sync",title:"Production to pre-production data sync",description:"Overview of how data is copied from production to pre-production",source:"@site/docs/playbook/ingesting-data/010-production-to-pre-production-sync.md",sourceDirName:"playbook/ingesting-data",slug:"/playbook/ingesting-data/production-to-pre-production-sync",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/production-to-pre-production-sync",draft:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingesting-data/010-production-to-pre-production-sync.md",tags:[{label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",sidebarPosition:10,frontMatter:{title:"Production to pre-production data sync",description:"Overview of how data is copied from production to pre-production",tags:["playbook"],layout:"layout"},sidebar:"docs",previous:{title:"Ingesting data from an API to the Data Platform",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/ingesting-api-data"},next:{title:"Tips on writing an API Ingestion script for AWS Lambda",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/tips-on-how-to-write-an-API-Lambda-script"}},c={},l=[{value:"Architecture",id:"architecture",level:2},{value:"Production to pre-production sync:",id:"production-to-pre-production-sync",level:3},{value:"Clean up of data older than 90 days:",id:"clean-up-of-data-older-than-90-days",level:3},{value:"Process",id:"process",level:2},{value:"Production to pre-production sync:",id:"production-to-pre-production-sync-1",level:3},{value:"Clean up of data older than 90 days:",id:"clean-up-of-data-older-than-90-days-1",level:3}],d={toc:l},s="wrapper";function u(t){let{components:e,...a}=t;return(0,n.kt)(s,(0,r.Z)({},d,a,{components:e,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"This section explains the process used to copy data from the data platform production environment into pre-production"),(0,n.kt)("h2",{id:"architecture"},"Architecture"),(0,n.kt)("h3",{id:"production-to-pre-production-sync"},"Production to pre-production sync:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"S3-replication",src:o(9638).Z,width:"691",height:"481"})),(0,n.kt)("h3",{id:"clean-up-of-data-older-than-90-days"},"Clean up of data older than 90 days:"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Pre production data cleanup architecture",src:o(706).Z,width:"726",height:"826"})),(0,n.kt)("h2",{id:"process"},"Process"),(0,n.kt)("h3",{id:"production-to-pre-production-sync-1"},"Production to pre-production sync:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Data is ingested via any means into the production zones"),(0,n.kt)("li",{parentName:"ol"},"The data is replicated across to the equivalent pre-production zone in near real time.")),(0,n.kt)("p",null,"Important points:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Only new or updated files are replicated to pre-production at the point they are added or modified in production"),(0,n.kt)("li",{parentName:"ul"},"AWS guarantees 99.9% of files/data is replicated to pre-production within 15 minutes but in reality it is much quicker than this"),(0,n.kt)("li",{parentName:"ul"},"There is no deletion or overwriting of data in pre-production via this method"),(0,n.kt)("li",{parentName:"ul"},"This sync process does not update the glue catalogs in pre-production it only syncs across the raw data files. To make the data visible through Athena the relevant Glue crawler will need to be triggered manually in pre-production")),(0,n.kt)("h3",{id:"clean-up-of-data-older-than-90-days-1"},"Clean up of data older than 90 days:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"When the CI/CD pipeline runs in Github a custom Docker image is built and pushed to the Elastic Container Registry in the Data Platform Pre-Production environment."),(0,n.kt)("li",{parentName:"ol"},"One Elastic Container Service for Raw, Refined and Trusted zone is then created by Terraform in the form of Fargate tasks. These three tasks are configured by Terraform to run on a schedule. At the time of writing this schedule is once a week."),(0,n.kt)("li",{parentName:"ol"},"The script then deletes any data in the pre-production bucket that is older than the configured period"),(0,n.kt)("li",{parentName:"ol"},"At the time of writing this configurable period is 90 days")))}u.isMDXComponent=!0},706:(t,e,o)=>{o.d(e,{Z:()=>r});const r=o.p+"assets/images/pre-prod-data-clean-up-architecture-e58f2ce7ddb1c6fb4d1fe007bf2ec401.png"},9638:(t,e,o)=>{o.d(e,{Z:()=>r});const r=o.p+"assets/images/s3-replication-21ed3542378f336a3a7b4b97576667eb.png"}}]);