"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[907],{7133:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var l=a(4848),t=a(8453);const s={title:"CSV files to Glue Catalog automation",description:"Automatically create or delete AWS Glue Catalog tables when CSV files are uploaded or removed from S3",layout:"playbook_js",tags:["playbook"]},i="CSV files to Glue Catalog automation",o={id:"playbook/ingesting-data/CSV-files-to-Glue-Catalog-automation",title:"CSV files to Glue Catalog automation",description:"Automatically create or delete AWS Glue Catalog tables when CSV files are uploaded or removed from S3",source:"@site/docs/playbook/ingesting-data/014-CSV-files-to-Glue-Catalog-automation.md",sourceDirName:"playbook/ingesting-data",slug:"/playbook/ingesting-data/CSV-files-to-Glue-Catalog-automation",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/CSV-files-to-Glue-Catalog-automation",draft:!1,unlisted:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingesting-data/014-CSV-files-to-Glue-Catalog-automation.md",tags:[{inline:!0,label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",sidebarPosition:14,frontMatter:{title:"CSV files to Glue Catalog automation",description:"Automatically create or delete AWS Glue Catalog tables when CSV files are uploaded or removed from S3",layout:"playbook_js",tags:["playbook"]},sidebar:"docs",previous:{title:"How to create a Lambda function for data ingestion on the Data Analytics Platform",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/creating-a-lambda-function-step-by-step"},next:{title:"Managing DataHub Metadata via Config Files",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/managing-datahub-metadata-via-config-files"}},r={},d=[{value:"1. Prerequisites",id:"1-prerequisites",level:2},{value:"2. Folder Structure &amp; File Naming",id:"2-folder-structure--file-naming",level:2},{value:"Table Names",id:"table-names",level:3},{value:"Notes",id:"notes",level:2},{value:"Using Parking as an Example",id:"using-parking-as-an-example",level:3},{value:"3. Upload CSV files (Console)",id:"3-upload-csv-files-console",level:2},{value:"4. Delete CSV files (Console)",id:"4-delete-csv-files-console",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"csv-files-to-glue-catalog-automation",children:"CSV files to Glue Catalog automation"})}),"\n",(0,l.jsxs)(n.p,{children:["This Lambda automatically creates or deletes AWS Glue Catalog tables whenever\nany departmental user uploads or removes CSV files in the\n",(0,l.jsx)(n.code,{children:"dataplatform-prod-user-uploads"})," S3 bucket."]}),"\n",(0,l.jsx)(n.h2,{id:"1-prerequisites",children:"1. Prerequisites"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"CSV files with a single header row at the top."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"2-folder-structure--file-naming",children:"2. Folder Structure & File Naming"}),"\n",(0,l.jsx)(n.p,{children:"Upload files to your departmental prefix inside the production bucket:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"s3://dataplatform-prod-user-uploads/<department>/<user_prefix>/<file_name>.csv\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"<department>"})," identifies your team (e.g. ",(0,l.jsx)(n.code,{children:"parking"}),", ",(0,l.jsx)(n.code,{children:"housing"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"<user_prefix>"})," ",(0,l.jsx)(n.strong,{children:"must"})," be a folder named after the uploader (e.g.\n",(0,l.jsx)(n.code,{children:"davina"}),", ",(0,l.jsx)(n.code,{children:"mike"}),"). Each uploader should keep their files under their own\nprefix."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"<file_name>"})," should describe the data set (e.g. ",(0,l.jsx)(n.code,{children:"permits_march.csv"}),")."]}),"\n",(0,l.jsxs)(n.li,{children:["Only ",(0,l.jsx)(n.code,{children:".csv"})," files are supported; other extensions are rejected."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"table-names",children:"Table Names"}),"\n",(0,l.jsx)(n.p,{children:"The table name is generated automatically as:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'normalize(<user_name>) + "_" + normalize(<file_name without .csv>)\n'})}),"\n",(0,l.jsx)(n.p,{children:"Normalization replaces non-alphanumeric characters with underscores and\ncollapses consecutive underscores into one."}),"\n",(0,l.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.em,{children:"Visibility:"})," Every member of your department can currently see the CSV files and Glue tables created from these uploads, not just those stored under their own ",(0,l.jsx)(n.code,{children:"<user_prefix>"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.em,{children:"Schema:"})," All columns in the generated Glue tables are currently created as ",(0,l.jsx)(n.code,{children:"string"})," types."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.em,{children:"Upload location:"})," Place one or more CSV files per upload. Not allowed to add additional subfolders beneath your ",(0,l.jsx)(n.code,{children:"<user_prefix>"})," folder."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"using-parking-as-an-example",children:"Using Parking as an Example"}),"\n",(0,l.jsx)(n.p,{children:"Parking users upload to:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"s3://dataplatform-prod-user-uploads/parking/davina/permits_march.csv\n"})}),"\n",(0,l.jsxs)(n.p,{children:["This generates the table ",(0,l.jsx)(n.code,{children:"davina_permits_march"})," inside the\n",(0,l.jsx)(n.code,{children:"parking_user_uploads_db"})," Glue database."]}),"\n",(0,l.jsx)(n.h2,{id:"3-upload-csv-files-console",children:"3. Upload CSV files (Console)"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Sign in to the AWS Console and open ",(0,l.jsx)(n.strong,{children:"S3"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Navigate to the ",(0,l.jsx)(n.code,{children:"dataplatform-prod-user-uploads"})," bucket."]}),"\n",(0,l.jsxs)(n.li,{children:["Browse into your department folder (e.g. ",(0,l.jsx)(n.code,{children:"parking/"}),")."]}),"\n",(0,l.jsx)(n.li,{children:"Create a folder named after yourself (if it doesn\u2019t already exist) and open it."}),"\n",(0,l.jsxs)(n.li,{children:["Click ",(0,l.jsx)(n.strong,{children:"Upload"})," \u2192 ",(0,l.jsx)(n.strong,{children:"Add files"})," and choose your CSV files."]}),"\n",(0,l.jsx)(n.li,{children:"Leave default for everything else (e.g. permissions/encryption (SSE-S3), etc.)."}),"\n",(0,l.jsxs)(n.li,{children:["Click ",(0,l.jsx)(n.strong,{children:"Upload"}),"."]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Processing takes less than a minute. When complete:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["The CSV is stored at ",(0,l.jsx)(n.code,{children:"<department>/<user_prefix>/<file_name>.csv"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["A Glue table with the generated name appears in the department upload\ndatabase (currently ",(0,l.jsx)(n.code,{children:"parking_user_uploads_db"})," for the Parking workflow)."]}),"\n",(0,l.jsx)(n.li,{children:"You can query the table immediately in Athena."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"4-delete-csv-files-console",children:"4. Delete CSV files (Console)"}),"\n",(0,l.jsx)(n.p,{children:"Deleting the CSV removes the corresponding Glue table."}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["In S3, select the CSV under ",(0,l.jsx)(n.code,{children:"<department>/<user_prefix>/"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Choose ",(0,l.jsx)(n.strong,{children:"Delete"})," and confirm."]}),"\n",(0,l.jsx)(n.li,{children:"Within less than a minute the table disappears from Glue/Athena."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>o});var l=a(6540);const t={},s=l.createContext(t);function i(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);