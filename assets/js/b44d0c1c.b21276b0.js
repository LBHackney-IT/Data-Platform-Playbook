"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[2430],{5200:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var s=t(4848),n=t(8453);const o={id:"spatial-data-processing",title:"Spatial Data Processing - ADR 015",description:"",tags:["adr"],number:"15","date-issued":"2021-03-23",status:"Proposed"},i=void 0,r={id:"architecture-decisions/records/spatial-data-processing",title:"Spatial Data Processing - ADR 015",description:"",source:"@site/docs/architecture-decisions/records/015-spatial-data-processing.md",sourceDirName:"architecture-decisions/records",slug:"/architecture-decisions/records/spatial-data-processing",permalink:"/Data-Platform-Playbook/architecture-decisions/records/spatial-data-processing",draft:!1,unlisted:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/architecture-decisions/records/015-spatial-data-processing.md",tags:[{inline:!0,label:"adr",permalink:"/Data-Platform-Playbook/tags/adr"}],version:"current",sidebarPosition:15,frontMatter:{id:"spatial-data-processing",title:"Spatial Data Processing - ADR 015",description:"",tags:["adr"],number:"15","date-issued":"2021-03-23",status:"Proposed"},sidebar:"docs",previous:{title:"Initial Extract of Tenure Data  - ADR 014",permalink:"/Data-Platform-Playbook/architecture-decisions/records/initial-extract-of-tenure-data"},next:{title:"Amundsen deployment",permalink:"/Data-Platform-Playbook/spikes/amundsen-deployment"}},c={},d=[{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2}];function l(e){const a={a:"a",h2:"h2",li:"li",p:"p",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.h2,{id:"context",children:"Context"}),"\n",(0,s.jsx)(a.p,{children:"For many services it is important to know which ward, LSOA or NHS area a specific record relates to. To provide this information we need to perform spatial joins between"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"the service area records, georeferenced by UPRNs or spatial coordinates"}),"\n",(0,s.jsx)(a.li,{children:"and areas from reference spatial datasets held in the GIS database (Geolive)"}),"\n"]}),"\n",(0,s.jsx)(a.p,{children:"Geometric data types and spatial joins (aka point-on-area operations) are not supported by Pyspark so we have to use an additional library."}),"\n",(0,s.jsx)(a.p,{children:"The natural choice was Spatial Spark, now known as Apache Sedona, a geoprocessing library based on Spark. Unfortunately, we have not been able to install Apache Sedona in Glue, even with the help of AWS support. Other government bodies working with spatial data are recommending to use 'low-level' python libraries such as Shapely (on which Sedona is partly based) and then redevelop the needed functionalities, instead of installing large frameworks."}),"\n",(0,s.jsx)(a.h2,{id:"decision",children:"Decision"}),"\n",(0,s.jsxs)(a.p,{children:["We are using Shapely to decode geometries from our spatial database (encoded in WKB format) and Geopandas to perform spatial joins. An example can be found in the ",(0,s.jsx)(a.a,{href:"https://github.com/LBHackney-IT/Data-Platform/blob/spatial-enrichment-script/scripts/jobs/geospatial/spatial_enrichment.py",children:"Spatial enrichment job"}),"."]}),"\n",(0,s.jsx)(a.h2,{id:"consequences",children:"Consequences"}),"\n",(0,s.jsx)(a.p,{children:"Using Geopandas in our jobs means we need to convert spark dataframes into pandas dataframes before processing them, and then back to Spark dataframes to write the data to S3. These conversions are probably less efficient than using Spark all the way. We can also suspect Sedona works faster with very big datasets. However, Geopandas has been satisfactory with our use cases so far."})]})}function p(e={}){const{wrapper:a}={...(0,n.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,a,t)=>{t.d(a,{R:()=>i,x:()=>r});var s=t(6540);const n={},o=s.createContext(n);function i(e){const a=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),s.createElement(o.Provider,{value:a},e.children)}}}]);