"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[7463],{4839:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var i=n(4848),s=n(8453);const a={title:"3. Step by Step Guide to Forecasting",description:"Step by Step Guide with examples to follow along with",layout:"playbook_js",tags:["playbook"]},o="Time series documentation - Step by Step",r={id:"playbook/querying-and-analysing-data/time-series-analysis/step_by_step_example",title:"3. Step by Step Guide to Forecasting",description:"Step by Step Guide with examples to follow along with",source:"@site/docs/playbook/querying-and-analysing-data/time-series-analysis/3-step_by_step_example.md",sourceDirName:"playbook/querying-and-analysing-data/time-series-analysis",slug:"/playbook/querying-and-analysing-data/time-series-analysis/step_by_step_example",permalink:"/Data-Platform-Playbook/playbook/querying-and-analysing-data/time-series-analysis/step_by_step_example",draft:!1,unlisted:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/querying-and-analysing-data/time-series-analysis/3-step_by_step_example.md",tags:[{inline:!0,label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",sidebarPosition:3,frontMatter:{title:"3. Step by Step Guide to Forecasting",description:"Step by Step Guide with examples to follow along with",layout:"playbook_js",tags:["playbook"]},sidebar:"docs",previous:{title:"2. Basic Time Series helpers",permalink:"/Data-Platform-Playbook/playbook/querying-and-analysing-data/time-series-analysis/basic_helpers"},next:{title:"Exponential Smoothing ETS",permalink:"/Data-Platform-Playbook/playbook/querying-and-analysing-data/time-series-analysis/exponential_smoothing_ets"}},l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"1. Set up",id:"1-set-up",level:2},{value:"Viewing the Data using Print in AWS Glue",id:"viewing-the-data-using-print-in-aws-glue",level:2},{value:"Adding the Helper Functions to our Glue Job",id:"adding-the-helper-functions-to-our-glue-job",level:2},{value:"Reshaping the Data for Forecasting",id:"reshaping-the-data-for-forecasting",level:2},{value:"Putting the reshaped data into a Function",id:"putting-the-reshaped-data-into-a-function",level:2},{value:"Using other functions instead",id:"using-other-functions-instead",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"time-series-documentation---step-by-step",children:"Time series documentation - Step by Step"})}),"\n",(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(t.p,{children:"This guide is for people who are very new to the Data Platform and want to do some forecasting. Can be used alone or conjunction with the other bits of documentation"}),"\n",(0,i.jsx)(t.p,{children:"Using public data which is stored on the Platform"}),"\n",(0,i.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Have access to Pre-Production in AWS Glue (PowerUser)"}),"\n",(0,i.jsx)(t.li,{children:"Your Data ready in Pandas Dataframe format. For this guide, the sample script has already gotten to this stage"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"1-set-up",children:"1. Set up"}),"\n",(0,i.jsx)(t.p,{children:"First let's set up our test Glue Job. There is already one in the AWS Glue Jobs list for us to copy"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"Time Series Forecasting StepByStep\n"})}),"\n",(0,i.jsx)(t.p,{children:"Clone and rename it to Time Series Forecasting StepByStep-[Your Name]"}),"\n",(0,i.jsx)(t.p,{children:"This script will load some public data about Bike Rentals"}),"\n",(0,i.jsx)(t.h2,{id:"viewing-the-data-using-print-in-aws-glue",children:"Viewing the Data using Print in AWS Glue"}),"\n",(0,i.jsx)(t.p,{children:"Most people will have no idea what this data looks like, so let's print the data and see. The print statements are already there to show some of the data and to show its information. So just Run the script"}),"\n",(0,i.jsx)(t.p,{children:"Once the script runs, look at the Output Logs at the bottom of the run, and select the log"}),"\n",(0,i.jsx)(t.p,{children:"You should be able to see the python print outputs at the bottom, click on these to expand and take a look"}),"\n",(0,i.jsx)(t.p,{children:"In particular, the info is interesting"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"<class 'pandas.core.frame.DataFrame'>\nRangeIndex: 4781 entries, 0 to 4780\nData columns (total 8 columns):\n #   Column                   Non-Null Count  Dtype         \n---  ------                   --------------  -----         \n 0   Day                      4781 non-null   object        \n 1   Number of Bicycle Hires  4781 non-null   object        \n 2   import_datetime          4781 non-null   datetime64[ns]\n 3   import_timestamp         4781 non-null   object        \n 4   import_year              4781 non-null   object        \n 5   import_month             4781 non-null   object        \n 6   import_day               4781 non-null   object        \n 7   import_date              4781 non-null   object        \ndtypes: datetime64[ns](1), object(7)\n"})}),"\n",(0,i.jsx)(t.p,{children:"This shows us all the columns, how many values we have and their types. We have a few issues from here"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"The number of Bicycle Hires is not an int or float, but an object."}),"\n",(0,i.jsx)(t.li,{children:"There are multiple columns"}),"\n",(0,i.jsx)(t.li,{children:"The Date is in a separate column rather than in the Index"}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"adding-the-helper-functions-to-our-glue-job",children:"Adding the Helper Functions to our Glue Job"}),"\n",(0,i.jsx)(t.p,{children:"You can import the helper functions by putting this line of code underneath your other imports"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'from scripts.helpers.time_series_helpers import "Your Function"\n'})}),"\n",(0,i.jsx)(t.p,{children:"For what we want to do in this script, let's use these functions"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"reshape_time_series_data: Most Time series functions use a 1 dimensional dataframe with the Date in the Index"}),"\n",(0,i.jsx)(t.li,{children:"forecast_ets: The exponential smoothing ETS method. Requires a start and end date"}),"\n",(0,i.jsx)(t.li,{children:"get_start_end_date: This will give us the start and end date needed"}),"\n"]}),"\n",(0,i.jsx)(n,{children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)("summary",{children:"Completed Import code Spoiler"}),"\nfrom scripts.helpers.time_series_helpers import reshape_time_series_data, forecast_ets, get_start_end_date"]})}),"\n",(0,i.jsx)(t.p,{children:"Next, we want to add the libraries needed into our Glue environment"}),"\n",(0,i.jsxs)(t.p,{children:["Follow this guide on how to do so: ",(0,i.jsx)(t.a,{href:"https://github.com/LBHackney-IT/Data-Platform-Playbook/blob/f8682cb6ff53af1049dc40a9c67dd51aedc5ac6e/docs/playbook/querying-and-analysing-data/time-series-analysis/1-introduction.md#glue-job-prerequisites",children:"Link"})]}),"\n",(0,i.jsx)(t.p,{children:"Now save and run the Glue Script again. There should be no errors, and now you have some functions to use"}),"\n",(0,i.jsx)(t.h2,{id:"reshaping-the-data-for-forecasting",children:"Reshaping the Data for Forecasting"}),"\n",(0,i.jsx)(t.p,{children:"So lets reshape the data so that its in the right shape"}),"\n",(0,i.jsx)(t.p,{children:"You probably noticed that there is this line in the code at the moment"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"bike_data['Number of Bicycle Hires'] = bike_data['Number of Bicycle Hires'].apply(clean_int)\n"})}),"\n",(0,i.jsx)(t.p,{children:"Since this guide is not about cleaning data, we have applied this cleaning step for you"}),"\n",(0,i.jsx)(t.p,{children:"First let's get this data into the desired shape for Time Series Analysis which means having just one metric and the date in the index"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"reshape_time_series_data"})," is the helper to use here, its arguments are"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The Dataframe"}),"\n",(0,i.jsxs)(t.li,{children:["The name of the Date Column so it can move the date into the index. In this case its ",(0,i.jsx)(t.code,{children:'"Day"'})]}),"\n",(0,i.jsxs)(t.li,{children:["The list of columns to include, so for this case its ",(0,i.jsx)(t.code,{children:'["Number of Bicycle Hires"]'})]}),"\n",(0,i.jsxs)(t.li,{children:["Format of the Date, for this dataset its american and is not MM/DD/YYYY so its ",(0,i.jsx)(t.code,{children:' "%m/%d/%y"'})]}),"\n"]}),"\n",(0,i.jsx)(n,{children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)("summary",{children:"Completed Reshape code Spoiler"}),'\nreshaped_data = reshape_time_series_data(bike_data,"Day",["Number of Bicycle Hires"], "%m/%d/%y")']})}),"\n",(0,i.jsxs)(t.p,{children:["We then need the start date and end date. ",(0,i.jsx)(t.code,{children:"get_start_end_date"})," is what we want to use for this."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"The reshaped dataframe"}),"\n",(0,i.jsxs)(t.li,{children:["The period of your time data in the index. For this its ",(0,i.jsx)(t.code,{children:'"D"'})," for days"]}),"\n",(0,i.jsx)(t.li,{children:"How many multiples of that period do you want, so for months you can put 6 for 6 months of data."}),"\n"]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsxs)(t.p,{children:[(0,i.jsx)("summary",{children:"Completed Start End Date code Spoiler"}),'\nstart_date, end_date = get_start_end_date(reshaped_data,"D",180)']}),(0,i.jsx)(t.p,{children:"To get 180 days of data"})]}),"\n",(0,i.jsx)(t.h2,{id:"putting-the-reshaped-data-into-a-function",children:"Putting the reshaped data into a Function"}),"\n",(0,i.jsxs)(t.p,{children:["Now let's use the ",(0,i.jsx)(t.code,{children:"forecast_ets"})," function to get our forecast"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["The dataset as a SERIES. This is important because the reshape function calls the single variable Y. So if your dataframe is called ",(0,i.jsx)(t.code,{children:"reshaped_dataset"})," you will need to put ",(0,i.jsx)(t.code,{children:"reshaped_dataset.y"})]}),"\n",(0,i.jsx)(t.li,{children:"Start date"}),"\n",(0,i.jsx)(t.li,{children:"End Date"}),"\n"]}),"\n",(0,i.jsx)(n,{children:(0,i.jsxs)(t.p,{children:[(0,i.jsx)("summary",{children:"Completed Start End Date code Spoiler"}),"\nforecast = forecast_ets(reshaped_data.y,start_date,end_date)"]})}),"\n",(0,i.jsx)(t.p,{children:"This will return a dataframe with our forecast mean results."}),"\n",(0,i.jsx)(t.h2,{id:"using-other-functions-instead",children:"Using other functions instead"}),"\n",(0,i.jsx)(t.p,{children:"For other functions simply follow the documentation for their respective helper instead of using the forecast_ets helpers"}),"\n",(0,i.jsx)(t.p,{children:"and that's all we need. Just a few lines of code to copy and you get some forecasting. Now you need to figure out what you want to do with this forecast, but that won't be covered here"})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>r});var i=n(6540);const s={},a=i.createContext(s);function o(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);