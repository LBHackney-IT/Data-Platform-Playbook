"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[4368],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},b=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(a),b=o,h=c["".concat(s,".").concat(b)]||c[b]||u[b]||r;return a?n.createElement(h,i(i({ref:t},p),{},{components:a})):n.createElement(h,i({ref:t},p))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=b;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}b.displayName="MDXCreateElement"},2786:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=a(7462),o=(a(7294),a(3905));const r={title:"Backdated Liberator data ingestion",description:"Description of the backdated ingestion process for Liberator data",layout:"playbook_js",tags:["playbook"]},i=void 0,l={unversionedId:"docs/backdated-liberator-ingestion",id:"docs/backdated-liberator-ingestion",title:"Backdated Liberator data ingestion",description:"Description of the backdated ingestion process for Liberator data",source:"@site/docs/docs/backdated-liberator-ingestion.md",sourceDirName:"docs",slug:"/docs/backdated-liberator-ingestion",permalink:"/Data-Platform-Playbook/docs/backdated-liberator-ingestion",draft:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/docs/backdated-liberator-ingestion.md",tags:[{label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",frontMatter:{title:"Backdated Liberator data ingestion",description:"Description of the backdated ingestion process for Liberator data",layout:"playbook_js",tags:["playbook"]},sidebar:"docs",previous:{title:"Auto-adjusting AWS Budget Alerts",permalink:"/Data-Platform-Playbook/docs/auto-adjusting-aws-budget"},next:{title:"Exporting database snapshots to the Data Platform Landing Zone",permalink:"/Data-Platform-Playbook/docs/exporting-snapshot-to-landing-zone"}},s={},d=[{value:"1. Disable Cloudwatch s3 event trigger (optional)",id:"1-disable-cloudwatch-s3-event-trigger-optional",level:4},{value:"2. Trigger the ECS task to start the backdated ingestion process",id:"2-trigger-the-ecs-task-to-start-the-backdated-ingestion-process",level:4},{value:"3. Automated ingestion of backdated liberator data starts",id:"3-automated-ingestion-of-backdated-liberator-data-starts",level:4},{value:"4. Enable Cloudwatch s3 event trigger (optional)",id:"4-enable-cloudwatch-s3-event-trigger-optional",level:4}],p={toc:d},c="wrapper";function u(e){let{components:t,...a}=e;return(0,o.kt)(c,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"This section describes how a previous days Liberator dataset can be ingested onto the data platform. "),(0,o.kt)("h4",{id:"1-disable-cloudwatch-s3-event-trigger-optional"},"1. Disable Cloudwatch s3 event trigger (optional)"),(0,o.kt)("p",null,"The company who owns the dataset (Farthest Gate) uploads a zipped SQL dump of the whole database to S3 bucket in the data platform production AWS account at the path ",(0,o.kt)("inlineCode",{parentName:"p"},"s3://dataplatform-prod-liberator-data-storage/parking/"),".\nThe file needs to be named ",(0,o.kt)("inlineCode",{parentName:"p"},"liberator_dump_210604.zip")," where the date stamp at the end is the current date."),(0,o.kt)("p",null,"If this file has not been uploaded then you will need to obtain it from Farthest Gate and upload manually. If this is the case then\nyou will also need to disable the cloudwatch trigger before uploading"),(0,o.kt)("p",null,"Open Cloudwatch and search for ",(0,o.kt)("inlineCode",{parentName:"p"},"liberator-to-rds-snapshot-event")," and disable the trigger"),(0,o.kt)("h4",{id:"2-trigger-the-ecs-task-to-start-the-backdated-ingestion-process"},"2. Trigger the ECS task to start the backdated ingestion process"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Open ECS and in ",(0,o.kt)("inlineCode",{parentName:"li"},"Task Definitions")," select ",(0,o.kt)("inlineCode",{parentName:"li"},"liberator-to-rds-snapshot")),(0,o.kt)("li",{parentName:"ul"},"Click on the ",(0,o.kt)("inlineCode",{parentName:"li"},"Actions")," dropdown and select ",(0,o.kt)("inlineCode",{parentName:"li"},"Run Task")),(0,o.kt)("li",{parentName:"ul"},"This next page includes a lot of options, unless specified below leave all options as they are:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Cluster: ",(0,o.kt)("inlineCode",{parentName:"li"},"dataplatform-prod-workers")),(0,o.kt)("li",{parentName:"ul"},"Launch Type: ",(0,o.kt)("inlineCode",{parentName:"li"},"FARGATE")),(0,o.kt)("li",{parentName:"ul"},"Operating System Family: ",(0,o.kt)("inlineCode",{parentName:"li"},"Linux")),(0,o.kt)("li",{parentName:"ul"},"Cluster VPC: Select the one VPC available"),(0,o.kt)("li",{parentName:"ul"},"Subnets: Select all subnets available one by one"),(0,o.kt)("li",{parentName:"ul"},"Auto-assign public IP: ",(0,o.kt)("inlineCode",{parentName:"li"},"DISABLED")),(0,o.kt)("li",{parentName:"ul"},"Expand the ",(0,o.kt)("inlineCode",{parentName:"li"},"Advanced options")," section:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"In ",(0,o.kt)("inlineCode",{parentName:"li"},"Container Overrides")," expand the ",(0,o.kt)("inlineCode",{parentName:"li"},"liberator-to-rds-snapshot")," section:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Click on  ",(0,o.kt)("inlineCode",{parentName:"li"},"Add Environment Variable")),(0,o.kt)("li",{parentName:"ul"},"Set the key to ",(0,o.kt)("inlineCode",{parentName:"li"},"IMPORT_DATE_OVERRIDE")),(0,o.kt)("li",{parentName:"ul"},"Set the value to the date used in the liberator dump file you wish to ingest. This date must be in the following format: yyyy-mm-dd eg. 2022-06-01"))))))),(0,o.kt)("li",{parentName:"ul"},"Click ",(0,o.kt)("inlineCode",{parentName:"li"},"Run Task")," at the bottom of the page")),(0,o.kt)("h4",{id:"3-automated-ingestion-of-backdated-liberator-data-starts"},"3. Automated ingestion of backdated liberator data starts"),(0,o.kt)("p",null,"From here the ingestion is fully automated and closely follows the normal liberator\ningestion process detailed in ",(0,o.kt)("a",{parentName:"p",href:"/Data-Platform-Playbook/docs/liberator-ingestion"},"Liberator Ingestion Process")),(0,o.kt)("p",null,"The difference between the normal liberator process and this one is that the date used to ingest from is taken from the ",(0,o.kt)("inlineCode",{parentName:"p"},"IMPORT_DATE_OVERIDE")," environment\nvariable that you input in step 2 instead of always assuming we are ingesting data for the current day"),(0,o.kt)("p",null,"This process triggers a backdated glue workflow that will transfer the data from the landing\nzone into the raw zone in the correct partition. This glue workflow is called ",(0,o.kt)("inlineCode",{parentName:"p"},"parking-liberator-backdated-data-workflow")),(0,o.kt)("p",null,"When finished the backdated liberator data will be ingested into the raw zone\nin the partition date that matches the ",(0,o.kt)("inlineCode",{parentName:"p"},"IMPORT_DATE_OVERIDE")," environment variable that you input in step 2"),(0,o.kt)("h4",{id:"4-enable-cloudwatch-s3-event-trigger-optional"},"4. Enable Cloudwatch s3 event trigger (optional)"),(0,o.kt)("p",null,"Please enable the cloudwatch trigger that you disabled in step 1. This is very important otherwise the next days liberator ingestion will not happen"))}u.isMDXComponent=!0}}]);