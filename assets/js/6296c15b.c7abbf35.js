"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[907],{7133:(e,l,n)=>{n.r(l),n.d(l,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var a=n(4848),t=n(8453);const o={title:"CSV files to Glue Catalog automation",description:"Automatically create or delete AWS Glue Catalog tables when CSV files are uploaded or removed from S3",layout:"playbook_js",tags:["playbook"]},s="CSV files to Glue Catalog automation",i={id:"playbook/ingesting-data/CSV-files-to-Glue-Catalog-automation",title:"CSV files to Glue Catalog automation",description:"Automatically create or delete AWS Glue Catalog tables when CSV files are uploaded or removed from S3",source:"@site/docs/playbook/ingesting-data/014-CSV-files-to-Glue-Catalog-automation.md",sourceDirName:"playbook/ingesting-data",slug:"/playbook/ingesting-data/CSV-files-to-Glue-Catalog-automation",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/CSV-files-to-Glue-Catalog-automation",draft:!1,unlisted:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingesting-data/014-CSV-files-to-Glue-Catalog-automation.md",tags:[{inline:!0,label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",sidebarPosition:14,frontMatter:{title:"CSV files to Glue Catalog automation",description:"Automatically create or delete AWS Glue Catalog tables when CSV files are uploaded or removed from S3",layout:"playbook_js",tags:["playbook"]},sidebar:"docs",previous:{title:"How to create a Lambda function for data ingestion on the Data Analytics Platform",permalink:"/Data-Platform-Playbook/playbook/ingesting-data/creating-a-lambda-function-step-by-step"},next:{title:"Export data catalog table or view to Google Sheets",permalink:"/Data-Platform-Playbook/playbook/exporting-data/save-glue-catalog-to-google-sheet"}},r={},d=[{value:"1. Prerequisites",id:"1-prerequisites",level:2},{value:"2. Folder Structure &amp; File Naming",id:"2-folder-structure--file-naming",level:2},{value:"Table Names",id:"table-names",level:3},{value:"Notes",id:"notes",level:2},{value:"Using Parking as an Example",id:"using-parking-as-an-example",level:3},{value:"3. Upload CSV files (Console)",id:"3-upload-csv-files-console",level:2},{value:"4. Delete CSV files (Console)",id:"4-delete-csv-files-console",level:2}];function c(e){const l={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.header,{children:(0,a.jsx)(l.h1,{id:"csv-files-to-glue-catalog-automation",children:"CSV files to Glue Catalog automation"})}),"\n",(0,a.jsxs)(l.p,{children:["This Lambda automatically creates or deletes AWS Glue Catalog tables whenever\nany departmental user uploads or removes CSV files in the\n",(0,a.jsx)(l.code,{children:"dataplatform-prod-user-uploads"})," S3 bucket."]}),"\n",(0,a.jsx)(l.h2,{id:"1-prerequisites",children:"1. Prerequisites"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"CSV files with a single header row at the top."}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"2-folder-structure--file-naming",children:"2. Folder Structure & File Naming"}),"\n",(0,a.jsx)(l.p,{children:"Upload files to your departmental prefix inside the production bucket:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{children:"s3://dataplatform-prod-user-uploads/<department>/<user_prefix>/<file_name>.csv\n"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.code,{children:"<department>"})," identifies your team (e.g. ",(0,a.jsx)(l.code,{children:"parking"}),", ",(0,a.jsx)(l.code,{children:"housing"}),")."]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.code,{children:"<user_prefix>"})," ",(0,a.jsx)(l.strong,{children:"must"})," be a folder named after the uploader (e.g.\n",(0,a.jsx)(l.code,{children:"davina"}),", ",(0,a.jsx)(l.code,{children:"mike"}),"). Each uploader should keep their files under their own\nprefix."]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.code,{children:"<file_name>"})," should describe the data set (e.g. ",(0,a.jsx)(l.code,{children:"permits_march.csv"}),")."]}),"\n",(0,a.jsxs)(l.li,{children:["Only ",(0,a.jsx)(l.code,{children:".csv"})," files are supported; other extensions are rejected."]}),"\n"]}),"\n",(0,a.jsx)(l.h3,{id:"table-names",children:"Table Names"}),"\n",(0,a.jsx)(l.p,{children:"The table name is generated automatically as:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{children:'normalize(<user_name>) + "_" + normalize(<file_name without .csv>)\n'})}),"\n",(0,a.jsx)(l.p,{children:"Normalization replaces non-alphanumeric characters with underscores and\ncollapses consecutive underscores into one."}),"\n",(0,a.jsx)(l.h2,{id:"notes",children:"Notes"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.em,{children:"Visibility:"})," Every member of your department can currently see the CSV files and Glue tables created from these uploads, not just those stored under their own ",(0,a.jsx)(l.code,{children:"<user_prefix>"}),"."]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.em,{children:"Schema:"})," All columns in the generated Glue tables are currently created as ",(0,a.jsx)(l.code,{children:"string"})," types."]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.em,{children:"Upload location:"})," Place one or more CSV files per upload. Not allowed to add additional subfolders beneath your ",(0,a.jsx)(l.code,{children:"<user_prefix>"})," folder."]}),"\n"]}),"\n",(0,a.jsx)(l.h3,{id:"using-parking-as-an-example",children:"Using Parking as an Example"}),"\n",(0,a.jsx)(l.p,{children:"Parking users upload to:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{children:"s3://dataplatform-prod-user-uploads/parking/davina/permits_march.csv\n"})}),"\n",(0,a.jsxs)(l.p,{children:["This generates the table ",(0,a.jsx)(l.code,{children:"davina_permits_march"})," inside the\n",(0,a.jsx)(l.code,{children:"parking_user_uploads_db"})," Glue database."]}),"\n",(0,a.jsx)(l.h2,{id:"3-upload-csv-files-console",children:"3. Upload CSV files (Console)"}),"\n",(0,a.jsxs)(l.ol,{children:["\n",(0,a.jsxs)(l.li,{children:["Sign in to the AWS Console and open ",(0,a.jsx)(l.strong,{children:"S3"}),"."]}),"\n",(0,a.jsxs)(l.li,{children:["Navigate to the ",(0,a.jsx)(l.code,{children:"dataplatform-prod-user-uploads"})," bucket."]}),"\n",(0,a.jsxs)(l.li,{children:["Browse into your department folder (e.g. ",(0,a.jsx)(l.code,{children:"parking/"}),")."]}),"\n",(0,a.jsx)(l.li,{children:"Create a folder named after yourself (if it doesn\u2019t already exist) and open it."}),"\n",(0,a.jsxs)(l.li,{children:["Click ",(0,a.jsx)(l.strong,{children:"Upload"})," \u2192 ",(0,a.jsx)(l.strong,{children:"Add files"})," and choose your CSV files."]}),"\n",(0,a.jsx)(l.li,{children:"Leave default for everything else (e.g. permissions/encryption (SSE-S3), etc.)."}),"\n",(0,a.jsxs)(l.li,{children:["Click ",(0,a.jsx)(l.strong,{children:"Upload"}),"."]}),"\n"]}),"\n",(0,a.jsx)(l.p,{children:"Processing takes less than a minute. When complete:"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["The CSV is stored at ",(0,a.jsx)(l.code,{children:"<department>/<user_prefix>/<file_name>.csv"}),"."]}),"\n",(0,a.jsxs)(l.li,{children:["A Glue table with the generated name appears in the department upload\ndatabase (currently ",(0,a.jsx)(l.code,{children:"parking_user_uploads_db"})," for the Parking workflow)."]}),"\n",(0,a.jsx)(l.li,{children:"You can query the table immediately in Athena."}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"4-delete-csv-files-console",children:"4. Delete CSV files (Console)"}),"\n",(0,a.jsx)(l.p,{children:"Deleting the CSV removes the corresponding Glue table."}),"\n",(0,a.jsxs)(l.ol,{children:["\n",(0,a.jsxs)(l.li,{children:["In S3, select the CSV under ",(0,a.jsx)(l.code,{children:"<department>/<user_prefix>/"}),"."]}),"\n",(0,a.jsxs)(l.li,{children:["Choose ",(0,a.jsx)(l.strong,{children:"Delete"})," and confirm."]}),"\n",(0,a.jsx)(l.li,{children:"Within less than a minute the table disappears from Glue/Athena."}),"\n"]})]})}function h(e={}){const{wrapper:l}={...(0,t.R)(),...e.components};return l?(0,a.jsx)(l,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,l,n)=>{n.d(l,{R:()=>s,x:()=>i});var a=n(6540);const t={},o=a.createContext(t);function s(e){const l=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(l):{...l,...e}}),[l,e])}function i(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),a.createElement(o.Provider,{value:l},e.children)}}}]);