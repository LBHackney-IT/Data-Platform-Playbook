"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[1298],{5296:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>n,metadata:()=>s,toc:()=>c});var o=i(4848),r=i(8453);const n={id:"sftp-to-s3-lambda",title:"Copy Liberator data from sftp to s3 - ADR 007",description:"Retrieve daily zip file from SFTP server and upload to S3 (landing zone bucket)",tags:["adr"],number:"007","date-issued":"2021-05-28",status:"Accepted"},a=void 0,s={id:"architecture-decisions/records/sftp-to-s3-lambda",title:"Copy Liberator data from sftp to s3 - ADR 007",description:"Retrieve daily zip file from SFTP server and upload to S3 (landing zone bucket)",source:"@site/docs/architecture-decisions/records/007-sftp-to-s3-lambda.md",sourceDirName:"architecture-decisions/records",slug:"/architecture-decisions/records/sftp-to-s3-lambda",permalink:"/Data-Platform-Playbook/architecture-decisions/records/sftp-to-s3-lambda",draft:!1,unlisted:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/architecture-decisions/records/007-sftp-to-s3-lambda.md",tags:[{inline:!0,label:"adr",permalink:"/Data-Platform-Playbook/tags/adr"}],version:"current",sidebarPosition:7,frontMatter:{id:"sftp-to-s3-lambda",title:"Copy Liberator data from sftp to s3 - ADR 007",description:"Retrieve daily zip file from SFTP server and upload to S3 (landing zone bucket)",tags:["adr"],number:"007","date-issued":"2021-05-28",status:"Accepted"},sidebar:"docs",previous:{title:"Ingest SQL flat files - ADR 006",permalink:"/Data-Platform-Playbook/architecture-decisions/records/ingest-sql-flat-files"},next:{title:"Production Data in Staging - ADR 008",permalink:"/Data-Platform-Playbook/architecture-decisions/records/production-data-in-staging"}},d={},c=[{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2}];function l(e){const t={h2:"h2",p:"p",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"context",children:"Context"}),"\n",(0,o.jsx)(t.p,{children:"An SQL dump of the liberator database is put in a SFTP server as a zip file by a supplier. This data is important to the parking team so we need to ingest it into the platform. In order to do this we first need to move the data from the SFTP server into the landing zone S3 bucket."}),"\n",(0,o.jsx)(t.p,{children:"There was also the option to pay for the supplier to directly drop the file into S3."}),"\n",(0,o.jsx)(t.h2,{id:"decision",children:"Decision"}),"\n",(0,o.jsx)(t.p,{children:"We will use a lambda function to achieve this. The function will run at 06:00 UTC, triggered by a cloudwatch event, finding the file date stamped for that day then streaming it into the given S3 bucket."}),"\n",(0,o.jsx)(t.p,{children:"It finds the file by searching for a filename pattern, if there is more than one file that matches then it will get all of them."}),"\n",(0,o.jsx)(t.p,{children:"The connection details for the SFTP server are stored in ssm parameter store."}),"\n",(0,o.jsx)(t.h2,{id:"consequences",children:"Consequences"}),"\n",(0,o.jsx)(t.p,{children:"This lambda function is not currenlty reusable as we need to search for the correct file in the server before retrieving it, which is not generic. Further work could be done to seperate this out, if required."})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>s});var o=i(6540);const r={},n=o.createContext(r);function a(e){const t=o.useContext(n);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(n.Provider,{value:t},e.children)}}}]);