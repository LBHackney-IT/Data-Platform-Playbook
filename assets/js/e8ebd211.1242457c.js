"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[9633],{6796:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>r});var a=t(4848),i=t(8453);const s={title:"Datahub deployment",description:"Review datahub as a potential solution for a data catalogue",tags:["tech-spike"],layout:"layout"},o=void 0,l={id:"spikes/datahub-deployment",title:"Datahub deployment",description:"Review datahub as a potential solution for a data catalogue",source:"@site/docs/spikes/datahub-deployment.md",sourceDirName:"spikes",slug:"/spikes/datahub-deployment",permalink:"/Data-Platform-Playbook/spikes/datahub-deployment",draft:!1,unlisted:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/spikes/datahub-deployment.md",tags:[{inline:!0,label:"tech-spike",permalink:"/Data-Platform-Playbook/tags/tech-spike"}],version:"current",frontMatter:{title:"Datahub deployment",description:"Review datahub as a potential solution for a data catalogue",tags:["tech-spike"],layout:"layout"},sidebar:"docs",previous:{title:"Data Quality Testing",permalink:"/Data-Platform-Playbook/spikes/data-quality-testing"},next:{title:"Ingesting data from MSSQL database",permalink:"/Data-Platform-Playbook/spikes/mssql-ingestion"}},d={},r=[{value:"Objective",id:"objective",level:2},{value:"Considerations",id:"considerations",level:2},{value:"Findings",id:"findings",level:2},{value:"Docker/container setup (via compose, ECS, Fargate etc)",id:"dockercontainer-setup-via-compose-ecs-fargate-etc",level:3},{value:"SSO",id:"sso",level:3},{value:"Role Based Access Control",id:"role-based-access-control",level:3},{value:"Summary",id:"summary",level:2},{value:"Limitations",id:"limitations",level:4},{value:"Suggestions",id:"suggestions",level:4},{value:"Helpful Resources / Documentation",id:"helpful-resources--documentation",level:2},{value:"Deploying to EC2",id:"deploying-to-ec2",level:3},{value:"Deploying to EKS",id:"deploying-to-eks",level:3},{value:"Makefile",id:"makefile",level:5},{value:"Data Ingestion",id:"data-ingestion",level:4},{value:"DNS configuration",id:"dns-configuration",level:4}];function c(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"objective",children:"Objective"}),"\n",(0,a.jsx)(n.p,{children:"Confirm that the data catalog meets the minimum expectations for infrastructure and security so that it can be maintained long term"}),"\n",(0,a.jsx)(n.h2,{id:"considerations",children:"Considerations"}),"\n",(0,a.jsx)(n.p,{children:"The following criteria were to be investigated"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Docker/container setup (via compose, ECS, Fargate etc)"}),"\n",(0,a.jsx)(n.li,{children:"SSO"}),"\n",(0,a.jsx)(n.li,{children:"Role Based Access Control"}),"\n",(0,a.jsx)(n.li,{children:"Notifications/Alerts"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"findings",children:"Findings"}),"\n",(0,a.jsx)(n.h3,{id:"dockercontainer-setup-via-compose-ecs-fargate-etc",children:"Docker/container setup (via compose, ECS, Fargate etc)"}),"\n",(0,a.jsx)(n.p,{children:"Deploying this with docker and ECS was not feasible due to the number of dependencies."}),"\n",(0,a.jsxs)(n.p,{children:["Datahub provides ",(0,a.jsx)(n.a,{href:"https://datahubproject.io/docs/deploy/aws",children:"documentation"})," on how to deploy using Kubernetes and AWS EKS. Due to a lack of kubernetes expertise, this route was not further explored."]}),"\n",(0,a.jsxs)(n.p,{children:["Finally, we got deployed datahub by ",(0,a.jsx)(n.a,{href:"https://gist.github.com/elena-vi/032b3f4aba12a8e1d0ed8e7cb05fd66e",children:"provisioning an ec2 instance"}),", connecting to the instace though SSH, cloning the ",(0,a.jsx)(n.a,{href:"https://github.com/linkedin/datahub",children:"datahub repository"})," in the instance, and running datahub via ",(0,a.jsx)(n.code,{children:"docker-compose"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"sso",children:"SSO"}),"\n",(0,a.jsxs)(n.p,{children:["You can ",(0,a.jsx)(n.a,{href:"https://datahubproject.io/docs/how/auth/sso/configure-oidc-react/",children:"enable OIDC SSO"})," in React application (datahub frontend)."]}),"\n",(0,a.jsx)(n.p,{children:"This was not investigated in this spike due to lack of time."}),"\n",(0,a.jsx)(n.h3,{id:"role-based-access-control",children:"Role Based Access Control"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"Limitation:"})," Not reviewed as part of the spike, ran out of time."]}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.h4,{id:"limitations",children:"Limitations"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Could not get DataHub CLI with the deployment process specified above to work"}),"\n",(0,a.jsx)(n.li,{children:"Must ensure a process for constantly re-cloning the repo for updates"}),"\n",(0,a.jsx)(n.li,{children:"Datahub has various dependencies"}),"\n",(0,a.jsx)(n.li,{children:"There are no obvious solutions for notifications or alerts"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"suggestions",children:"Suggestions"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Investigate datahub SAAS as an option"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"helpful-resources--documentation",children:"Helpful Resources / Documentation"}),"\n",(0,a.jsx)(n.h3,{id:"deploying-to-ec2",children:"Deploying to EC2"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"To deploy datahub, ensure an EC2 instance with at least 4GM memory to be able to run datahub docker"}),"\n",(0,a.jsx)(n.li,{children:"SSH into the instance and run the following:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"sudo yum update -y\n\nsudo amazon-linux-extras install docker\n\nsudo service docker start\n\nsudo usermod -a -G docker ec2-user\n\n# restart connection\n\nsudo yum install git -y\n  # install docer-compose\nsudo curl -L https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m) -o /usr/local/bin/docker-compose\n\nsudo chmod +x /usr/local/bin/docker-compose\n  # download datahub\ngit clone https://github.com/linkedin/datahub.git\n\ncd datahub/docker/quickstart\n  # start datahub\ndocker-compose -f docker-compose.quickstart.yml up -d\n\ncd ../../metadata-ingestion/examples/recipes/\nvi glue_to_datahub.yml # add params\n\npython3 -m pip install --upgrade pip wheel setuptools\n\npip install 'acryl-datahub[glue]'\n\ndatahub ingest -c glue_to_datahub.yml\n"})}),"\n",(0,a.jsx)(n.h3,{id:"deploying-to-eks",children:"Deploying to EKS"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["To deploy datahub to EKS we used eksctl, helm and kubectl using the following ",(0,a.jsx)(n.a,{href:"https://datahubproject.io/docs/deploy/aws",children:"guide"})]}),"\n",(0,a.jsx)(n.li,{children:"When deploying to a production environment we would prefer to deploy using terraform."}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["We have added helper files to the data platform project under the ",(0,a.jsx)(n.code,{children:"datahub-deployment"})," directory. This directory includes:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["A ",(0,a.jsx)(n.a,{href:"https://github.com/LBHackney-IT/Data-Platform/blob/datahub-eks-deployment/datahub-deployment/Makefile",children:"makefile"})," with commands for various common tasks"]}),"\n",(0,a.jsx)(n.li,{children:"A values.yaml file which contains a helm config for the datahub chart"}),"\n",(0,a.jsxs)(n.li,{children:["A kubeconfig file with the details for connecting to staging eks cluster","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Note: The file does NOT contain credentials, your aws credentials are used"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h5,{id:"makefile",children:"Makefile"}),"\n",(0,a.jsx)(n.p,{children:"The make file contains the following commands:"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"generate-kubeconfig-file"}),"\nCreates or updates the kubeconfig file for the staging cluster"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"get-all"}),"\nGet information about all the resources running in the cluster"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"upgrade-datahub-release"}),"\nUpdates the datahub images to the latest version"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"datahub-release-history"}),"\nPrints historical revisions for a given release"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"pull-datahub-repository"}),"\nPull the latest datahub helm repository"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"datahub-source"}),"\nGit clone the datahub project repo to your current location"]}),"\n",(0,a.jsx)(n.h4,{id:"data-ingestion",children:"Data Ingestion"}),"\n",(0,a.jsxs)(n.p,{children:["To ingest data into the data catalogue we followed this guide: ",(0,a.jsx)(n.a,{href:"https://datahubproject.io/docs/metadata-ingestion",children:"Metadata Ingestion"})]}),"\n",(0,a.jsx)(n.p,{children:"This involved installing the PyPI prerequisites on a engineer machine using the following commands:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:'python3 -m venv venv\nsource venv/bin/activate\npip3 install --upgrade pip wheel setuptools\npip3 install --upgrade acryl-datahub\ndatahub version\n# If you see "command not found", try running this instead: python3 -m datahub version\n'})}),"\n",(0,a.jsx)(n.p,{children:"Once the prerequisites had been installed we needed to install the specific plugin that we need in order to be able to\ningest data from the data platform. In this case we installed the glue plugin which allowed us to ingest data from the\nGlue data catalogue."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"pip3 install 'acryl-datahub[glue]' # install the required plugin\ndatahub check plugins\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Once the prerequisites and the required plugins are installed you can then ingest the data from the glue catalogue by locate and update the glue_to_datahub.yml metadata ingestion example receipe which can be found here: ",(0,a.jsx)(n.a,{href:"https://github.com/linkedin/datahub/blob/master/metadata-ingestion/examples/recipes/glue_to_datahub.yml",children:"/metadata-ingestion/examples/recipes/glue_to_datahub.yml"})]}),"\n",(0,a.jsx)(n.p,{children:"The contents of which should look as below:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'# see https://datahubproject.io/docs/metadata-ingestion/source_docs/glue for complete documentation\nsource:\n  type: glue\n  config:\n    aws_region: "us-west-2"\n    extract_transforms: true\n\n# see https://datahubproject.io/docs/metadata-ingestion/sink_docs/datahub for complete documentation\nsink:\n  type: "datahub-rest"\n  config:\n    server: "http://localhost:8080"\n'})}),"\n",(0,a.jsx)(n.p,{children:"You will need to update the following properties:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"source -> config -> aws_region"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"sink -> config -> server"})}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"With values which reflect the staging environment. One you have updated the recipe configuration you can run the\ningestion with the following command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh/",children:"datahub ingest -c ./metadata-ingestion/examples/recipes/glue_to_datahub.yml\n"})}),"\n",(0,a.jsx)(n.h4,{id:"dns-configuration",children:"DNS configuration"}),"\n",(0,a.jsx)(n.p,{children:"When setting up the DataHub data catalogue site we required both a security certificate and a domain name to be associatable with the Kubernetes cluster."}),"\n",(0,a.jsx)(n.p,{children:"To accomplish this we:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Created a Name Server (NS) record on the Hackney domain for the data.hackney.gov.uk sub-domain. ",(0,a.jsx)(n.a,{href:"https://github.com/LBHackney-IT/infrastructure/pull/456/files#diff-ca01997613717d7b58e624d2faf9e939b9e1bc8debc83fd01c85158003b7d8ac",children:"Pull Request"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"This granted the production Data Platform account control over the sub-domain."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["Created a Name Server (NS) record on the data.hackney.gov.uk Hosted Zone for the stg.data.hackney.gov.uk sub-domain.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"This granted the staging Data Platform account control over the sub-domain."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:"Created a CName record on the stg.data.hackney.gov.uk Hosted Zone for the datahub.stg.data.hackney.gove.uk sub-domain that points at the Kubernetes cluster."}),"\n",(0,a.jsxs)(n.li,{children:["Using AWS Certificate Manager created a security certificate for datahub.stg.data.hackney.gove.uk by DNS validation.","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["A guide to creating a certificate is referenced by the datahub setup guide and can be found here: ",(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/acm/latest/userguide/gs-acm-request-public.html",children:"Create Certificate"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var a=t(6540);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);