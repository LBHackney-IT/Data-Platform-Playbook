"use strict";(self.webpackChunkdata_platform_playbook=self.webpackChunkdata_platform_playbook||[]).push([[317],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return f}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=d(n),f=o,g=u["".concat(s,".").concat(f)]||u[f]||c[f]||r;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3108:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return f},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return c}});var a=n(3117),o=n(102),r=(n(7294),n(3905)),i=["components"],l={title:"RingGo data ingestion",description:"Description of the ingestion process for RingGo data",layout:"playbook_js",tags:["playbook"]},s=void 0,d={unversionedId:"docs/ringgo-ingestion",id:"docs/ringgo-ingestion",title:"RingGo data ingestion",description:"Description of the ingestion process for RingGo data",source:"@site/docs/docs/ringgo-ingestion.md",sourceDirName:"docs",slug:"/docs/ringgo-ingestion",permalink:"/Data-Platform-Playbook/docs/ringgo-ingestion",draft:!1,editUrl:"https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/docs/ringgo-ingestion.md",tags:[{label:"playbook",permalink:"/Data-Platform-Playbook/tags/playbook"}],version:"current",frontMatter:{title:"RingGo data ingestion",description:"Description of the ingestion process for RingGo data",layout:"playbook_js",tags:["playbook"]},sidebar:"docs",previous:{title:"Redshift - Creating users, databases and exposing data from Glue",permalink:"/Data-Platform-Playbook/docs/redshift"},next:{title:"Tascomi data ingestion",permalink:"/Data-Platform-Playbook/docs/tascomi-ingestion"}},p={},c=[{value:"1. CSV file is downloaded from the RingGo SFTP server",id:"1-csv-file-is-downloaded-from-the-ringgo-sftp-server",level:3},{value:"Running the Lambda manually",id:"running-the-lambda-manually",level:3},{value:"Copying missing data from landing to raw zone in case of a failure",id:"copying-missing-data-from-landing-to-raw-zone-in-case-of-a-failure",level:3},{value:"Failure alerts",id:"failure-alerts",level:3}],u={toc:c};function f(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This section describes how the RingGo dataset gets ingested into the data platform"),(0,r.kt)("h3",{id:"1-csv-file-is-downloaded-from-the-ringgo-sftp-server"},"1. CSV file is downloaded from the RingGo SFTP server"),(0,r.kt)("p",null,"The company who owns the dataset (RingGo) uploads a csv file containing previous day's data into their SFTP server. The file drop happens every afternoon."),(0,r.kt)("p",null,"Lambda function called ",(0,r.kt)("inlineCode",{parentName:"p"},"sftp-to-s3")," runs on a schedule in the evening and copies the csv file to ",(0,r.kt)("inlineCode",{parentName:"p"},"dataplatform-prod-landing-zone/ringgo/sftp/input/")," folder in the landing zone.  "),(0,r.kt)("p",null,"On successful download the lambda function starts the ",(0,r.kt)("inlineCode",{parentName:"p"},"parking-copy-ringgo-sftp-data-to-raw-job-trigger")," trigger which kicks off the ETL workflow."),(0,r.kt)("h3",{id:"running-the-lambda-manually"},"Running the Lambda manually"),(0,r.kt)("p",null,"In case of a failure in the ingestion process the Lambda can be run manually from the console. "),(0,r.kt)("p",null,"To run the Lambda manually the following test body can be used in the Lambda console:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "DateToImport": "YYYY-MM-DD"\n}\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"DateToImport")," value determines which file is fetched from the SFTP server. The files are named in ",(0,r.kt)("inlineCode",{parentName:"p"},"data_warehouse_-YYYY-MM-DD.csv")," format, so that can be used to identify the correct file."),(0,r.kt)("p",null,"Please note that files are uploaded to the server each afternoon and they contain data for previous day, so the files are lacking behind by a day."),(0,r.kt)("h3",{id:"copying-missing-data-from-landing-to-raw-zone-in-case-of-a-failure"},"Copying missing data from landing to raw zone in case of a failure"),(0,r.kt)("p",null,"If for any reason there's a gap in dates in the raw zone data due to ingestion failure the raw to landing copy job has to be run manually."),(0,r.kt)("p",null,"Once the missing data has been ingested to the landing zone please follow these steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Clear the ",(0,r.kt)("inlineCode",{parentName:"li"},"dataplatform-{ENVIRONMENT}-raw-zone/parking/ringgo/sftp/")," folder by deleting all folders and files in there"),(0,r.kt)("li",{parentName:"ol"},"Open the ",(0,r.kt)("inlineCode",{parentName:"li"},"Parking copy RingGo SFTP data to raw")," job in the Glue console"),(0,r.kt)("li",{parentName:"ol"},"Reset the bookmark for the job"),(0,r.kt)("li",{parentName:"ol"},"Comment out the ",(0,r.kt)("inlineCode",{parentName:"li"},"latest_data = get_latest_partitions(data_source)")," line in the script. Currently on line 27."),(0,r.kt)("li",{parentName:"ol"},"Uncomment the ",(0,r.kt)("inlineCode",{parentName:"li"},"# latest_data = data_source")," line below (28)"),(0,r.kt)("li",{parentName:"ol"},"Save the job"),(0,r.kt)("li",{parentName:"ol"},"Run the job"),(0,r.kt)("li",{parentName:"ol"},"Revert the changes in steps 4. and 5. and save the job again")),(0,r.kt)("p",null,"Raw zone should now have the data matching the landing zone "),(0,r.kt)("h3",{id:"failure-alerts"},"Failure alerts"),(0,r.kt)("p",null,"The Lambda function is configured to send failure alerts to central ",(0,r.kt)("inlineCode",{parentName:"p"},"data-platform-lambda-alerts")," Google space."))}f.isMDXComponent=!0}}]);