<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-playbook/transforming-data/geospatial-enrichments">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Geospatial enrichment | Hackney Data Platform Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/geospatial-enrichments"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Geospatial enrichment | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="How to perform geospatial enrichment on data held in the data platform"><meta data-rh="true" property="og:description" content="How to perform geospatial enrichment on data held in the data platform"><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/geospatial-enrichments"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/geospatial-enrichments" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/geospatial-enrichments" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KNMFHOJ4X2-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.e0b8b3cc.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.9b528257.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.f7d52c65.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Geospatial enrichment</h1></header><p>This section describes how to enrich data with geographies such as wards and LSOAs.
Use this as a pre-processing step that will enable analysts to aggregate or make choropleth maps from data held in the DP. In the example below (Qlik), the 2 maps on the left were created with enriched data whereas the map on the right was created with the non enriched version.</p><p><img loading="lazy" alt="Street cleaning jobs mapped with or without spatial enrichment" src="/Data-Platform-Playbook/assets/images/alloy-jobs-with-and-without-spatial-enrichment-784127034f6be1327faae3a04591dd6b.png" width="1909" height="804" class="img_ev3q"></p><p>The spatial enrichment process relies on a PySpark script that performs spatial joins between: </p><ul><li>input tables having some geometry information, </li><li>and geography tables such as wards, LSOAs or estates. These are spatial layers coming from Geolive, the corporate spatial database. </li></ul><p>The script outputs tables that have extra columns stating in which ward/LSOA/estate the record is located.
This script uses Geopandas as explained in the <!-- -->[ADR about spatial data processing in the Data Platform]<!-- --> (<a href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/architecture-decisions/records/spatial-data-processing" target="_blank" rel="noopener noreferrer">https://playbook.hackney.gov.uk/Data-Platform-Playbook/architecture-decisions/records/spatial-data-processing</a>).</p><h1>Requirements for input tables</h1><p>The tables to enrich must contain geometry information that enables to geocode each record as a point <em>(to do: support input tables with line or polygon geometries)</em>. This geometry can be represented in several ways:</p><ol><li>Two coords columns, either lat lon or easting/northings. The column names are not important</li><li>One geometry column in one of these 2 formats. The name of the column is not important</li></ol><ul><li>WKT (Well known text), e.g POINT (-0.020821653 51.55184938) </li><li>WKB (Well known binary) (0106000020346C000001000000010300000001000000760000003D0AD7A36453204148E17A14387D064114AE476113532041F6285C8F167A06419A9999997D5220410AD7A37009740641C3F528DC8552204148E17A141A7306417B14AE478F522041B81E85EBE77006413D0AD7238352204148E17A14186E0641B81E8)</li></ul><ol start="3"><li><em>(to do) a UPRN column</em></li></ol><p>In cases 1 and 2, you need to know the coordinate reference system of the geometry information. Typically, it will be ‘EPSG:4326’ for lat/lon and ‘EPSG:27700’ (the code for British national grid) for easting and northing.</p><h1>Where to set up an enrichment job</h1><p>[The spatial enrichment PySpark script]<!-- --> (<a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/scripts/jobs/unrestricted/spatial_enrichment.py" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/Data-Platform/blob/main/scripts/jobs/unrestricted/spatial_enrichment.py</a>) is ready to use, without mofifications, in any new Terraform job module. All the geospatial enrichment job modules should be placed in the <!-- -->[aws_glue_spatial Terraform script]<!-- --> (<a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/terraform/etl/24-aws-glue-spatial.tf" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/Data-Platform/blob/main/terraform/etl/24-aws-glue-spatial.tf</a>). Each job is specific to a department (for data access reasons) and can enrich one or more tables in one go. It will typically write into a subfolder of this department&#x27;s refined zone, called &#x27;spatially_enriched&#x27;. This location is set in the <code>--target_location</code> parameter, and can then get crawled if you set the <code>crawler_details</code> section. How you schedule the job is your choice. Note that the additional python modules (rtree, geopandas) needed for the spatial joins MUST be set as a job parameter called <code>additional-python-modules</code>.</p><p>This is an example of an enrichment job for Environmental Services.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;env_services_geospatial_enrichment&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source                    = &quot;../modules/aws-glue-job&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_live_environment       = local.is_live_environment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_production_environment = local.is_production_environment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  department                 = module.department_environmental_services_data_source</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  job_name                   = &quot;${local.short_identifier_prefix}env_services_geospatial_enrichment&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  script_s3_object_key       = aws_s3_bucket_object.spatial_enrichment.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  glue_job_worker_type       = &quot;G.1X&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  helper_module_key          = data.aws_s3_bucket_object.helpers.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pydeequ_zip_key            = data.aws_s3_bucket_object.pydeequ.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  spark_ui_output_storage_id = module.spark_ui_output_storage_data_source.bucket_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  schedule                   = &quot;cron(30 4 ? * MON-FRI *)&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  job_parameters = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--job-bookmark-option&quot;        = &quot;job-bookmark-enable&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--enable-glue-datacatalog&quot;    = &quot;true&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--additional-python-modules&quot;  = &quot;rtree,geopandas&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--geography_tables_dict_path&quot; = &quot;s3://${module.glue_scripts_data_source.bucket_id}/${aws_s3_bucket_object.geography_tables_dictionary.key}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--tables_to_enrich_dict_path&quot; = &quot;s3://${module.glue_scripts_data_source.bucket_id}/${aws_s3_bucket_object.env_services_spatial_enrichment_dictionary.key}&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--target_location&quot;            = &quot;s3://${module.refined_zone_data_source.bucket_id}/env-services/spatially-enriched/&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  crawler_details = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    database_name      = module.department_environmental_services_data_source.refined_zone_catalog_database_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    s3_target_location = &quot;s3://${module.refined_zone_data_source.bucket_id}/env-services/spatially-enriched&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    table_prefix       = &quot;spatially_enriched_&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>Two dictionaries used to parameterise the job</h1><p>The most important job parameters are paths to 2 dictionaries that should be committed in the repository. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dictionary-of-geography-tables-doesnt-need-to-change">Dictionary of geography tables (doesn&#x27;t need to change)<a href="#dictionary-of-geography-tables-doesnt-need-to-change" class="hash-link" aria-label="Direct link to Dictionary of geography tables (doesn&#x27;t need to change)" title="Direct link to Dictionary of geography tables (doesn&#x27;t need to change)">​</a></h2><p>The geography tables dictionary (<code>geography_tables_dict_path</code> parameter) tells Glue where to fetch the geography tables, what their relevant columns are, and how they should be labelled in enriched tables. These are quite standard settings and, unless you have very specific requirements for the output table, the same dictionary could be used for all enrichment jobs. The dictionary doesn&#x27;t force you to use all these geographies, but it makes them available for Glue. In the other dictionary (next subsection), you&#x27;ll be able to set which geographies to use for each input table to enrich. Speak to the GIS team if you need a new geography that hasn&#x27;t been used before, they will amend this dictionary. Here is the dictionnary as it was when the first enrichment job was created:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;ward&quot;:{&quot;geography_title&quot;:&quot;ward&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_boundaries_hackney_ward&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;name&quot;, &quot;column_alias&quot;:&quot;ward_name&quot;},{&quot;column_name&quot;:&quot;census_code&quot;, &quot;column_alias&quot;:&quot;ward_ons_code&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;lsoa&quot;:{&quot;geography_title&quot;:&quot;lsoa&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_boundaries_hackney_lsoa_2011&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;lsoa_name&quot;, &quot;column_alias&quot;:&quot;lsoa_name&quot;},{&quot;column_name&quot;:&quot;code&quot;, &quot;column_alias&quot;:&quot;lsoa_ons_code&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;msoa&quot;:{&quot;geography_title&quot;:&quot;msoa&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_boundaries_hackney_msoa_2011&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;msoa11nm&quot;, &quot;column_alias&quot;:&quot;msoa_name&quot;},{&quot;column_name&quot;:&quot;msoa11cd&quot;, &quot;column_alias&quot;:&quot;msoa_ons_code&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;recycling_estate&quot;:{&quot;geography_title&quot;:&quot;recycling_estate&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_recycling_recycling_estate_boundary&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;estate_name&quot;, &quot;column_alias&quot;:&quot;recycling_estate&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;street_cleaning_area&quot;:{&quot;geography_title&quot;:&quot;street_cleaning_area&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_recycling_street_cleaning_manager_area&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;areaname&quot;, &quot;column_alias&quot;:&quot;street_cleaning_manager_area&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;housing_estate&quot;:{&quot;geography_title&quot;:&quot;housing_estate&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_housing_lbh_estate&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;estate_name&quot;, &quot;column_alias&quot;:&quot;housing_estate&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;housing_neighbourhood&quot;:{&quot;geography_title&quot;:&quot;housing_neighbourhood&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_housing_housing_neighbourhood&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;housing_neighbourhoods&quot;, &quot;column_alias&quot;:&quot;housing_neighbourhood&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;housing_management_area&quot;:{&quot;geography_title&quot;:&quot;housing_management_area&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_housing_housing_management_area&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;name&quot;, &quot;column_alias&quot;:&quot;housing_management_area&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;children_centre_area&quot;:{&quot;geography_title&quot;:&quot;children_centre_area&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_education_children_centre_area&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;zone_id&quot;, &quot;column_alias&quot;:&quot;children_centre_area&quot;}]},</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;health_care_neighbourhood&quot;:{&quot;geography_title&quot;:&quot;health_care_neighbourhood&quot;, &quot;database_name&quot;:&quot;unrestricted-raw-zone&quot;, &quot;table_name&quot;:&quot;geolive_health_health_care_neighbourhood&quot;, &quot;columns_to_append&quot;:[{&quot;column_name&quot;:&quot;neighbourhood_area&quot;, &quot;column_alias&quot;:&quot;health_care_neighbourhood_code&quot;},{&quot;column_name&quot;:&quot;neighbourhood_name&quot;, &quot;column_alias&quot;:&quot;health_care_neighbourhood_name&quot;}]}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dictionary-of-tables-to-enrich-create-a-new-one-for-each-enrichment-job">Dictionary of tables to enrich (create a new one for each enrichment job)<a href="#dictionary-of-tables-to-enrich-create-a-new-one-for-each-enrichment-job" class="hash-link" aria-label="Direct link to Dictionary of tables to enrich (create a new one for each enrichment job)" title="Direct link to Dictionary of tables to enrich (create a new one for each enrichment job)">​</a></h2><p>The tables to enrich dictionary (<code>tables_to_enrich_dict_path</code> parameter) tells Glue where to fetch the input tables in the department bucket, how to manage their geometries (format, CRS, column names), and with which geographies to enrich them. Here is the beginning of the dictionnary used to enrich environmental services data.
<img loading="lazy" alt="Dictionary of tables to enrich for environment services" src="/Data-Platform-Playbook/assets/images/env-services-spatial-enrichment-dictionary-8e7ce4d119cf612ac7a3b1d5b6bd3302.png" width="1504" height="836" class="img_ev3q"></p><p>Declare your dictionary in the tf script like below so it gets copied from the repository into S3 at deployment stage.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">resource &quot;aws_s3_bucket_object&quot; &quot;env_services_spatial_enrichment_dictionary&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bucket      = module.glue_scripts_data_source.bucket_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  key         = &quot;scripts/env-services/spatial-enrichment-dictionary.json&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  acl         = &quot;private&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source      = &quot;../../scripts/jobs/env_services/spatial-enrichment-dictionary.json&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source_hash = filemd5(&quot;../../scripts/jobs/env_services/spatial-enrichment-dictionary.json&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/Data-Platform-Playbook/tags/playbook">playbook</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/transforming-data/geospatial-enrichments.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#dictionary-of-geography-tables-doesnt-need-to-change" class="table-of-contents__link toc-highlight">Dictionary of geography tables (doesn&#39;t need to change)</a></li><li><a href="#dictionary-of-tables-to-enrich-create-a-new-one-for-each-enrichment-job" class="table-of-contents__link toc-highlight">Dictionary of tables to enrich (create a new one for each enrichment job)</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.9b528257.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.f7d52c65.js"></script>
</body>
</html>