<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Guide to testing data quality in Glue Jobs | Hackney Data Platform Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Guide to testing data quality in Glue Jobs | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="A guide to continuous data quality testing in Glue Jobs"><meta data-rh="true" property="og:description" content="A guide to continuous data quality testing in Glue Jobs"><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KNMFHOJ4X2-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.e0b8b3cc.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.76948af7.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.4c27fce8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Data-Platform-Playbook/playbook/getting-set-up">Playbook</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-set-up">Getting set up on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/elements-of-the-platform/data-catalogue">Elements of the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/finding-data/data-catalogue">Finding data on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-access-to-data/Tableau-to-redshift">Getting access to data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/what-data-are-we-ingesting">Ingesting data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Transforming data</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Guides to testing in the platform</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Guide to testing data quality in Glue Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide">Guide to unit testing on the Data Platform</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio">Using AWS Glue</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/querying-and-analysing-data/connecting-to-redshift-from-data-studio">Querying and analysing data</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/training-modules/module-0">Training Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/docs/CD-process">Technical Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/architecture-decisions">Architecture Decision</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/spikes/amundsen-deployment">Spikes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Data-Platform-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Playbook</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Transforming data</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides to testing in the platform</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Guide to testing data quality in Glue Jobs</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Guide to testing data quality in Glue Jobs</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="resources">Resources<a href="#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources">​</a></h2><ul><li><a href="https://github.com/awslabs/python-deequ" target="_blank" rel="noopener noreferrer">PyDeequ README</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="context">Context<a href="#context" class="hash-link" aria-label="Direct link to Context" title="Direct link to Context">​</a></h2><p>Data Quality tests are used to verify the quality of production datasets.
They are intended to make assertions against the data itself as opposed to the code when unit testing.</p><p>This guide introduces the Python library &#x27;PyDeequ&#x27; which can be used to perform data quality testing in your Glue scripts.
PyDeequ allows you to calculate data quality metrics on your dataset, define and verify data quality constraints,
and be informed about changes in the data distribution.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites-of-data-quality-testing">Pre-requisites of data quality testing<a href="#pre-requisites-of-data-quality-testing" class="hash-link" aria-label="Direct link to Pre-requisites of data quality testing" title="Direct link to Pre-requisites of data quality testing">​</a></h2><p>In order to efficiently test your data, it is necessary that you define and set the right expectations from the ETL process and the data itself.
It is therefore helpful to have a good understanding of the purpose of the data and think about the following questions:</p><ul><li><p>What do you want to achieve with your data?</p><ul><li>Knowing what the intended purpose of the data is and what specific business questions it will help answer.</li></ul></li><li><p>What does high-quality data mean to you?</p><ul><li>You must understand the metrics that will help you to measure data quality.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites-to-using-pydeequ">Pre-requisites to using PyDeequ<a href="#pre-requisites-to-using-pydeequ" class="hash-link" aria-label="Direct link to Pre-requisites to using PyDeequ" title="Direct link to Pre-requisites to using PyDeequ">​</a></h2><ol><li>Update the job arguments of your Glue job to include:</li></ol><ul><li><p>Metrics repository S3 target location using the template format:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;--deequ_metrics_location&quot; = &quot;s3://${module.&lt;ZONE&gt;_zone.bucket_id}/quality-metrics/department=&lt;YOUR-DEPARTMENT-NAME&gt;/dataset=&lt;DATASET-NAME&gt;/deequ-metrics.json&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em><code>&lt;ZONE&gt;</code> refers to either: <code>raw</code>, <code>landing</code>, <code>refined</code>, or <code>trusted</code> S3 zones.</em></p><p><em><code>&lt;YOUR-DEPARTMENT-NAME&gt;</code> and <code>&lt;DATASET-NAME&gt;</code> must be all lowercase with words separated by hyphens.</em></p><p>For example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;--deequ_metrics_location&quot; = &quot;s3://${module.refined_zone.bucket_id}/quality-metrics/department=housing-repairs/dataset=repairs-axis/deequ-metrics.json&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The metrics stored here can help you understand the profile of your data as well as help you come up with suitable constraints to measure the data quality of your dataset.</p></li></ul><ol start="2"><li>Import the following functions from PyDeequ in the top of your script.
As you are writing your tests, you may discover that you need additional functions from the PyDeequ library.
You may import these as required. The examples in this guide also introduce some functions that may be used.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from pydeequ.repository import FileSystemMetricsRepository, ResultKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from pydeequ.verification import VerificationSuite, VerificationResult</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from helpers.data_quality_testing import get_metrics_target_location, cancel_job_if_failing_quality_checks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Add the metrics target location and also a metrics repoistory and result key instance. This will ensure that data quality metrics are written to the deequ-metrics.json file in S3.</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">metrics_target_location = get_metrics_target_location()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metricsRepository = FileSystemMetricsRepository(spark_session, metrics_target_location)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resultKey = ResultKey(spark_session, ResultKey.current_milli_time(), {})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>There is a <a href="https://github.com/awslabs/python-deequ/issues/7" target="_blank" rel="noopener noreferrer">defect with PyDeequ</a> which causes the Glue Spark session to hang.
While this issue still exists, we recommend wrapping your data quality verification code in a &quot;try/finally&quot; block (see example <a href="https://github.com/LBHackney-IT/Data-Platform/blob/6468778d865c6203d1d11df78805720da9cd22b5/scripts/elec_mech_fire_tv_aerials_cleaning.py#L79-L105" target="_blank" rel="noopener noreferrer">here</a>).</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">finally</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sparkContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">_gateway</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">stop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="types-of-data-quality-tests">Types of Data Quality tests<a href="#types-of-data-quality-tests" class="hash-link" aria-label="Direct link to Types of Data Quality tests" title="Direct link to Types of Data Quality tests">​</a></h2><p>We introduce two types of data quality tests; <strong>fact-checking of data values</strong> and <strong>historical analysis of the dataset</strong> being processed.</p><ul><li><p><strong>Fact-checking of data values</strong>: involves validating the values of columns and checking that they conform to set standards.
For example, an ID column only contains unique values or values in a given column should be in a specific range, between a minimum and maximum value.</p></li><li><p><strong>Historical analysis of the dataset</strong>: involves analysing a dataset as it evolves over time and testing that the new data is consistent with a baseline.
This requires having a profile or baseline of the data to compare to.</p></li></ul><p>Below are examples of these two types of data quality tests.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-fact-checking-of-data-values-example">1. Fact-checking of data values example<a href="#1-fact-checking-of-data-values-example" class="hash-link" aria-label="Direct link to 1. Fact-checking of data values example" title="Direct link to 1. Fact-checking of data values example">​</a></h3><p>Here is an example of using Deequ checks to validate a dataframe, and storing related metrics to S3.
The <code>description_of_work</code> column is checked to be complete, and <code>work_priority_priority_code</code> between
1 and 4 inclusively.
There is also the option to include a hint message on each of the checks which will be
displayed to the user in the event there is a failing constraint to help diagnose the problem.
For example, the <code>hasMin</code> check has the hint message:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;The minimum(work_priority_priority_code) &gt;= 1&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">checks </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> Check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CheckLevel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">repository </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">verification </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> VerificationResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> RelativeRateOfChangeStrategy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> helpers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">data_quality_testing </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> get_metrics_target_location</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metrics_target_location </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> get_metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metricsRepository </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resultKey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">current_milli_time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">checkResult </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">onData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">useRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">metricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addCheck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">Check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CheckLevel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;data quality checks&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hasMin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;work_priority_priority_code&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;The minimum(work_priority_priority_code) &gt;= 1&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">hasMax</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;work_priority_priority_code&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;The maximum(work_priority_priority_code) &lt;= 4&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">  \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">isComplete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;description_of_work&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">saveOrAppendResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">resultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">checkResult_df </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> VerificationResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">checkResultsAsDataFrame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> checkResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">checkResult_df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">show</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is a <a href="https://pydeequ.readthedocs.io/en/latest/pydeequ.html#module-pydeequ.checks" target="_blank" rel="noopener noreferrer">list of checks</a> that are available to use.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Remember to ensure that any checks, analyzers, anomaly checks are included within the imports.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-historical-analysis-of-the-dataset---example-anomaly-detection">2. Historical analysis of the dataset - Example Anomaly Detection<a href="#2-historical-analysis-of-the-dataset---example-anomaly-detection" class="hash-link" aria-label="Direct link to 2. Historical analysis of the dataset - Example Anomaly Detection" title="Direct link to 2. Historical analysis of the dataset - Example Anomaly Detection">​</a></h3><p>Anomaly detection uses historic metrics to determine if a value is invalid.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>You can only run an anomaly check if there are historic metrics results in the metrics repository you are using.
If no historic metrics results exist, you will get the below error message:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Can&#x27;t execute the assertion: requirement failed:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">There have to be previous results in the MetricsRepository!!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To avoid this error, run the standard verification constraint checks first (see <a href="#1-fact-checking-of-data-values-example">Fact-checking of data values example</a> section above) and then add your anomaly constraint checks afterwards.</p></div></div><p>For example, we check if the size of a dataframe has increased by more than twice the previous size.</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">verification </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> VerificationResult</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">repository </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pydeequ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">anomaly_detection </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> RelativeRateOfChangeStrategy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> helpers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">data_quality_testing </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> get_metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cancel_job_if_failing_quality_checks</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metrics_target_location </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> get_metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metricsRepository </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> FileSystemMetricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> metrics_target_location</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resultKey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">current_milli_time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">anomalyVerificationSuite </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> VerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">onData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">useRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">metricsRepository</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addAnomalyCheck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">RelativeRateOfChangeStrategy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">maxRateIncrease </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cancel_job_if_failing_quality_checks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">VerificationResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">checkResultsAsDataFrame</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> anomalyVerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Only update the metrics repository if cancel_job_if_failing_quality_checks succeeds.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Otherwise the next time anomaly check runs it will compare against &quot;incorrect&quot; metrics.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">anomalyVerificationSuite</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">saveOrAppendResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">resultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here is a <a href="https://pydeequ.readthedocs.io/en/latest/pydeequ.html#module-pydeequ.anomaly_detection" target="_blank" rel="noopener noreferrer">list of anomaly detection types</a> that are available to use.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="providing-tags-to-metrics-for-verification-constraint-checks">Providing tags to metrics for verification constraint checks<a href="#providing-tags-to-metrics-for-verification-constraint-checks" class="hash-link" aria-label="Direct link to Providing tags to metrics for verification constraint checks" title="Direct link to Providing tags to metrics for verification constraint checks">​</a></h2><p>You can add tags to your verification metrics which may be helpful when reviewing the metric
results for a particular job.
To do this, include a dictionary containing key value pairs in the <code>ResultKey</code> as shown in example below:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> awsglue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">utils </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> getResolvedOptions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">args </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> getResolvedOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;JOB_NAME&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">resultKey </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_session</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ResultKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">current_milli_time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;source_database&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source_catalog_database</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;source_table&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source_catalog_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;glue_job_id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;JOB_RUN_ID&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="stopping-glue-jobs-when-constraint-checks-fail">Stopping Glue jobs when constraint checks fail<a href="#stopping-glue-jobs-when-constraint-checks-fail" class="hash-link" aria-label="Direct link to Stopping Glue jobs when constraint checks fail" title="Direct link to Stopping Glue jobs when constraint checks fail">​</a></h2><p>In order to ensure that only trusted data is outputted from your Glue job, it is important
to make an assertion against your constraints to check that they have been satisfied.</p><p>You can do this by including a helper function called <code>cancel_job_if_failing_quality_checks()</code>
in your script (see <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/scripts/helpers/data_quality_testing.py" target="_blank" rel="noopener noreferrer">data quality testing helpers</a> for more info).
You can see an example usage in the <a href="#2-historical-analysis-of-the-dataset---example-anomaly-detection">Historical analysis of the dataset - Example Anomaly Detection</a> section.</p><p>When a constraint check fails, the Glue job will fail and, an error message will be provided which might look something like
the below message:</p><div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Exception: data quality checks. Value: 1.0 does not meet the constraint requirement!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The minimum(work_priority_priority_code) &gt;= 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">| Anomaly check for Size(None). Value: 486.0 does not meet the constraint requirement!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Multiple constraint failures are delimited by a <code>|</code> character in the error message.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="commit-your-data-quality-tests-to-your-glue-job">Commit your data quality tests to your Glue job<a href="#commit-your-data-quality-tests-to-your-glue-job" class="hash-link" aria-label="Direct link to Commit your data quality tests to your Glue job" title="Direct link to Commit your data quality tests to your Glue job">​</a></h2><p>Once you are satisfied with your data quality tests, you will need to commit them to the Data Platform project so that they can be deployed to your existing Glue job.</p><ul><li>Submit your changes by referring to the <a href="/Data-Platform-Playbook/playbook/getting-set-up/using-github#committing-your-changes-to-the-data-platform-project">Committing changes</a> section of the <strong>Using Github</strong> guide.
The Data Platform team needs to approve any changes to the code, so your change won&#x27;t happen automatically.</li></ul><div class="theme-admonition theme-admonition-important alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If you are working with a new Glue job that has not yet been deployed to the Data Platform project, refer to <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/deploy-glue-jobs">this guide</a> to have it added to the project.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="email-notifications-of-failing-glue-jobs">Email notifications of failing Glue jobs<a href="#email-notifications-of-failing-glue-jobs" class="hash-link" aria-label="Direct link to Email notifications of failing Glue jobs" title="Direct link to Email notifications of failing Glue jobs">​</a></h2><p>Each time a Glue job fails as a result of failing constraint checks, an email notification with details of the error message is sent to the respective department, and their subscribed members.</p><p>The message will include:</p><ul><li>Name of the Glue job</li><li>Error message from the failing constraint check</li><li>Time of failure</li><li>Job start time</li><li>Job end time</li><li>Job last modified time</li><li>A link to log in to Hackney SSO and view the Job run details</li></ul><p>In order to receive email notifications, you will need to ensure that you are subscribed to receive emails from your department&#x27;s <a href="https://groups.google.com/my-groups" target="_blank" rel="noopener noreferrer">Google group</a> and that you have confirmed your subscription to receive AWS Notifications when prompted.</p><p>Additionally, Spark Web UI is used to monitior and debug the glue jobs. Every 30 seconds, AWS Glue flushes the Spark event logs to an S3 bucket titled Spark UI Bucket.</p><div class="theme-admonition theme-admonition-important alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If you are still prototyping your data quality tests in Glue Studio, ensure the <strong>PlatformDepartment</strong> tag is correctly set in the <em>Advanced details</em> section in the Glue job&#x27;s <em>Job Details</em> (see <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio">Using Glue Studio</a>).</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/Data-Platform-Playbook/tags/playbook">playbook</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/transforming-data/guides-to-testing-in-the-platform/003-data-quality-testing-guide.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Data-Platform-Playbook/playbook/ingesting-data/tips-on-how-to-write-an-API-Lambda-script"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tips on writing an API Ingestion script for AWS Lambda</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Guide to unit testing on the Data Platform</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#resources" class="table-of-contents__link toc-highlight">Resources</a></li><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#pre-requisites-of-data-quality-testing" class="table-of-contents__link toc-highlight">Pre-requisites of data quality testing</a></li><li><a href="#pre-requisites-to-using-pydeequ" class="table-of-contents__link toc-highlight">Pre-requisites to using PyDeequ</a></li><li><a href="#types-of-data-quality-tests" class="table-of-contents__link toc-highlight">Types of Data Quality tests</a><ul><li><a href="#1-fact-checking-of-data-values-example" class="table-of-contents__link toc-highlight">1. Fact-checking of data values example</a></li><li><a href="#2-historical-analysis-of-the-dataset---example-anomaly-detection" class="table-of-contents__link toc-highlight">2. Historical analysis of the dataset - Example Anomaly Detection</a></li></ul></li><li><a href="#providing-tags-to-metrics-for-verification-constraint-checks" class="table-of-contents__link toc-highlight">Providing tags to metrics for verification constraint checks</a></li><li><a href="#stopping-glue-jobs-when-constraint-checks-fail" class="table-of-contents__link toc-highlight">Stopping Glue jobs when constraint checks fail</a></li><li><a href="#commit-your-data-quality-tests-to-your-glue-job" class="table-of-contents__link toc-highlight">Commit your data quality tests to your Glue job</a></li><li><a href="#email-notifications-of-failing-glue-jobs" class="table-of-contents__link toc-highlight">Email notifications of failing Glue jobs</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.76948af7.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.4c27fce8.js"></script>
</body>
</html>