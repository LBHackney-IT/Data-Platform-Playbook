<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-rh="true">Guide to unit testing on the Data Platform | Hackney Data Platform Playbook</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Guide to unit testing on the Data Platform | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="A beginners guide to testing on the data platform"><meta data-rh="true" property="og:description" content="A beginners guide to testing on the data platform"><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KNMFHOJ4X2-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.4438b1b5.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.ee1c78a7.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.aa2b627a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Data-Platform-Playbook/playbook/getting-set-up">Playbook</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-set-up">Getting set up on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/elements-of-the-platform/data-catalogue">Elements of the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/finding-data/data-catalogue">Finding data on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-access-to-data/Tableau-to-redshift">Getting access to data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/what-data-are-we-ingesting">Ingesting data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Transforming data</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Guides to testing in the platform</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Guide to testing data quality in Glue Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/unit-testing-guide">Guide to unit testing on the Data Platform</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio">Using AWS Glue</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/querying-and-analysing-data/connecting-to-redshift-from-data-studio">Querying and analysing data</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/training-modules/module-0">Training Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/docs/CD-process">Technical Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/architecture-decisions">Architecture Decision</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/spikes/amundsen-deployment">Spikes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Data-Platform-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Playbook</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Transforming data</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides to testing in the platform</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Guide to unit testing on the Data Platform</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Guide to unit testing on the Data Platform</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="context">Context<a class="hash-link" href="#context" title="Direct link to heading">​</a></h2><p>Historically, unit testing practices have helped:</p><ul><li>Improve the speed at which PySpark scripts can be developed</li><li>Provide documentation for each script with example data they
expect, and what results they output</li><li>Increase the proportion of defects found before they reach staging environment</li><li>Help those who come to maintain your script make their change without being scared
of breaking existing functionality</li></ul><p>The most valuable code to test is the code which is subject to change,
and has some complicated behaviour. We recommend that when writing PySpark
code which isn’t exceedingly simple that you write some tests alongside that production code.</p><p>HackIT have produced <a href="https://www.youtube.com/embed/M-_F_Tr6paQ" target="_blank" rel="noopener noreferrer">a video describing unit testing principles for C#</a>
which are transferable to Spark scripts.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="organising-your-code-so-it-can-be-tested">Organising your code so it can be tested<a class="hash-link" href="#organising-your-code-so-it-can-be-tested" title="Direct link to heading">​</a></h2><p>Writing tests around your spark scripts require them to be written in a way which makes them easy to test.</p><p>Using <a href="https://github.com/LBHackney-IT/Data-Platform/blob/2e4a89e280c326576a976b4f28c9b7faaa691ea4/scripts/address_cleaning.py#L16-L99" target="_blank" rel="noopener noreferrer">address cleaning</a> as an example script, we have
extracted all DataFrame manipulation code into a method, and then tested
the behaviours of that <a href="https://github.com/LBHackney-IT/Data-Platform/blob/2e4a89e280c326576a976b4f28c9b7faaa691ea4/scripts/test_address_cleaning.py#L7-L15" target="_blank" rel="noopener noreferrer">with tests</a>.</p><p>The &quot;main&quot; part of the ETL job which will run within the AWS Glue environment
is then <a href="https://github.com/LBHackney-IT/Data-Platform/blob/2e4a89e280c326576a976b4f28c9b7faaa691ea4/scripts/address_cleaning.py#L103-L140" target="_blank" rel="noopener noreferrer">wrapped in a conditional</a> which prevents
that code from being run within the testing environment. All code, except import statements, that isn&#x27;t in a method should be included in this conditional.
The “main” part is also the part where AWS connections should happen. Make sure that your testable methods, outside the “main” part, don’t require AWS connections, or you won’t be able to test them locally.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="writing-your-own-tests">Writing your own tests<a class="hash-link" href="#writing-your-own-tests" title="Direct link to heading">​</a></h2><ul><li><p>Before starting, pull the latest Data Platform code from GitHub. You need to have <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank" rel="noopener noreferrer">git</a> working and ready in your IDE. In VSCode, you may need to use the bash command line for git commands to be recognised.</p></li><li><p>Ensure that you run the tests and that they are all passing before writing your own tests.
See <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/scripts/README.md" target="_blank" rel="noopener noreferrer">README.md</a> for instructions on how to do this.</p></li><li><p>Create and check out a new branch to develop your tests. For example, if you are testing the individual cleaning scripts for Housing repairs Google sheets, you could use: <code>git checkout -b testing_housing_repairs_cleaning_scripts</code>.</p></li><li><p>The tests are stored in the scripts folder of the project alongside the glue scripts themselves.</p></li><li><p>There are 2 scenarios:</p><ul><li>In the ideal scenario, you should be writing your script and your tests at the same time. Start by creating your own glue job script as usual say, <code>jobs/script_name.py</code>, and also a test file in the tests folder <code>tests/test_script_name.py</code>. Test files should be named with &quot;test&quot; at the beginning of the file. For example, <code>test_cleaning_script.py</code>. If your job is department specific then both job script and test files should be in that departments subfolders.</li><li>In the non-ideal scenario, you are writing tests at posteriori for a script that already exists. Pick this script and create the corresponding test file in the tests folder named <code>tests/test_script_name.py</code>.</li></ul></li><li><p>You will need to organise your script (or reorganise it if it already exists) according to the <a href="#organising-your-code-so-it-can-be-tested">Organising your code so it can be tested</a> above. For existing scripts, it includes adding the line
<code>if __name__ = “__main__”:</code>
Just after the methods definitions and just before the part that reads arguments from the AWS environment (look at examples). Indent everything under this new line.</p></li><li><p>Define a function within <code>script_name.py</code>, which takes in the input DataFrame(s), and returns the DataFrame to be written. (For existing scripts: take the processing code out of the main part and turn it into one or several methods).</p></li><li><p>Within your <code>test_script_name.py</code> start creating tests. You can use the <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/scripts/test_spark_example.py" target="_blank" rel="noopener noreferrer">test_spark_example</a> as a template and <a href="https://github.com/LBHackney-IT/Data-Platform/blob/2e4a89e280c326576a976b4f28c9b7faaa691ea4/scripts/address_cleaning.py#L16-L99" target="_blank" rel="noopener noreferrer">address cleaning</a> as an example of a fully tested script. If you do, rename the class name into something relevant, for instance TestMechFireDpaCleaning.
Test method names should start with a &quot;test&quot; in their name, otherwise the tests won’t be run.
Ensure the name clearly describes what is being tested.
For example, if you are testing the behaviour of adding a unique id column, then a suitable name may be along the lines of <code>test_creates_unique_id_column</code>.</p></li><li><p>There are some helper functions in the &quot;helpers&quot; folder, which you can use in your tests. For example, <code>dictionaryContains</code> in <code>assertions.py</code> is a useful function that asserts that specific fields and values exist in an output, instead of asserting equality for a full data line.
If you do decide to use these functions, ensure you import them at the top of your test file, for example add <code>from helpers import assertions</code> to access methods in the <code>assertions.py</code> file.</p></li><li><p>If your script is using a logger, you will need to pass it into your testable method.
See the <code>clean_addresses</code> function in the <code>test_address_cleaning.py</code> for an example of how you can do this.</p></li><li><p>When you’ve written your first test, run it using one of the commands in the <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/scripts/README.md" target="_blank" rel="noopener noreferrer">README.md</a>. It is common practice to write a test in such a way that it initially fails, and then to change it to make it pass. This practice is called Test-driven development (TDD), for more information <a href="https://www.youtube.com/embed/M-_F_Tr6paQ" target="_blank" rel="noopener noreferrer">this video</a> talks through the principles of TDD.</p></li><li><p>If you need to add any packages in order to write your tests, you can add them to the <code>requirements.test.txt</code> file and they will be installed when you run your tests.</p></li><li><p>When you’re happy with your test, commit your changes locally on your branch.</p></li><li><p>To have your tests published on the Data Platform, push your commits to GitHub and create a Pull Request on your branch, so others can review and merge your code.</p></li></ul><p>We use the following things to help write and run tests against pyspark scripts.</p><ul><li>The testing framework that we use for the glue scripts is called <a href="https://docs.pytest.org/en/6.2.x/contents.html" target="_blank" rel="noopener noreferrer">Pytest</a>.</li><li><a href="https://docs.python.org/3/library/unittest.html" target="_blank" rel="noopener noreferrer">Unittest</a>, is a testing framework like pytest, that has some helpful features that we use in some of the tests.</li><li>Docker is used to run the tests locally.
We use a <a href="https://aws.amazon.com/blogs/big-data/developing-aws-glue-etl-jobs-locally-using-a-container/" target="_blank" rel="noopener noreferrer">docker image provided by amazon</a> that helps us replicate the environment that our glue jobs are run in.
It also has pyspark and pytest installed to allow us to easily run the tests. You will need <a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">docker installed</a> to run tests locally.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="cicd-pipeline">CI/CD Pipeline<a class="hash-link" href="#cicd-pipeline" title="Direct link to heading">​</a></h2><p>The tests will run each time a commit is made to a branch including when branches are merged into main.
The build will not run/deploy if there are failing tests.
This is to prevent breaking changes from being deployed to the Data Platform staging environment.</p><p>This has been configured in the <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/.github/workflows/data_platform_stg.yml" target="_blank" rel="noopener noreferrer">Github workflows configuration file</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/Data-Platform-Playbook/tags/playbook">playbook</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/transforming-data/guides-to-testing-in-the-platform/004-unit-testing-guide.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Guide to testing data quality in Glue Jobs</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/using-glue-studio"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Using Glue Studio</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#context" class="table-of-contents__link toc-highlight">Context</a></li><li><a href="#organising-your-code-so-it-can-be-tested" class="table-of-contents__link toc-highlight">Organising your code so it can be tested</a></li><li><a href="#writing-your-own-tests" class="table-of-contents__link toc-highlight">Writing your own tests</a></li><li><a href="#cicd-pipeline" class="table-of-contents__link toc-highlight">CI/CD Pipeline</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.ee1c78a7.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.aa2b627a.js"></script>
</body>
</html>