<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-playbook/ingesting-data/ingesting-api-data" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Ingesting data from an API to the Data Platform | Hackney Data Platform Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-api-data"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ingesting data from an API to the Data Platform | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="Ingesting API data into the Data Platform using an AWS Lambda function"><meta data-rh="true" property="og:description" content="Ingesting API data into the Data Platform using an AWS Lambda function"><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-api-data"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-api-data" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-api-data" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KNMFHOJ4X2-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.2e3b48f9.css">
<script src="/Data-Platform-Playbook/assets/js/runtime~main.d0a161b4.js" defer="defer"></script>
<script src="/Data-Platform-Playbook/assets/js/main.2fe36f58.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Data-Platform-Playbook/">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Data-Platform-Playbook/playbook/getting-set-up">Playbook</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-set-up">Getting set up on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/elements-of-the-platform/data-catalogue">Elements of the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/finding-data/data-catalogue">Finding data on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-access-to-data/Tableau-to-redshift">Getting access to data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/what-data-are-we-ingesting">Ingesting data</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/what-data-are-we-ingesting">Types of data and ingestion process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import">Ingesting data from Google Sheets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/manual-ingest-of-csv-files">Ingest manually uploaded csv files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingest-spreadsheet-files-from-g-drive">Ingest spreadsheet files from G Drive</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone">Ingesting RDS snapshot into the Data Platform Landing Zone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/database-ingestion">Ingesting data from databases into the Data Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables">Ingesting Dynamo DB tables into the Landing Zone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/event-streaming">Ingesting new data entities via event streaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-api-data">Ingesting data from an API to the Data Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/production-to-pre-production-sync">Production to pre-production data sync</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/tips-on-how-to-write-an-API-Lambda-script">Tips on writing an API Ingestion script for AWS Lambda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/using-watermarks-to-record-job-states">Using Watermarks to Record AWS GLue Job States Between Runs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/creating-a-lambda-function-step-by-step">How to create a Lambda function for data ingestion on the Data Analytics Platform</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Transforming data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/querying-and-analysing-data/time-series-analysis/introduction">Querying and analysing data</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Data-Platform-Playbook/training-modules/module-0">Training Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Data-Platform-Playbook/docs/CD-process">Technical Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Data-Platform-Playbook/dap-airflow/introduction">DAP⇨flow</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Data-Platform-Playbook/architecture-decisions">Architecture Decision</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Data-Platform-Playbook/spikes/amundsen-deployment">Spikes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Data-Platform-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Playbook</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Ingesting data</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ingesting data from an API to the Data Platform</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ingesting data from an API to the Data Platform</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<ul>
<li>You have a Python script to be used in the Lambda. If you want tips on how to write a Python script for this purpose, check out <a href="/Data-Platform-Playbook/playbook/ingesting-data/tips-on-how-to-write-an-API-Lambda-script">this article</a></li>
<li>You have a GitHub account, you can <a href="https://github.com/signup" target="_blank" rel="noopener noreferrer">create one</a> yourself using your Hackney email.</li>
<li>You have been added to the &#x27;LBHackney-IT&#x27; team, you can request this from Rashmi Shetty.</li>
<li>You need to have a department ready for the Data, by the time you reach the First Time Ingestion. You can find out how to onboard a department <a href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/getting-set-up/onboarding-new-departments-to-the-platform" target="_blank" rel="noopener noreferrer">Here</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>This guide walks you through the process of setting up the infrastructure to deploy an AWS Lambda function to be used to ingest data from an API.
It assumes you already have a script that will make the API calls to retrieve the required data.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="contents">Contents<a href="#contents" class="hash-link" aria-label="Direct link to Contents" title="Direct link to Contents">​</a></h2>
<ul>
<li>Add the API credentials to the Data Platform project</li>
<li>Add your script to the Data Platform repository</li>
<li>Set up API Ingestion Lambda Module</li>
<li>Commit your changes and create a Pull Request for review by the Data Platform team</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-api-credentials-to-the-data-platform-project">Add the API credentials to the Data Platform project<a href="#add-the-api-credentials-to-the-data-platform-project" class="hash-link" aria-label="Direct link to Add the API credentials to the Data Platform project" title="Direct link to Add the API credentials to the Data Platform project">​</a></h3>
<p>The API credentials can be stored and retrieved from AWS Secrets Manager.
You will then be able to retrieve and use credentials in your Lambda function script.</p>
<ul>
<li>
<p>Contact an engineer from the Data Platform team to add the API credentials to AWS Secrets Manager.</p>
<ul>
<li>
<p>You will need to request that a <strong>secret</strong> (with an appropriate description) is created following the naming convention below:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">/&lt;department name&gt;/&lt;DATASET_NAME&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Remember this name as you will need it later</strong>. For example: <code>/customer-services/casenotes-data-key</code></p>
</li>
<li>
<p>Request that the necessary API credentials be added to this secret in key-value pairs. For example:</p>
<ul>
<li><code>api_key</code> = <code>RandomKey</code></li>
<li><code>secret</code> = <code>RandomSecret</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>You will be notified once the secret has been stored with the credentials.
Make a note of the <strong>secret</strong> name, and the <strong>keys</strong> set above as they will be needed in the <a href="#set-up-api-ingestion-lambda">Set up API Ingestion Lambda</a> below.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-your-script-to-the-data-platform-repository">Add your script to the Data Platform repository<a href="#add-your-script-to-the-data-platform-repository" class="hash-link" aria-label="Direct link to Add your script to the Data Platform repository" title="Direct link to Add your script to the Data Platform repository">​</a></h3>
<p>In this section, you&#x27;ll be adding your script to the Data Platform repository so that it can be used in the Lambda function to ingest the API data.</p>
<p><strong>Note: You will need to complete this step from your IDE (Integrated Development Environment) or ask an engineer for assistance as it involves creating a directory which currently can&#x27;t be done in the GitHub website user interface.</strong></p>
<ol>
<li>Open the <a href="https://github.com/LBHackney-IT/Data-Platform/tree/main/lambdas" target="_blank" rel="noopener noreferrer">lambdas directory</a> in the Data Platform Project in GitHub.</li>
<li>Create a new directory suffixed with <code>_api_ingestion</code>.<!-- -->
<ul>
<li>Set this to the name of the data/API you are ingesting.
Ensure the name is <strong>lowercase</strong> with <strong>words separated by underscores</strong>.
For example: <code>casenotes_data_api_ingestion</code>.</li>
<li>Make a note of the name of the directory as it will be needed for the <a href="#set-up-api-ingestion-lambda-module">Set up API Ingestion Lambda Module</a> section below.</li>
</ul>
</li>
<li>Create a new file in this directory called <code>main.py</code>, you can also add your tests to its own file: <code>test.py</code></li>
<li>Paste your code in the respective files. <strong>Ensure the main execution function in your <code>main.py</code> file is called <code>lambda_handler</code>.</strong></li>
<li>Seek assistance from an engineer to get the required packages for your Lambda installed.</li>
<li>Submit your changes by referring to the <a href="/Data-Platform-Playbook/playbook/getting-set-up/using-github#committing-your-changes-to-the-data-platform-project">Committing changes</a> section of the <strong>Using GitHub</strong> guide.
The Data Platform team needs to approve any changes to the code, so your change won&#x27;t happen automatically.</li>
</ol>
<div class="theme-admonition theme-admonition-important admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Updating your Lambda script</div><div class="admonitionContent_BuS1"><p>If you need to update your Lambda script in the future, you must follow steps 4-6 to have those changes deployed to the Data Platform Project.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-api-ingestion-lambda-module">Set up API Ingestion Lambda Module<a href="#set-up-api-ingestion-lambda-module" class="hash-link" aria-label="Direct link to Set up API Ingestion Lambda Module" title="Direct link to Set up API Ingestion Lambda Module">​</a></h3>
<p>In this section, you will be writing the code, using a template format, that will deploy your Lambda function to the Data Platform Project (or update an existing one if you need to make changes to an existing Lambda function).</p>
<p><strong>Note: The steps in this section refer specifically to GitHub user interface</strong>. However, if you are familiar working with the Data Platform project from your IDE, then you can also make the changes in your IDE and commit them to the Data Platform repository.</p>
<ol>
<li>
<p>Open the <a href="https://github.com/LBHackney-IT/Data-Platform/tree/main/terraform/core" target="_blank" rel="noopener noreferrer">terraform/core directory</a> in the Data Platform Project in GitHub.</p>
<ul>
<li>If you don&#x27;t have the correct permissions, you&#x27;ll get a &#x27;404&#x27; error (see the <a href="/Data-Platform-Playbook/playbook/getting-set-up">Getting Set Up documentation</a>).</li>
</ul>
</li>
<li>
<p>Open <code>38-api-ingestion.tf</code>.</p>
</li>
<li>
<p>Click <code>edit</code> or the <strong>pencil icon</strong> (<!-- -->✏️<!-- -->) then copy the last module block and paste it at the bottom of the file.
An example of what a module block looks like can be seen in the <a href="#example-module-block">Example Module Block</a> section below.</p>
</li>
<li>
<p>Update the <code>module</code> name using the name convention <code>&lt;api_data_name&gt;_api_ingestion</code>, for example: <code>&quot;casenotes_data_api_ingestion&quot;</code>.</p>
<ul>
<li>The module name must be all <strong>lowercase</strong> with <strong>words separated by underscores</strong>.
Ensure the name is unique to all other module names in this file.</li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-following-input-variables-are-required">The following input variables are required:<a href="#the-following-input-variables-are-required" class="hash-link" aria-label="Direct link to The following input variables are required:" title="Direct link to The following input variables are required:">​</a></h4>
<p><em><strong>Note</strong>: If you have copied an existing module block then you won’t need to change the <strong>source</strong>, <strong>tags</strong>, <strong>identifier_prefix</strong>, <strong>lambda_artefact_storage_bucket</strong> and, <strong>secrets_manager_kms_key</strong> input variables.</em>
<code>&lt;ZONE&gt;</code> refers to either: <code>raw</code>, or <code>landing</code> S3 zones.</p>
<ul>
<li>
<p><strong>count</strong> (required): <code>count</code> determines where the Terraform will deploy the Lambda using Logic.</p>
<ul>
<li><code>local.is_live_environment</code> includes Production and Pre-Production</li>
<li><code>local.is_production_environment</code> includes Production</li>
<li><code>1:0</code> means for environments that satisfy the previous conditions, make ONE lambda, otherwise for other environments, make 0.</li>
<li><code>count = local.is_live_environment &amp;&amp; !local.is_production_environment ? 1 : 0</code> then means <code>if (Prod &amp; Pre-prod) &amp;&amp; (Not Prod), deploy 1, otherwise deploy 0</code> Meaning it will only deploy 1 into pre-prod</li>
</ul>
</li>
<li>
<p><strong>source</strong> (required): This will be <code>&quot;../modules/api-ingestion-lambda&quot;</code>. (This is the path to where the api ingestion Lambda module is saved within the repository).</p>
</li>
<li>
<p><strong>tags</strong> (required): This will be <code>module.tags.values</code></p>
</li>
<li>
<p><strong>identifier_prefix</strong> (required): This will be <code>local.short_identifier_prefix</code></p>
</li>
<li>
<p><strong>lambda_artefact_storage_bucket</strong> (required): This will be <code>module.lambda_artefact_storage.bucket_id</code></p>
</li>
<li>
<p><strong>lambda_name</strong> (required): Name of the Lambda function. This should be the same as the name set in step 2 of the <a href="##add-you-script-to-the-data-platform-repository">Add your script to the Data Platform repository</a> section above, <strong>however with words separated by hyphens (<code>-</code>) instead, and all lowercase.</strong>
(This will be used to find your Lambda script).</p>
<p>For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">lambda_name = &quot;casenotes-data-api-ingestion&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>secrets_manager_kms_key</strong> (required): This will be <code>aws_kms_key.secrets_manager_key</code></p>
</li>
<li>
<p><strong>s3_target_bucket_arn</strong> (required): This will be <code>module.&lt;ZONE&gt;_zone.bucket_arn</code>.
<code>&lt;ZONE&gt;</code> should be either <code>raw</code>, or <code>landing</code> depending on the S3 zone you are ingesting your data to.</p>
</li>
<li>
<p><strong>s3_target_bucket_name</strong> (required): The target S3 bucket to ingest the data to (this is used to set the Lambda permissions, you will also need to set this as an environment variable in the <strong>lambda_environment_variables</strong> input variable below).</p>
<p>This will be <code>module.&lt;ZONE&gt;_zone.bucket_id</code>.
<code>&lt;ZONE&gt;</code> should be either <code>raw</code>, or <code>landing</code> depending on the S3 zone you are ingesting your data to.</p>
</li>
<li>
<p><strong>api_credentials_secret_name</strong> (required): This will be the same name you set in the previous section (this is used to set the Lambda permissions, you will also need to set this as an environment variable in the <strong>lambda_environment_variables</strong> input variable below).</p>
<p>For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">api_credentials_secret_name = &quot;api-credentials/case-notes&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You will be able to retrieve these credentials in your code from the Environment Variables you will set below using the <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/secretsmanager.html" target="_blank" rel="noopener noreferrer">AWS SDK</a> for Secrets Manager.</p>
</li>
<li>
<p><strong>s3_target_bucket_kms_key_arn</strong> (required): This will be <code>module.&lt;ZONE&gt;_zone.kms_key_arn</code>.
<code>&lt;ZONE&gt;</code> should be either <code>raw</code>, or <code>landing</code> depending on the S3 zone you are ingesting your data to.</p>
</li>
<li>
<p><strong>lambda_environment_variables</strong> (required): An object containing key-value pairs of environment variables to be used in your Lambda code.</p>
<p>For example: An API ingestion Lambda which has its API credentials stored as a secret called: <code>&quot;api-credentials/case-notes&quot;</code> in AWS Secrets Manager, writes to a directory called: <code>casenotes-data</code> in the Landing zone, and then triggers a Glue job to move it from the Landing zone to the Raw zone, will have the following set as environment variables:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">lambda_environment_variables = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SECRET_NAME&quot; = &quot;api-credentials/casenotes-data-key&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;TARGET_S3_BUCKET_NAME&quot; = module.landing_zone.bucket_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;OUTPUT_FOLDER&quot; = &quot;casenotes-data&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;GLUE_JOB_NAME&quot; = module.copy_casenotes_data_landing_to_raw[0].job_name #Note: You would have to create this job</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><em>The <code>OUTPUT_FOLDER</code> above can be your department name followed by dataset name if ingesting to your <strong>department&#x27;s raw zone</strong> area. For example: <code>&quot;housing/casenotes-data&quot;</code>.</em></p>
<p><strong>Environment variables set here can be retrieved in your Lambda code.</strong>
For example, to retrieve the above environment variables, you would add the following to your Lambda code:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">from os import getenv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">def lambda_handler(event, lambda_context):</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  load_dotenv()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  secret_name = getenv(&quot;SECRET_NAME&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  s3_bucket = getenv(&quot;TARGET_S3_BUCKET_NAME&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  output_folder_name = getenv(&quot;OUTPUT_FOLDER&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  glue_job_name = getenv(&quot;GLUE_JOB_NAME&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-following-input-variables-are-optional">The following input variables are optional:<a href="#the-following-input-variables-are-optional" class="hash-link" aria-label="Direct link to The following input variables are optional:" title="Direct link to The following input variables are optional:">​</a></h4>
<p><em>If an optional variable is not needed you should delete the entire line in the module block.</em></p>
<ul>
<li>
<p><strong>glue_job_to_trigger</strong> (optional): The Glue job to trigger once the ingestion has completed (this is used to set the Lambda permissions, you will also need to set this as an environment variable in the <strong>lambda_environment_variables</strong> input variable above).</p>
<p>For instance, you may want to perform some transformations on the data or move it to another area once it has been ingested into the specified S3 location.
<strong>You will have to write some code in your Lambda to trigger this Glue job using the name.
See the <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/glue.html#Glue.Client.start_job_run" target="_blank" rel="noopener noreferrer">AWS Docs</a> for guidance on how to do this.</strong></p>
</li>
<li>
<p><strong>ephemeral_storage</strong> (optional): The amount of Ephemeral storage (<code>/tmp</code>) to allocate for the Lambda Function in MBs.
This input variable can be used to expand the total amount of Ephemeral storage available beyond the <strong>default which is <code>512</code> (MBs).</strong></p>
<p>In most cases the default value is sufficient, however, if your api ingestion Lambda runs an intensive/ heavy process, you may want to override this. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ephemeral_storage = 6144</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>lambda_timeout</strong> (optional): The amount of time in seconds before the Lambda will time out/ stop running.
<strong>The default value is set to <code>900</code> (seconds) which is 15 minutes</strong>. This is the <strong>maximum</strong> execution time for an AWS Lambda function.</p>
</li>
<li>
<p><strong>lambda_memory_size</strong> (optional): The amount of memory in MBs your Lambda Function can use at runtime.
<strong>The default value is <code>256</code>.</strong>
In most cases the default value is sufficient, however, if your api ingestion Lambda runs an intensive/ heavy process, you may want to override this. For example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">lambda_memory_size = 512 </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>lambda_execution_cron_schedule</strong> (optional): Schedule to run the Lambda function specified using Cron expressions (see <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html#CronExpressions" target="_blank" rel="noopener noreferrer">AWS Cron Expression documentation</a>).
<strong>The default schedule is 6am every day</strong>.</p>
<ul>
<li>
<p>For example, if you wanted your API ingestion Lambda run at 08:30am every day, your Cron expression would look like:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">lambda_execution_cron_schedule = &quot;cron(30 8 * * ? *)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>You can also use <a href="https://www.freeformatter.com/cron-expression-generator-quartz.html" target="_blank" rel="noopener noreferrer">this tool</a> to generate your Cron expressions.</p>
</li>
</ul>
</li>
</ul>
<p>When you are done setting the input variables for this module, you can move onto the next section.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="commit-your-changes-and-create-a-pull-request-for-review-by-the-data-platform-team">Commit your changes and create a Pull Request for review by the Data Platform team<a href="#commit-your-changes-and-create-a-pull-request-for-review-by-the-data-platform-team" class="hash-link" aria-label="Direct link to Commit your changes and create a Pull Request for review by the Data Platform team" title="Direct link to Commit your changes and create a Pull Request for review by the Data Platform team">​</a></h3>
<p>You can now submit your changes for review by the Data Platform team.</p>
<ul>
<li>See <a href="/Data-Platform-Playbook/playbook/getting-set-up/using-github#committing-your-changes-to-the-data-platform-project">Committing changes</a> section of the <strong>Using GitHub</strong> guide.
The Data Platform team needs to approve any changes to the code that you make, so your change won&#x27;t happen automatically.
Once your changes have been approved and deployed, the job will run at the next scheduled time (if scheduled).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-module-block">Example Module Block<a href="#example-module-block" class="hash-link" aria-label="Direct link to Example Module Block" title="Direct link to Example Module Block">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;something_api_ingestion&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  count                     = local.is_live_environment &amp;&amp; !local.is_production_environment ? 1 : 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source                    = &quot;../modules/api-ingestion-lambda&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tags                      = module.tags.values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_production_environment = local.is_production_environment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  is_live_environment       = local.is_live_environment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  identifier_prefix              = local.short_identifier_prefix</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_artefact_storage_bucket = module.lambda_artefact_storage.bucket_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_name                    = &quot;something_api_ingestion&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_handler                 = &quot;main.lambda_handler&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  runtime_language               = &quot;python3.8&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  secrets_manager_kms_key        = aws_kms_key.secrets_manager_key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  s3_target_bucket_arn           = module.landing_zone.bucket_arn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  s3_target_bucket_name          = local.s3_target_bucket_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  api_credentials_secret_name    = &quot;something-secret-key&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  s3_target_bucket_kms_key_arn   = module.landing_zone.kms_key_arn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_memory_size 			 = 1024 # You probably want this to be fairly large</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lambda_environment_variables = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;SECRET_NAME&quot;           = &quot;secret-name&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;TARGET_S3_BUCKET_NAME&quot; = local.s3_target_bucket_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;other environment variables, make a new line each&quot; = &quot;Value of these variables&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Edit the values in the Terraform Module we just pasted to match your script.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="check-that-it-works-in-pre-production">Check that it works in Pre-Production<a href="#check-that-it-works-in-pre-production" class="hash-link" aria-label="Direct link to Check that it works in Pre-Production" title="Direct link to Check that it works in Pre-Production">​</a></h2>
<p>Once you have made changes to the Terraform and pushed the changes to GitHub, if there are no problems with your branch, the Lambda function will appear in Pre-Prod.</p>
<p>You can manually trigger the Lambda in the <a href="https://eu-west-2.console.aws.amazon.com/lambda/home?region=eu-west-2#/functions" target="_blank" rel="noopener noreferrer">AWS Console</a>. If it runs with no issues, then it is ready to move into Prod. That is unlikely however, so here are some common issues</p>
<ul>
<li>If the Lambda reaches its max amount of memory, it will just break. You can increase the amount of memory by going to Configuration &gt; General Configuration &gt; Edit &gt; Memory. And in Terraform the &quot;lambda_memory_size&quot; value will change the memory</li>
<li>If the Lambda reaches 15 minutes it will time out. If possible, change the Python script to just get less days of data.</li>
<li>If it cannot find a package you are using in the Python Script, check your requirements.txt or Piplock files</li>
</ul>
<p>Once it is in Production, it will automatically run every day. You now have data in the Landing Zone!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-automated-alerting-for-your-lambda">Setting up automated alerting for your Lambda<a href="#setting-up-automated-alerting-for-your-lambda" class="hash-link" aria-label="Direct link to Setting up automated alerting for your Lambda" title="Direct link to Setting up automated alerting for your Lambda">​</a></h3>
<p>Lambda alerts module can be updated to include your Lambda function in the common alerts setup.</p>
<p><strong>Please note</strong> the Lambda&#x27;s log group must exist on production account for the module deployment to succeed. Log group will be created automatically as soon as the Lambda outputs something to the Cloudwatch logs for the first time.</p>
<p>To setup automated alarms please add a new module to the <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/terraform/core/42-lambda-alarms-handler.tf" target="_blank" rel="noopener noreferrer">41-lambda-failure-alarms.tf</a> file by copying one of the existing modules and updating the values as described below. Here&#x27;s a sample module:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;ringgo_sftp_ingestion_lambda_alarm&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    count               = local.is_production_environment ? 1 : 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    source              = &quot;../modules/lambda-alarms-and-monitoring&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tags                = module.tags.values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    identifier_prefix   = local.short_identifier_prefix</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lambda_name         = &quot;${local.short_identifier_prefix}sftp-to-s3&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    project             = var.project</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    environment         = var.environment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    alarms_handler_lambda_name = module.lambda_alarms_handler[0].lambda_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    alarms_handler_lambda_arn = module.lambda_alarms_handler[0].lambda_arn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Please update the values inside &lt;&gt; as follows:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;&lt;NAME_OF_THE_INGESTION&gt;_ingestion_lambda_alarm&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    count               = local.is_production_environment ? 1 : 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    source              = &quot;&lt;PATH_TO_THE_LAMBDA_MODULE&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tags                = module.tags.values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    identifier_prefix   = local.short_identifier_prefix</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lambda_name         = &quot;${local.short_identifier_prefix}&lt;NAME_OF_THE_DEPLOYED_LAMBDA&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    project             = var.project</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    environment         = var.environment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    alarms_handler_lambda_name = module.lambda_alarms_handler[0].lambda_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    alarms_handler_lambda_arn = module.lambda_alarms_handler[0].lambda_arn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once the alert module update has been deployed any errors thrown by the lambda function will trigger an alert to be sent to the central Google Space monitored by Data Platform team.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/Data-Platform-Playbook/tags/playbook">playbook</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingesting-data/009-ingesting-api-data.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Data-Platform-Playbook/playbook/ingesting-data/event-streaming"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Ingesting new data entities via event streaming</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Data-Platform-Playbook/playbook/ingesting-data/production-to-pre-production-sync"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Production to pre-production data sync</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#contents" class="table-of-contents__link toc-highlight">Contents</a><ul><li><a href="#add-the-api-credentials-to-the-data-platform-project" class="table-of-contents__link toc-highlight">Add the API credentials to the Data Platform project</a></li><li><a href="#add-your-script-to-the-data-platform-repository" class="table-of-contents__link toc-highlight">Add your script to the Data Platform repository</a></li><li><a href="#set-up-api-ingestion-lambda-module" class="table-of-contents__link toc-highlight">Set up API Ingestion Lambda Module</a></li><li><a href="#commit-your-changes-and-create-a-pull-request-for-review-by-the-data-platform-team" class="table-of-contents__link toc-highlight">Commit your changes and create a Pull Request for review by the Data Platform team</a></li><li><a href="#example-module-block" class="table-of-contents__link toc-highlight">Example Module Block</a></li></ul></li><li><a href="#check-that-it-works-in-pre-production" class="table-of-contents__link toc-highlight">Check that it works in Pre-Production</a><ul><li><a href="#setting-up-automated-alerting-for-your-lambda" class="table-of-contents__link toc-highlight">Setting up automated alerting for your Lambda</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by Hackney's Data Analytics Platform Team.</div></div></div></footer></div>
</body>
</html>