<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-react-helmet="true">Ingesting data from Google Sheets | Hackney Data Platform Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Ingesting data from Google Sheets | Hackney Data Platform Playbook"><meta data-react-helmet="true" name="description" content="Objective"><meta data-react-helmet="true" property="og:description" content="Objective"><link data-react-helmet="true" rel="shortcut icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import"><link data-react-helmet="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.1180568a.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.ccb51e9d.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.ef2f8cd2.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Playbook</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Training Modules</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Getting set up on the platform</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Finding data on the platform</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Getting access to data</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Ingesting data</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import">Ingesting data from Google Sheets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/manual-ingest-of-csv-files">Ingest manually uploaded csv files</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingest-xlsx-files-from-g-drive">Ingest XLXS files from G Drive</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone">Ingesting RDS snapshot into the Data Platform Landing Zone</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/database-ingestion">Ingesting data from databases into the Data Platform</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables">Ingesting Dynamo DB tables into the Landing Zone</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Transforming data</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Querying and analysing data</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Technical Documentation</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture Decision</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Spikes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ingesting data from Google Sheets</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="objective"></a>Objective<a class="hash-link" href="#objective" title="Direct link to heading">#</a></h2><p>Ingest data contained within a Google Sheet for use on the Data Platform, optionally setting a recurring schedule to ingest new data.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="intended-audience"></a>Intended audience<a class="hash-link" href="#intended-audience" title="Direct link to heading">#</a></h2><ul><li>Data Analyst</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li>You have a Github account - you can <a href="https://github.com/signup" target="_blank" rel="noopener noreferrer">create one</a> yourself using your Hackney email</li><li>You have been added to the &#x27;LBHackney-IT&#x27; team - you can request this from Rashmi Shetty</li><li>You have a service account email address, such as one listed in the table below:</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="department-specific-information"></a>Department specific information<a class="hash-link" href="#department-specific-information" title="Direct link to heading">#</a></h3><table><thead><tr><th>Department</th><th>Pre-Production Service account email</th><th>Production Service account email</th></tr></thead><tbody><tr><td>parking</td><td>parking@dataplatform-stg.iam.gserviceaccount.com</td><td>parking@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>housing_repairs</td><td>housing-repairs@dataplatform-stg.iam.gserviceaccount.com</td><td>housing-repairs@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>data_and_insight</td><td>data-and-insight@dataplatform-stg.iam.gserviceaccount.com</td><td>data-and-insight@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>finance</td><td>finance@dataplatform-stg.iam.gserviceaccount.com</td><td>finance@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>env_enforcement</td><td>env-enforcement@dataplatform-stg.iam.gserviceaccount.com</td><td>env-enforcement@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>planning</td><td>planning@dataplatform-stg.iam.gserviceaccount.com</td><td>planning@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>unrestricted</td><td>unrestricted@dataplatform-stg.iam.gserviceaccount.com</td><td>unrestricted@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>sandbox</td><td>sandbox@dataplatform-stg.iam.gserviceaccount.com</td><td>sandbox@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>benefits_and_housing_needs</td><td>benefits-housing-needs@dataplatform-stg.iam.gserviceaccount.com</td><td>benefits-housing-needs@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>revenues</td><td>revenues@dataplatform-stg.iam.gserviceaccount.com</td><td>revenues@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>environmental_services</td><td>environmental-services@dataplatform-stg.iam.gserviceaccount.com</td><td>environmental-services@dataplatform-prod0.iam.gserviceaccount.com</td></tr><tr><td>housing</td><td>housing@dataplatform-stg.iam.gserviceaccount.com</td><td>housing@dataplatform-prod0.iam.gserviceaccount.com</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="preparing-a-google-sheet-for-ingestion"></a>Preparing a Google sheet for ingestion<a class="hash-link" href="#preparing-a-google-sheet-for-ingestion" title="Direct link to heading">#</a></h2><ol><li>Open the Google sheet you would like to ingest</li><li>Ensure that all columns have headers. Columns without headers will be lost</li><li>Click <code>Share</code> in the top right corner of the sheet</li><li>If the document is unnamed, name it</li><li>Paste in the service account email address you have been provided into the email box</li><li>Ensure the suggested email matches the service account email and select it</li><li>On the new window, choose from the dropdown on the right hand side and select <code>Viewer</code></li><li>Uncheck the <code>Notify people</code> checkbox</li><li>Click <code>Share</code></li><li>You will be asked to confirm sharing outside the organisation, click <code>share anyway</code></li><li>Your Google sheet is now ready to ingest</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="getting-google-sheet-detail"></a>Getting Google sheet detail<a class="hash-link" href="#getting-google-sheet-detail" title="Direct link to heading">#</a></h2><ul><li><p>You will need to obtain the document key from the url. The document id is the portion of the url between <code>https://docs.google.com/spreadsheets/d/</code> and <code>/edit#gid=0</code>. See example below</p><p><img alt="Google sheet id" src="/Data-Platform-Playbook/assets/images/google_spreadsheet_id_example-b0d0193617957f913c71663d81819975.png"></p></li><li><p>You will also need to obtain the worksheet name that you wish to ingest. The worksheet name is located at the bottom left of the screen and unless it has been changed or other worksheets added, it will be called <code>Sheet1</code></p></li><li><p>To ingest multiple worksheets from the same Google sheet, repeat the instructions in the below section for each worksheet</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="setting-up-the-aws-glue-job"></a>Setting up the AWS Glue job<a class="hash-link" href="#setting-up-the-aws-glue-job" title="Direct link to heading">#</a></h2><p>This is what will handle the ingestion of the data from Google Sheets to the Data Platform.</p><ol><li><p>Open the <a href="https://github.com/LBHackney-IT/data-platform" target="_blank" rel="noopener noreferrer">Data Platform Project</a>. If you don&#x27;t have the correct permissions, you&#x27;ll get a &#x27;404&#x27; error (see <a href="#prerequisites">prerequisites</a>).</p></li><li><p>Navigate to the main <code>terraform</code> directory, and open <code>26-google-sheets-imports.tf</code></p></li><li><p>Switch to &#x27;edit mode&#x27; (using edit button on top right)</p></li><li><p>Copy one of the modules above, paste at the bottom of the file and update the following fields:</p><ul><li><p><code>module</code> - in the format <code>your_unique_module_name</code>, and unique to all other <code>module</code> names in this file (it is helpful to keep the same naming convention as your dataset/folder)</p></li><li><p><code>glue_catalog_database_name</code> - Using <code>module.department_DEPARTMENT-NAME.raw_zone_catalog_database_name</code> (e.g. <code>module.department_parking.raw_zone_catalog_database_name</code>)</p></li><li><p><code>sheets_credentials_name</code> - Find the value for your department in <a href="#department-specific-information">the table above</a>. If this is blank for your department then you don&#x27;t need to include this at all.</p></li><li><p><code>google_sheets_document_id</code> - Your Google Sheets document ID - see the <code>Getting Google sheet detail</code> section above</p></li><li><p><code>google_sheets_worksheet_name</code> - The name of the worksheet within your Google Sheet document - see the <code>Getting Google sheet detail</code> section above</p></li><li><p><code>department</code> - <code>module.department_DEPARTMENT-NAME</code> (department name should appear as in <a href="#department-specific-information">the table above</a>, e.g. <code>module.department_housing_repairs</code>)</p></li><li><p><code>dataset_name</code> - The name of the dataset as you&#x27;d like it to appear within the data platform e.g. <code>housing-repair</code></p></li><li><p><strong>Optional: stop your Google Sheet from ingesting automatically</strong> - The ingest job will run every weekday at 11pm if <code>enable_glue_trigger</code> is not specified (i.e. there&#x27;s no line for this in your module) or it&#x27;s set to <code>true</code>. If this is set to <code>false</code> then your job will not run automatically on a schedule, and will have to be run manually within AWS. See the section <a href="#running-the-ingestion-manually">Running the ingestion manually</a> for instructions on how to do this.</p></li><li><p><strong>Optional: update the time schedule for the Google Sheet ingestion</strong> - If a value for <code>google_sheet_import_schedule</code> is not provided, the ingestion will run at 11pm on weekdays.</p><ul><li>To override and set a new time schedule, add a new row to the respective module with the new cron time: e.g. <code>google_sheet_import_schedule = &quot;cron(0 23 ? * 1-5 *)&quot;</code></li><li>To create a new Cron expression follow the guidance provided by the <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html#CronExpressions" target="_blank" rel="noopener noreferrer">AWS Cron Expression documentation</a>.</li></ul></li></ul></li><li><p>Submit your changes, by referring to the <a href="/Data-Platform-Playbook/playbook/getting-set-up/using-github#committing-your-changes-to-the-data-platform-project">Committing changes</a> section of the <strong>Using Github</strong> guide.</p><ul><li>The Data Platform team needs to approve any changes to the code that you make, so your change won&#x27;t happen automatically.
Once your changes have been approved, the job will run at the next scheduled time.</li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="running-the-ingestion-manually"></a>Running the ingestion manually<a class="hash-link" href="#running-the-ingestion-manually" title="Direct link to heading">#</a></h3><p>Once you have been notified that your pull request has been merged, you can run the ingestion manually from the AWS console or wait until the scheduled time (if you set one).</p><p>You can do this by navigating to <a href="https://eu-west-2.console.aws.amazon.com/glue/home?region=eu-west-2#etl:tab=workflows" target="_blank" rel="noopener noreferrer">AWS glue workflows</a>, selecting the workflow named <code>&lt;department_name&gt;-&lt;dataset_name&gt;</code>, clicking the &quot;Actions&quot; dropdown and then &quot;Run&quot;.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/Data-Platform-Playbook/tags/playbook">playbook</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingesting-data/001-google-sheets-import.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/getting-access-to-data/index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/ingesting-data/manual-ingest-of-csv-files"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ingest manually uploaded csv files Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective" class="table-of-contents__link">Objective</a></li><li><a href="#intended-audience" class="table-of-contents__link">Intended audience</a></li><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a><ul><li><a href="#department-specific-information" class="table-of-contents__link">Department specific information</a></li></ul></li><li><a href="#preparing-a-google-sheet-for-ingestion" class="table-of-contents__link">Preparing a Google sheet for ingestion</a></li><li><a href="#getting-google-sheet-detail" class="table-of-contents__link">Getting Google sheet detail</a></li><li><a href="#setting-up-the-aws-glue-job" class="table-of-contents__link">Setting up the AWS Glue job</a><ul><li><a href="#running-the-ingestion-manually" class="table-of-contents__link">Running the ingestion manually</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.ccb51e9d.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.ef2f8cd2.js"></script>
</body>
</html>