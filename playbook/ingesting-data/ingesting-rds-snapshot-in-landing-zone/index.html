<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-react-helmet="true">Ingesting RDS snapshot into the Data Platform Landing Zone | Hackney Data Platform Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Ingesting RDS snapshot into the Data Platform Landing Zone | Hackney Data Platform Playbook"><meta data-react-helmet="true" name="description" content="Ingesting a snapshot of an RDS instance into the DataPlatform landing zone"><meta data-react-helmet="true" property="og:description" content="Ingesting a snapshot of an RDS instance into the DataPlatform landing zone"><link data-react-helmet="true" rel="shortcut icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone"><link data-react-helmet="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.1180568a.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.8d778b9e.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.15137405.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">About</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Playbook</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Training Modules</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Getting set up on the platform</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Finding data on the platform</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Getting access to data</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Ingesting data</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import">Ingesting data from Google Sheets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/manual-ingest-of-csv-files">Ingest manually uploaded csv files</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingest-xlsx-files-from-g-drive">Ingest XLXS files from G Drive</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone">Ingesting RDS snapshot into the Data Platform Landing Zone</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/database-ingestion">Ingesting data from databases into the Data Platform</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables">Ingesting Dynamo DB tables into the Landing Zone</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Transforming data</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Querying and analysing data</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Technical Documentation</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Architecture Decision</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Spikes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ingesting RDS snapshot into the Data Platform Landing Zone</h1></header><p>This guide explains the process of ingesting data from a RDS instance in the AWS API accounts to the Data Platform landing zone by creating db snapshots.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="add-rds-instance-id-to-the-environment-variables"></a>Add rds instance id to the environment variables<a class="hash-link" href="#add-rds-instance-id-to-the-environment-variables" title="Direct link to heading">#</a></h2><p>In this section, you will be adding the rds instance id to the environment variables in Terraform, which will provision the necessary resources in AWS to create an event subscription on that database instance. Therefore, each time a database snapshot is created, it will begin the process of ingesting that data into the Data Platform landing zone.</p><ul><li>Ensure you have access to the <a href="https://github.com/LBHackney-IT/data-platform/" target="_blank" rel="noopener noreferrer">Data Platform repository</a></li><li>Login to the AWS management console for the account where the rds instance is located (for UPRN this will be <code>ProductionAPIs</code>)<ul><li>Currently, the deployment is set up to only deploy to the Staging and Production API accounts. This will be refactored to allow us to release into multiple accounts</li></ul></li><li>Search for <code>RDS</code> and select</li><li>Select <code>DB Instances</code> in the <code>Resources</code> section</li><li>Copy the <code>DB identifier</code> of the database you want to ingest</li><li>Navigate to <a href="https://github.com/LBHackney-IT/Data-Platform/blob/main/config/terraform/prod.tfvars#L12" target="_blank" rel="noopener noreferrer">prod.tfvars</a> in the <code>config/terraform</code> directory and click the pencil icon to edit the file</li><li>Add the <code>Db Identifier</code> to the <code>rds_instance_ids</code> environment variable by pasting it to the end of the list as shown below. Ensure you do not remove existing instance ids and that each instance id is double-quoted and comma separated.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rds_instance_ids = [&quot;rds-instance-1&quot;, &quot;rds-instance-2&quot;, &quot;YOUR_DB_INSTANCE_ID&quot;]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>The <code>rds_instance_ids</code> environment variable lists all the RDS instances that are configured to ingest into the Data Platform landing zone</em></p><ul><li>Once the rds instance id has been added, submit your changes by referring to the <a href="/Data-Platform-Playbook/playbook/getting-set-up/using-github#committing-your-changes-to-the-data-platform-project">Committing changes</a> section of the <strong>Using Github</strong> guide.
The Data Platform team needs to approve any changes to the code that you make, so your change won&#x27;t happen automatically.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="create-a-snapshot-of-the-rds-instance"></a>Create a snapshot of the rds instance<a class="hash-link" href="#create-a-snapshot-of-the-rds-instance" title="Direct link to heading">#</a></h2><p>Once your pull request has been approved and released to production, you will need to log in to the AWS account where your RDS instance exists to create a snapshot of it.
The creation of this snapshot will trigger the ingestion process of the data into the Data Platform landing zone.</p><ul><li><p>Search for <code>RDS</code> and select</p></li><li><p>On the sidebar, select <code>Snapshots</code></p></li><li><p>Select <code>Take snapshot</code> on the Manual tab</p></li><li><p>On <code>Take a Snapshot</code> page, use the <code>DB Instance</code> drop down and select the rds instance id as your DB instance</p><p>In the <code>Snapshot Name</code> input field, enter a unique name for your snapshot according to the following convention: <code>dataplatform-YYYY-MM-DD-rds_instance_id</code>. See example below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dataplatform-2021-05-15-golive-db</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you&#x27;re creating more than one snapshot to be ingested on the same day, you would need to make the snapshot name unique by adding a <code>snapshot_version</code> after the date according to the following convention: <code>dataplatform-YYYY-MM-DD-snapshot_version-rds_instance_id</code>. For example if this is your second snapshot in the same day, you can name as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dataplatform-2021-05-15-v2-golive-db</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Select <code>Take snapshot</code></p></li><li><p>The snapshot should immediately appear in the <code>Manual snapshots</code> list under the <code>Manual</code> tab</p></li><li><p>The snapshot is complete when it has a <code>Snapshot creation time</code> (this will take a few minutes to complete)</p></li><li><p>Once the snapshot has been created, it will automatically trigger the ingestion process into the Data Platform landing zone bucket. The ingestion process is made up of two steps which in total will take about an hour to complete:</p><ul><li>First it will transform the database instance into parquet format and save it to an S3 bucket (Amazon Simple Storage Service) in the same service account.
You can view the progress of this first export by navigating to the <code>Exports in Amazon S3</code> tab (this takes just under an hour to complete).
Once complete, you can view the initial snapshot export by clicking on the link in the <code>S3 bucket</code> column which will take you to the relevant directory in the <code>dataplatform-prod-rds-export-storage</code> S3 bucket where all the initial exports are stored.</li><li>The second step will copy the data from the <code>dataplatform-prod-rds-export-storage</code> S3 bucket to the landing zone S3 bucket in the Data Platform account (see <a href="http://playbook.hackney.gov.uk/Data-Platform-Playbook/docs/exporting-snapshot-to-landing-zone/" target="_blank" rel="noopener noreferrer">exporting db snapshots to the landing zone</a> for more detail on the ingestion process). Shortly after this, the data will become available in the Data Platform account.</li></ul></li><li><p>Verify that your data is in the Data Platform landing zone:</p><ul><li>Switch to the <code>DataPlatform-Production</code> account</li><li>Search for <code>S3</code> and select</li><li>Select <code>dataplatform-prod-landing-zone</code> and navigate to the relevant department folder</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/Data-Platform-Playbook/tags/playbook">playbook</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingesting-data/004-ingesting-rds-snapshot-in-landing-zone.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/ingesting-data/ingest-xlsx-files-from-g-drive"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Ingest XLXS files from G Drive</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Data-Platform-Playbook/playbook/ingesting-data/database-ingestion"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ingesting data from databases into the Data Platform Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#add-rds-instance-id-to-the-environment-variables" class="table-of-contents__link">Add rds instance id to the environment variables</a></li><li><a href="#create-a-snapshot-of-the-rds-instance" class="table-of-contents__link">Create a snapshot of the rds instance</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.8d778b9e.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.15137405.js"></script>
</body>
</html>