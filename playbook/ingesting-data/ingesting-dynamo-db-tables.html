<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-playbook/ingesting-data/ingesting-dynamo-db-tables">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Ingesting Dynamo DB tables into the Landing Zone | Hackney Data Platform Playbook</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Ingesting Dynamo DB tables into the Landing Zone | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="Ingesting tables from a Dynamo DB instance into the Data Platform landing zone"><meta data-rh="true" property="og:description" content="Ingesting tables from a Dynamo DB instance into the Data Platform landing zone"><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KNMFHOJ4X2-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.e0b8b3cc.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.efd05c05.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.aed49b4a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Data-Platform-Playbook/playbook/getting-set-up">Playbook</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-set-up">Getting set up on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/elements-of-the-platform/data-catalogue">Elements of the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/finding-data/data-catalogue">Finding data on the platform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/getting-access-to-data/Tableau-to-redshift">Getting access to data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/what-data-are-we-ingesting">Ingesting data</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/what-data-are-we-ingesting">Types of data and ingestion process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/google-sheets-import">Ingesting data from Google Sheets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/manual-ingest-of-csv-files">Ingest manually uploaded csv files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingest-spreadsheet-files-from-g-drive">Ingest spreadsheet files from G Drive</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-rds-snapshot-in-landing-zone">Ingesting RDS snapshot into the Data Platform Landing Zone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/database-ingestion">Ingesting data from databases into the Data Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-dynamo-db-tables">Ingesting Dynamo DB tables into the Landing Zone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/event-streaming">Ingesting new data entities via event streaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/ingesting-api-data">Ingesting data from an API to the Data Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/production-to-pre-production-sync">Production to pre-production data sync</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/tips-on-how-to-write-an-API-Lambda-script">Tips on writing an API Ingestion script for AWS Lambda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/using-watermarks-to-record-job-states">Using Watermarks to Record AWS GLue Job States Between Runs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/Data-Platform-Playbook/playbook/ingesting-data/creating-a-lambda-function-step-by-step">How to create a Lambda function for data ingestion on the Data Analytics Platform</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/transforming-data/guides-to-testing-in-the-platform/data-quality-testing-guide">Transforming data</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/Data-Platform-Playbook/playbook/querying-and-analysing-data/time-series-analysis/introduction">Querying and analysing data</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/training-modules/module-0">Training Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/docs/CD-process">Technical Documentation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/dap-airflow/introduction">DAP⇨flow</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/architecture-decisions">Architecture Decision</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Data-Platform-Playbook/spikes/amundsen-deployment">Spikes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Data-Platform-Playbook/roles">Roles</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Data-Platform-Playbook/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Playbook</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Ingesting data</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Ingesting Dynamo DB tables into the Landing Zone</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Ingesting Dynamo DB tables into the Landing Zone</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="objective">Objective<a href="#objective" class="hash-link" aria-label="Direct link to Objective" title="Direct link to Objective">​</a></h2><p>To setup a job that will ingest specified tables from a Dynamo DB instance.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="intended-audience">Intended audience<a href="#intended-audience" class="hash-link" aria-label="Direct link to Intended audience" title="Direct link to Intended audience">​</a></h2><ul><li>Data Engineers</li><li>Data Analysts</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2><ul><li>Ensure you have completed the pre-requisites in our <a href="/Data-Platform-Playbook/playbook/getting-set-up">getting set up guide</a>.</li><li>You have an engineer in the account where the Dynamo DB instance is who can create an IAM role for you in that account.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-role-in-the-account-where-the-dynamo-db-instance-is-located">Creating a role in the account where the Dynamo DB instance is located<a href="#creating-a-role-in-the-account-where-the-dynamo-db-instance-is-located" class="hash-link" aria-label="Direct link to Creating a role in the account where the Dynamo DB instance is located" title="Direct link to Creating a role in the account where the Dynamo DB instance is located">​</a></h2><p>You will need someone who has access to the account where the Dynamo DB tables live to help with this.
They will need to create two roles, for both our pre-production and production AWS accounts.
The roles will both need to have a trust policy that looks like this. One will hold the pre-production account number and the other one, the production account number.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;Statement&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;Effect&quot;: &quot;Allow&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;Action&quot;: &quot;sts:AssumeRole&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;Principal&quot;: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;AWS&quot;: &quot;&lt;account number of data platform account&gt;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Both roles should have the following policy attached to the role.
Where <code>-- TABLE ARNs HERE --</code> can be replaced by a list of ARNs for the tables that you want to ingest. </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Version&quot;: &quot;2012-10-17&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;Statement&quot; [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;Effect&quot; = &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;Action&quot; = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;dynamodb:List*&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;dynamodb:Get*&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;dynamodb:Query&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;dynamodb:Scan&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;dynamodb:BatchGet*&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;dynamodb:DescribeTable*&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;dynamodb:DescribeStream*&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &quot;Resource&quot; = [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        -- TABLE ARNs HERE --</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You will need the role ARN&#x27;s of both roles, once they have been created, for the next step.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="saving-the-role-arn-in-the-data-platform-accounts">Saving the role ARN in the data platform accounts<a href="#saving-the-role-arn-in-the-data-platform-accounts" class="hash-link" aria-label="Direct link to Saving the role ARN in the data platform accounts" title="Direct link to Saving the role ARN in the data platform accounts">​</a></h2><p>Complete this step in both pre-production &amp; production AWS accounts.</p><ol><li>Login to AWS via <a href="https://hackney.awsapps.com/start#/" target="_blank" rel="noopener noreferrer">Hackney&#x27;s SSO</a>.</li><li>Navigate to <a href="https://eu-west-2.console.aws.amazon.com/systems-manager/parameters/?region=eu-west-2&amp;tab=Table" target="_blank" rel="noopener noreferrer">SSM parameter store</a> in the AWS console.</li><li>Click &quot;Create parameter&quot;.</li><li>Set the name of the parameter to be something like <code>/where-the-data-is-coming-from/prod/role-arn-to-access-dynamodb-tables</code>.
Changing the first section to be the name of the data source, the second section to be the environment the Dynamo DB instance is in, then leaving the third section as is.</li><li>Keep note of the parameter name, as you will need it in the next section, and click &quot;Create parameter&quot;.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-the-aws-glue-job">Setting up the AWS Glue job<a href="#setting-up-the-aws-glue-job" class="hash-link" aria-label="Direct link to Setting up the AWS Glue job" title="Direct link to Setting up the AWS Glue job">​</a></h2><ol><li>Open the <a href="https://github.com/LBHackney-IT/data-platform" target="_blank" rel="noopener noreferrer">Data Platform Project</a>. If you don&#x27;t have the correct permissions, you&#x27;ll get a &#x27;404&#x27; error (see <a href="/Data-Platform-Playbook/playbook/getting-set-up">getting set up</a>).</li><li>Navigate to the main <code>terraform/core</code> directory and add a new file named after the dataset you are ingesting, for example <code>17-mtfh-tables-ingestion.tf</code>. Click on &quot;Add file&quot; then &quot;Create new file&quot; to do this.</li><li>Load the role ARN saved in the <a href="#saving-the-role-arn-in-the-data-platform-accounts">previous section</a> in to terraform.</li></ol><ul><li>Copy this example code block into the file.<div class="language-tf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">data &quot;aws_ssm_parameter&quot; &quot;role_arn_to_access_housing_tables&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name = &quot;/where-the-data-is-coming-from/prod/role-arn-to-access-dynamodb-table&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Rename <code>role_arn_to_access_housing_tables</code> to be relevent to the kind of tables you are ingesting.</li><li>Change the name <code>/where-the-data-is-coming-from/prod/role-arn-to-access-dynamodb-table</code> to be the name of the parameter you created in the previous section.</li></ul><ol start="4"><li><p>Create the glue job &amp; crawler.
Copy the example terraform module below into the file.</p><div class="language-tf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">module &quot;ingest_dataset_tables&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source        = &quot;../modules/aws-glue-job&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  environment   = var.environment</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tags          = module.tags.values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  glue_role_arn = aws_iam_role.glue_role.arn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  job_name                       = &quot;${local.short_identifier_prefix}Ingest MTFH tables&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  job_description                = &quot;Ingest a snapshot of the tenures table from the Housing Dynamo DB instance&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  script_s3_object_key           = aws_s3_bucket_object.dynamodb_tables_ingest.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  helper_module_key              = aws_s3_bucket_object.helpers.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pydeequ_zip_key                = aws_s3_bucket_object.pydeequ.key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  spark_ui_output_storage_id     = module.spark_ui_output_storage.bucket_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  number_of_workers_for_glue_job = local.number_of_workers_for_mtfh_ingestion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  glue_scripts_bucket_id         = module.glue_scripts.bucket_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  glue_temp_bucket_id            = module.glue_temp_storage.bucket_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  job_parameters = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--table_names&quot;       = &quot;TenureInformation,PeopleInformation&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--role_arn&quot;          = data.aws_ssm_parameter.role_arn_to_access_housing_tables.value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--s3_target&quot;         = &quot;s3://${module.landing_zone.bucket_id}/mtfh/&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;--number_of_workers&quot; = local.number_of_workers_for_mtfh_ingestion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  crawler_details = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    database_name      = aws_glue_catalog_database.mtfh_landing_zone.name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    s3_target_location = &quot;s3://${module.landing_zone.bucket_id}/mtfh/&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    table_prefix       = &quot;mtfh_&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    configuration = jsonencode({</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      Version = 1.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      Grouping = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        TableLevelConfiguration = 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is example terraform to create a glue job in the Data Platform account.
You will need to changes the following values</p><ul><li><p>The module name - Declared at the top, in the example it is set to &quot;ingest_dataset_tables&quot;. You should rename this to reflect the entire collection of data that is being ingested by this job.</p></li><li><p><code>job_name</code> - Name of your job with <code>${local.short_identifier_prefix}</code> prefixed in front of it like the example.</p></li><li><p><code>job_description</code> (Optional) - An optional description for what this job is doing.</p></li><li><p><code>database_name</code> - The name of the glue catalogue database where the tables will be written to in the data platform.
If you want to create the tables in the landing zone database, this will be <code>aws_glue_catalog_database.landing_zone_catalog_database.name</code>.
If you want to create the tables in a departments raw zone database, this will be <code>module.department_DEPARTMENT_NAME.raw_zone_catalog_database_name</code>.</p></li><li><p><code>--table_names</code> - A comma delimited list of table names to ingest from Dynamo DB.</p></li><li><p><code>--role_arn</code> - This should be the value of the data object created in the step above, for the example given it would be <code>data.aws_ssm_parameter.role_arn_access_housing_tables.value</code>.
This signifies to terraform to go and get the value of this parameter, in which you have saved the ARN of the role created in the initial step.
Using the data object instead to writing the actual role ARN here allows you to configure a different role ARN for each environment.</p></li><li><p><code>--number_of_workers</code> and <code>number_of_workers_for_glue_job</code> - Both of these values should be set to the same value. More workers will mean more paralellisation and so if there is a large amount of data you might want to increase this, but if there is a small amount of data it will be expensive to have this too high as it won&#x27;t utilise all of the workers.
As a guide, we have a table that has around 90000 rows in it and we&#x27;re using 12 workers, please speak to an engineer if you are unsure.</p><p>The following parameters are inside the <code>crawler_details</code>.</p></li><li><p><code>s3_target_location</code> and <code>--s3_target</code> - This will specify the location in S3 bucket that the data is written to.
The glue job will create a folder for each table that it is ingesting so you just need to give the prefixes for these tables to live in.
For example if you are writing to the landing zone this could be, <code>s3://${module.landing_zone.bucket_id}/mtfh/</code>, if the tables were coming from modern tools for housing.
Or if you are writing to a departmental folder in the raw zone this could be, <code>s3://${module.raw_zone.bucket_id}/department_name/mtfh/</code></p></li><li><p><code>table_prefix</code> - This is a variable that allows you to add a prefix to the table names that are created in the Glue catalog. If the prefix is not required the value must be set to <code>null</code>.
For example, if you are ingesting a table with name &quot;houses&quot; and you set a prefix of &quot;hackney<!-- -->_<!-- -->borough<!-- -->_<!-- -->&quot; then the resulting table name in the Glue catalog will be &quot;hackney<!-- -->_<!-- -->borough<!-- -->_<!-- -->houses&quot;.</p></li><li><p><code>TableLevelConfiguration</code> - This will be dependent on your <code>s3_target_location</code>. It is the level at which tables are created in glue, from the S3 path.
Counting from the bucket name to the table name, so for the S3 paths <code>s3://${module.landing_zone.bucket_id}/mtfh/</code> and <code>s3://${module.raw_zone.bucket_id}/department_name/mtfh/</code> the table levels would be 3 and 4 respectively.</p></li></ul></li><li><p>Schedule the job (Optional).
If you don&#x27;t complete this step then the job and crawler will run once on creation and after that you will be able to run the job manually in the AWS console but it won&#x27;t run on a schedule.
If you want it to run on a schedule then please refer to the &quot;Variables used for scheduling a Glue job&quot; section of <a href="/Data-Platform-Playbook/playbook/transforming-data/using-aws-glue/deploy-glue-jobs#variables-used-for-scheduling-a-glue-job">this article</a> for an explanation on how to set the variables to do so.</p></li><li><p>Submit your changes, by referring to the <a href="/Data-Platform-Playbook/playbook/getting-set-up/using-github#committing-your-changes-to-the-data-platform-project">Committing changes</a> section of the <strong>Using Github</strong> guide.</p><ul><li>The Data Platform team needs to approve any changes to the code that you make, so your change won&#x27;t happen automatically.
Once your changes have been approved, the job will run at the next scheduled time.</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-ingestion-manually">Running the ingestion manually<a href="#running-the-ingestion-manually" class="hash-link" aria-label="Direct link to Running the ingestion manually" title="Direct link to Running the ingestion manually">​</a></h3><p>Once you have been notified that your pull request has been merged, you can run the ingestion manually from the AWS console or wait until the scheduled time (if you set one).</p><p>To do this first navigate to <a href="https://eu-west-2.console.aws.amazon.com/gluestudio/home?region=eu-west-2#/jobs" target="_blank" rel="noopener noreferrer">AWS glue jobs</a>. Then search for your job name, it will be prefixed by the environment (stg or prod) for example, if the job in this document was deployed to pre production it would be called &quot;stg Ingest MTFH tables&quot;. Finally you can select the glue job and click &quot;Run job&quot;.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitoring-the-ingestion">Monitoring the ingestion<a href="#monitoring-the-ingestion" class="hash-link" aria-label="Direct link to Monitoring the ingestion" title="Direct link to Monitoring the ingestion">​</a></h3><p>Spark Web UI is used to monitior and debug the glue jobs. Every 30 seconds, AWS Glue flushes the Spark event logs to an S3 bucket titled Spark UI Bucket.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/Data-Platform-Playbook/tags/playbook">playbook</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/playbook/ingesting-data/007-ingesting-dynamo-db-tables.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Data-Platform-Playbook/playbook/ingesting-data/database-ingestion"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Ingesting data from databases into the Data Platform</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Data-Platform-Playbook/playbook/ingesting-data/event-streaming"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ingesting new data entities via event streaming</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#objective" class="table-of-contents__link toc-highlight">Objective</a></li><li><a href="#intended-audience" class="table-of-contents__link toc-highlight">Intended audience</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#creating-a-role-in-the-account-where-the-dynamo-db-instance-is-located" class="table-of-contents__link toc-highlight">Creating a role in the account where the Dynamo DB instance is located</a></li><li><a href="#saving-the-role-arn-in-the-data-platform-accounts" class="table-of-contents__link toc-highlight">Saving the role ARN in the data platform accounts</a></li><li><a href="#setting-up-the-aws-glue-job" class="table-of-contents__link toc-highlight">Setting up the AWS Glue job</a><ul><li><a href="#running-the-ingestion-manually" class="table-of-contents__link toc-highlight">Running the ingestion manually</a></li><li><a href="#monitoring-the-ingestion" class="table-of-contents__link toc-highlight">Monitoring the ingestion</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.efd05c05.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.aed49b4a.js"></script>
</body>
</html>