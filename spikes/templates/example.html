<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-spikes/templates/example">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="search" type="application/opensearchdescription+xml" title="Hackney Data Platform Playbook" href="/Data-Platform-Playbook/opensearch.xml"><title data-rh="true">Spike: Full-text address search with fuzzy matching. | Hackney Data Platform Playbook</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://playbook.hackney.gov.uk//Data-Platform-Playbook/spikes/templates/example"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spike: Full-text address search with fuzzy matching. | Hackney Data Platform Playbook"><meta data-rh="true" name="description" content="Postgres Tools vs Elasticsearch"><meta data-rh="true" property="og:description" content="Postgres Tools vs Elasticsearch"><link data-rh="true" rel="icon" href="/Data-Platform-Playbook/img/favicon.png"><link data-rh="true" rel="canonical" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/spikes/templates/example"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/spikes/templates/example" hreflang="en"><link data-rh="true" rel="alternate" href="https://playbook.hackney.gov.uk//Data-Platform-Playbook/spikes/templates/example" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KNMFHOJ4X2-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/Data-Platform-Playbook/assets/css/styles.4438b1b5.css">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/runtime~main.7ad38183.js" as="script">
<link rel="preload" href="/Data-Platform-Playbook/assets/js/main.d0c23ec9.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Data-Platform-Playbook/"><div class="navbar__logo"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/Data-Platform-Playbook/img/logo-long.svg" alt="Data Platform Playbook" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate">Data Platform Playbook</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/data-platform-playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><main class="docMainContainer_uL0j docMainContainerEnhanced_oQfM"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Spike: Full-text address search with fuzzy matching.</h1><h3 class="anchor anchorWithStickyNavbar_mojV" id="postgres-tools-vs-elasticsearch">Postgres Tools vs Elasticsearch<a class="hash-link" href="#postgres-tools-vs-elasticsearch" title="Direct link to heading">​</a></h3><h2 class="anchor anchorWithStickyNavbar_mojV" id="objective">Objective<a class="hash-link" href="#objective" title="Direct link to heading">​</a></h2><p>We want to determine which tools or technologies would be best for us to use to implement a full-text address search with fuzzy matching. This spike focused on two possibilities:</p><ul><li>Postgres tools: We have a live Postgres RDS instance with address data.</li><li>Elasticsearch: It is a popular search engine &amp; analytics tool.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="considerations">Considerations<a class="hash-link" href="#considerations" title="Direct link to heading">​</a></h2><p>For this spike, a few user scenarios were used to determine which tool would be appropriate in fulfilling our desired address matching requirements:</p><ul><li>Free text search across all address lines, i.e. Line1, Line2, Line3 &amp; Line4.</li><li>Abbreviations of common street names (e.g. str, rd) are accepted.</li><li>Spelling mistakes are allowed.</li><li>Names with/ without an apostrophe return expected results.</li><li>Variations in describing address, e.g. Flat A 100 Mare Street vs 100A Mare Street.</li><li>Match proper names regardless of the words street, road, lane, etc. e.g Cromwell street query should also return Cromwell Avenue matches.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="findings">Findings<a class="hash-link" href="#findings" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="postgres">Postgres:<a class="hash-link" href="#postgres" title="Direct link to heading">​</a></h3><p>Postgres has quite a number of tools (or extensions) that we can install on our AWS RDS instance giving us the functionality that we want for our full-text search.
With Postgres we can:</p><ul><li>Parse address strings into tokens (or lexemes). Tokenising should allow mapping of words in a query even if the way the user inputs the query varies e.g:<ul><li>Saved string: “Try not to become a man of success, but rather try to become a man of value”</li><li>Tokens (or lexemes) created: &#x27;becom&#x27;, &#x27;man&#x27;, &#x27;rather&#x27;, &#x27;success&#x27;, &#x27;tri&#x27;, &#x27;valu&#x27;</li><li>User one query: “Trying not to become a man of success”</li><li>User two query: “Becoming a valued man”</li><li>Both queries (after tokenising as well) should return the saved string. Note: Tokenising removes stop words like e.g ‘the’, ‘a’, ‘of’, etc.</li><li>We can structure how to get the most relevant matches first by adding rankings to specific columns when queried.</li><li>We can add custom dictionaries that would hold any stop words we don’t want to be ignored and can also hold synonyms for words e.g apartment vs flat. Str vs street.</li><li>Entity framework has support for Postgres full-text searching.
This is a quick overview of what Postgres full-text searching can offer us. The documentation for implementing this is very extensive and detailed.</li></ul></li></ul><p>####Limitation
Currently AWS RDS doesn’t support custom dictionaries. This is because custom dictionaries are created as files that need to be uploaded into the database. You currently can’t do this in RDS which would affect synonym and stop word matching.</p><p>####Suggestion
It might be possible to get around this by how we parse the user query i.e the parsed query for full-text search would use boolean operators, “AND”, “OR”, “NOT”. We would most likely use AND operations to get more relevant matches but there might be a way to use OR operators before certain abbreviations/synonyms but this would likely be custom code and could get a bit unwieldy. This also might result in more irrelevant matches but matches nonetheless whereas using just AND would return nothing.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="elasticsearch">Elasticsearch:<a class="hash-link" href="#elasticsearch" title="Direct link to heading">​</a></h3><p>This is a search and analytics engine tool so has been designed to tackle the full-text searching to a specialised degree. To use Elasticsearch we would need to get the data we want to index into it but if we use AWS Elasticsearch this can be accomplished by DMS.</p><p>Getting data in Elasticsearch also requires mapping, however, we don’t need to transfer all the data in the database. Might need more clarification on this but it sounds like an efficient way is to only transfer and index the data related to address search queries e.g the address line columns and postcode.</p><p>Elasticsearch also can:</p><ul><li>Parse address strings into tokens (or lexemes) using its analysers.</li><li>Can install packages that add custom dictionaries of synonyms or words to ignore or stop words to not ignore.</li><li>Can also add weights for ranking.
Elasticsearch comes with an extensive toolset for searching, analysing data and returning the relevant matches and can be integrated into dotnet project by using a package called NEST.</li></ul><p>####Limitation
This is would be a separate tool that requires configuration and some understanding of what we should implement and don’t need from Elasticsearch.</p><p>AWS has an Elasticsearch service we could spin up in our AWS environments. If we use AWS Elasticsearch we can benefit from using DMS to get the data we need into it, however, if we do not use AWS Elasticsearch, we would need to create a script to import the data into our Elasticsearch instance.</p><p>Using AWS Elasticsearch means we’ll be adding an additional tool to our current stack in AWS and this would need to be managed and maintained. It also means that we would be adding an additional cost to the running of the stack. There is a free tier option but we would be charged for usages over that limit.</p><p>####Suggestion
From reading the ONS paper on address matching, Elasticsearch was being implemented for retrieving addresses. Since this paper was focused on tackling the address matching problem, it might be worth using this as a tool for indexing and searching rather than relying on database tools.</p><p>We currently have indexes in the Postgres DB but it might be worth understanding a bit more about the indexing in Elasticsearch and whether these would have an effect on query performance compared to what we have in Postgres.</p><p>In our case, we might be able to use Elasticsearch as our indexing tool for a subset of data, retrieve a list of matching ids and then query the database using these ids, which could result in faster retrieval but this needs to be checked.</p><p>##Helpful Resources/Documentation</p><ul><li><p>Postgres documentation on Full-Text Searching</p></li><li><p>Postgres Full-Text Search with Entity Framework Core</p></li><li><p>Postgres full-text search is Good Enough! Blog</p></li><li><p>Postgres Full-Text Search How-To Video</p></li><li><p>Setting up Elasticsearch with .Net and Docker Blog</p></li><li><p>Amazon Elasticsearch Pricing</p></li><li><p>Amazon Elasticsearch Overview</p></li><li><p>Querying Elasticsearch using the Search API</p></li><li><p>Using DMS to migrate data into Elasticsearch</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/LBHackney-IT/data-platform-playbook/edit/master/docs/spikes/templates/example.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#postgres-tools-vs-elasticsearch" class="table-of-contents__link toc-highlight">Postgres Tools vs Elasticsearch</a></li><li><a href="#objective" class="table-of-contents__link toc-highlight">Objective</a></li><li><a href="#considerations" class="table-of-contents__link toc-highlight">Considerations</a></li><li><a href="#findings" class="table-of-contents__link toc-highlight">Findings</a><ul><li><a href="#postgres" class="table-of-contents__link toc-highlight">Postgres:</a></li><li><a href="#elasticsearch" class="table-of-contents__link toc-highlight">Elasticsearch:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/Data-Platform-Playbook/assets/js/runtime~main.7ad38183.js"></script>
<script src="/Data-Platform-Playbook/assets/js/main.d0c23ec9.js"></script>
</body>
</html>